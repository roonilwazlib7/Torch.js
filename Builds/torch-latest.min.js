(function(){var t=[].slice;Function.prototype.MixIn=Function.prototype.is=function(t){var e,i,r,n;r=this.prototype,e=Object.create(t.prototype);for(i in e)n=e[i],r[i]=n;return this},String.prototype.format=function(){var e,i;return e=1<=arguments.length?t.call(arguments,0):[],i=function(t,i){return void 0!==typeof e[i]?e[i]:void 0===typeof e[i]?t:void 0},this.replace(/{(\d+)}/g,i)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.unCapitalize=function(){return this.charAt(0).toLowerCase()+this.slice(1)}}).call(this),function(){var t,e;e=this,t=function(){function t(){}return t.dispatchers=[],t.prototype.InitEventDispatch=function(){return this.events={},t.dispatchers.push(this)},t.prototype.On=function(t,e){var i;return this.events[t]||(i=[],i.triggers=0,this.events[t]=i),this.events[t].push(e),this},t.prototype.Emit=function(t,e){var i,r,n,o;if(void 0!==this.events[t])for(o=this.events[t],r=0,n=o.length;r<n;r++)i=o[r],this.events[t].triggers++,i(e);return this},t.prototype.Off=function(t){var e,i,r;if(null==t&&(t=""),""!==t)this.events[t]=void 0;else{i=this.events;for(e in i)r=i[e],this.events[e]=void 0}return this},t}(),e.EventDispatcher=t}.call(this),function(){var t,e;e=this,t=function(){function t(){}return t.prototype.trash=!1,t.prototype.Trash=function(){return this.trash=!0,this},t}(),e.Trashable=t}.call(this),function(){var t,e,i,r,n,o=[].slice;n=this,window.onerror=function(){var t,e;if(t=1<=arguments.length?o.call(arguments,0):[],window.Torch.STRICT_ERRORS)return e=t[4],void 0!==e?window.Torch.FatalError(e):window.Torch.FatalError("An error has occured")},i=function(){function t(t){this.func=t}return t.MixIn(Trashable),t.prototype._torch_add="Task",t.prototype.Execute=function(t){return this.func(t)},t}(),t=function(){function t(t,e){null==e&&(e=window.Torch.AjaxData.Text),this.url=t,this.responseType=this.GetResponseTypeString(e)}return t.prototype.onFinish=function(){},t.prototype.onError=function(){},t.prototype.GetResponseTypeString=function(t){switch(t){case window.Torch.AjaxData.DOMString:return"";case window.Torch.AjaxData.ArrayBuffer:return"arraybuffer";case window.Torch.AjaxData.Blob:return"blob";case window.Torch.AjaxData.Document:return"document";case window.Torch.AjaxData.Json:return"json";case window.Torch.AjaxData.Text:return"text"}},t.prototype.Error=function(t){return this.onError=t},t.prototype.Finish=function(t){return this.onFinish=t},t.prototype.Load=function(){var t;return t=new XMLHttpRequest,t.open("GET",this.url,!0),t.responseType=this.responseType,t.onload=function(e){return function(){return e.onFinish(t.response,e)}}(this),t.send()},t}(),e=function(){function t(t,e){var i,r,n;this.game=t,this.data=e,null!==this.game&&(this.time=this.game.time),r=this.data;for(i in r)n=r[i],this[i]=n}return t}(),r=function(){function i(){this.GamePads=this.Enum("Pad1","Pad2","Pad3","Pad4"),this.AjaxData=this.Enum("DOMString","ArrayBuffer","Blob","Document","Json","Text"),this.Types=this.Enum("String","Number","Object","Array","Function","Sprite","Game","Null"),this.AjaxLoader=t,this.Event=e,this.EventDispatcher=EventDispatcher,this.Trashable=Trashable}var r;return i.prototype.CANVAS=1,i.prototype.WEBGL=2,i.prototype.PIXEL=3,i.prototype.DUMP_ERRORS=!1,i.prototype.RandomInRange=function(t,e){return Math.random()*(e-t+1)+t},i.prototype.Needs=function(t){if(!i[t])throw"Compenent "+t+" is required";return this},i.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),document.body.backgroundColor="black",this.DUMP_ERRORS&&void 0!==require&&require("fs").writeFileSync("torch-error.log",t.stack),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302C;margin-left:15%;font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302C;font-size:20px;font-weight:bold'>Stack Trace:</code><br>\n<code style='color:#C9302C;font-size:20px'>"+i+"</code><br>",document.body.innerHTML=e,t},i.prototype.StrictErrors=function(){return this.STRICT_ERRORS=!0},i.prototype.DumpErrors=function(){return this.DUMP_ERRORS=!0},i.prototype.DisableConsoleWarnings=function(){return console.warn=function(){}},i.prototype.Enum=function(){var t,e,i,r,n,s;for(s=1<=arguments.length?o.call(arguments,0):[],r={},t=e=0,i=s.length;e<i;t=++e)n=s[t],r[n]=t+1;return r},i.prototype.Assert=function(t,e){if(null==e&&(e="Assertation Failed"),!t)return i.FatalError(e)},i.prototype.TypeOf=function(t){var e,r;switch(e=[],void 0!==t.__torch__&&e.push(t.__torch__),r={}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case"string":e.push(i.Types.String);break;case"number":e.push(i.Types.Number);break;case"object":e.push(i.Types.Object);break;case"array":e.push(i.Types.Array);break;case"function":e.push(i.Types.Function);break;default:e.push(i.Types.Null)}return e},r=function(t,e){return i.TypeOf(t).indexOf(e)!==-1},i.prototype.ExtendObject=function(t,e){var i,r,n;r=[];for(i in e)n=e[i],r.push(t[i]=n);return r},i.prototype.ExtendProperties=function(){var t,e,i,r,n,s,h,a;for(t=arguments[0],h=2<=arguments.length?o.call(arguments,1):[],a=[],i=0,n=h.length;i<n;i++)s=h[i],r=s.unCapitalize(),e=function(t){return void 0===t?this[r]:(this[r]=t,this)},a.push(t.prototype[s]=e);return a},i}(),n.Torch=new r}.call(this),function(){var DebugConsole,slice=[].slice;DebugConsole=function(){function DebugConsole(t){var e,i;this.game=t,i='<div id = "torch-console" style = "position: absolute;z-index: 100;top:0;border: 1px solid orange;background-color:black">\n    <p style = "color:white;margin-left:1%;font-family:monospace">Torch Dev Console. Type /HELP for usage</p>\n    <input type="text" id = "torch-console-input" placeholder="Torch Dev Console, type /HELP for usage"/ style = "outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 16px;padding: 3%;width: 100%;" />\n    <div id = "torch-console-output" style = "overflow:auto;outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 14px;padding: 1%;width: 98%;height:250px"></div>\n</div>',e=document.createElement("div"),e.innerHTML=i,e.style.display="none",document.body.appendChild(e),this.console=e,this.consoleInput=document.getElementById("torch-console-input"),this.consoleOutput=document.getElementById("torch-console-output"),this.commands={},this.variables={},this.LoadDefaultCommands(),document.addEventListener("keypress",function(t){return function(e){return 47===e.keyCode?t.Toggle(!0):13===e.keyCode?t.ParseCommand():void 0}}(this)),document.addEventListener("keydown",function(t){return function(e){if(27===e.keyCode)return t.Toggle(!1)}}(this))}return DebugConsole.prototype.enabled=!1,DebugConsole.prototype.console=null,DebugConsole.prototype.consoleInput=null,DebugConsole.prototype.consoleOutput=null,DebugConsole.prototype.commands=null,DebugConsole.prototype.variables=null,DebugConsole.prototype.Toggle=function(t){return null==t&&(t=!0),t?(this.console.style.display="block",this.consoleInput.focus(),this.enabled=!0):(this.console.style.display="none",this.consoleInput.value="",this.enabled=!1)},DebugConsole.prototype.Output=function(t,e){return null==e&&(e="white"),t=t.replace(/\n/g,"<br>"),this.consoleOutput.innerHTML+="<p style='color:orange'>TorchDev$</p><p style='color:"+e+"'>"+t+"</p>"},DebugConsole.prototype.ParseCommand=function(){var t,e,i,r,n,o,s,h;if(this.enabled){for(i=this.consoleInput.value,i=i.replace(/\$(.*?)\$/g,function(t){return function(e){var i;return i=e.substring(1,e.length-1),t.variables[i]}}(this)),e=i.split(" ")[0].split("/")[1],t=[],h=i.split(" "),n=r=0,o=h.length;r<o;n=++r)s=h[n],0!==n&&t.push(s);return this.ExecuteCommand(e,t)}},DebugConsole.prototype.ExecuteCommand=function(t,e){var i;return this.commands[t]?(i=this.commands)[t].apply(i,[this].concat(slice.call(e))):void this.Output("Command '"+t+"' does not exist.","red")},DebugConsole.prototype.AddCommand=function(t,e){return this.commands[t]=e},DebugConsole.prototype.LoadDefaultCommands=function(){return this.AddCommand("HELP",function(t){return function(t){return t.Output("type '/HELP' for help\ntype '/FPS' for frame rate\ntype '/TIME' for game time\ntype '/E [statement]' to execute a JavaScript statement\ntype '/RUN [path] to load and execute a JavaScript file'")}}(this)),this.AddCommand("CLEAR",function(t){return function(e){return t.consoleOutput.innerHTML=""}}(this)),this.AddCommand("FPS",function(t){return function(e){return e.Output("Current FPS: "+t.game.fps+"\nAverage FPS: 0")}}(this)),this.AddCommand("TIME",function(t){return function(e){return e.Output("Total Game Time: "+t.game.time+"\nDelta Time: "+t.game.deltaTime)}}(this)),this.AddCommand("RUN",function(_this){return function(tConsole,filePath){var loader;return loader=new Torch.AjaxLoader(filePath,Torch.AjaxData.Text),loader.Finish(function(data){var error,error1;try{return eval(data),tConsole.Output("File Executed","green")}catch(t){return error=t,tConsole.Output("File: '"+statement+"' caused an error. "+error,"red")}}),loader.Load()}}(this)),this.AddCommand("SET",function(t){return function(e,i,r){return isNaN(r)?t.variables[i]=r:t.variables[i]=parseFloat(r),t.Output("Set "+i+" to "+r,"green")}}(this)),this.AddCommand("E",function(_this){return function(tConsole,statement){var error,error1;try{return eval(statement),tConsole.Output("Statment Executed","green")}catch(t){return error=t,tConsole.Output("Statement: '"+statement+"' caused an error. "+error,"red")}}}(this))},DebugConsole}(),Torch.DebugConsole=DebugConsole}.call(this),function(){var t;t=function(){function t(t){this.sprite=t,Torch.Assert(null!==this.sprite&&this.sprite.__torch__===Torch.Types.Sprite),this.game=this.sprite.game,this.velocity=new Torch.Vector(0,0),this.acceleration=new Torch.Vector(0,0),this.omega=0,this.alpha=0}return t.prototype.Update=function(){return this.sprite.position.x+=this.velocity.x*this.game.Loop.updateDelta,this.sprite.position.y+=this.velocity.y*this.game.Loop.updateDelta,this.velocity.x+=this.acceleration.x*this.game.Loop.updateDelta,this.velocity.y+=this.acceleration.y*this.game.Loop.updateDelta,this.sprite.rotation+=this.omega*this.game.Loop.updateDelta},t.prototype.Debug=function(t){return null==t&&(t=!0),this.DEBUG=t},t.prototype.AngleTo=function(t){var e;return e=this.DirectionTo(t),e.angle},t.prototype.DistanceTo=function(t){var e,i;return i=new Torch.Vector(this.sprite.position.x,this.sprite.position.y),e=new Torch.Vector(t.position.x,t.position.y),e.SubtractVector(i),e.magnitude},t.prototype.DirectionTo=function(t){var e;return e=new Torch.Vector(t.position.x-this.sprite.position.x,t.position.y-this.sprite.position.y),e.Normalize(),e},t}(),Torch.Body=t}.call(this),function(){var t;t=function(){function t(t){var e;this.sprite=t,e=this.sprite.rectangle,this.width=e.width,this.height=e.height,this.scale={width:1,height:1}}return t.prototype.width=0,t.prototype.height=0,t.prototype.scale=null,t.prototype.Update=function(){var t;return t=this.sprite.rectangle,t.width=this.width*this.scale.width,t.height=this.height*this.scale.height},t.prototype.Set=function(t,e){return this.width=t,this.height=e},t.prototype.Scale=function(t,e){return this.scale.width=t,this.scale.height=e},t}(),Torch.SizeManager=t}.call(this),function(){var t;t=function(){function t(t){this.sprite=t,this.game=this.sprite.game}return t.prototype.mouseOver=!1,t.prototype.clickTrigger=!1,t.prototype.clickAwayTrigger=!1,t.prototype.draw=!0,t.prototype.wasClicked=!1,t.prototype.Update=function(){var t,e;if(!this.game.Mouse.GetRectangle().Intersects(this.sprite.rectangle)&&this.mouseOver&&(this.mouseOver=!1,this.sprite.Emit("MouseLeave",new Torch.Event(this.game,{sprite:this.sprite}))),this.game.Mouse.GetRectangle(this.game).Intersects(this.sprite.rectangle)?(this.mouseOver||this.sprite.Emit("MouseOver",new Torch.Event(this.game,{sprite:this.sprite})),this.mouseOver=!0):this.sprite.fixed?(t=this.game.Mouse.GetRectangle(),e=new Torch.Rectangle(t.x,t.y,t.width,t.height),e.x+=this.game.Viewport.x,e.y+=this.game.Viewport.y,e.Intersects(this.sprite.rectangle)?this.mouseOver=!0:this.mouseOver=!1):this.mouseOver=!1,this.mouseOver&&this.game.Mouse.down&&!this.clickTrigger&&(this.clickTrigger=!0),this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver&&(this.wasClicked=!0,this.sprite.Emit("Click",new Torch.Event(this.game,{sprite:this.sprite})),this.clickTrigger=!1),!this.clickTrigger||this.game.Mouse.down||this.mouseOver||(this.clickTrigger=!1),this.game.Mouse.down||this.mouseOver||!this.clickAwayTrigger?this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver?this.clickAwayTrigger=!1:this.game.Mouse.down&&!this.mouseOver&&(this.clickAwayTrigger=!0):(this.sprite.Emit("ClickAway",new Torch.Event(this.game,{sprite:this.sprite})),this.wasClicked=!1,this.clickAwayTrigger=!1),!this.sprite.rectangle.Intersects(this.game.BoundRec))return this.sprite.Emit("OutOfBounds",new Torch.Event(this.game,{sprite:this.sprite}))},t}(),Torch.EventManager=t}.call(this),function(){var t;t=function(){function t(t){this.sprite=t,this.tint={color:null,opacity:.5},this.mask={texture:null,in:!1,out:!1}}return t.prototype.tint=null,t.prototype.mask=null,t}(),Torch.EffectManager=t}.call(this),function(){var t;t=function(){function t(t){this.sprite=t,this.stateMachines={}}return t.prototype.CreateStateMachine=function(t){return this.stateMachines[t]=new Torch.StateMachine(this.sprite),this.stateMachines[t]},t.prototype.GetStateMachine=function(t){return this.stateMachines[t]},t.prototype.Update=function(){var t,e,i,r;e=this.stateMachines,i=[];for(t in e)r=e[t],i.push(r.Update());return i},t}(),Torch.StateMachineManager=t}.call(this),function(){var t,e=[].slice;t=function(){function t(t){this.sprite=t,this.position=new Torch.Point(0,0),this.children=[]}return t.prototype.parent=null,t.prototype.children=null,t.prototype.centered=!1,t.prototype.centerVertical=!1,t.prototype.alignLeft=!1,t.prototype.alignRight=!1,t.prototype.alignTop=!1,t.prototype.alignBottom=!1,t.prototype.Align=function(){var t,i,r,n,o;for(r=1<=arguments.length?e.call(arguments,0):[],n=[],t=0,i=r.length;t<i;t++)switch(o=r[t]){case"left":n.push(this.alignLeft=!0);break;case"right":n.push(this.alignRight=!0);break;case"top":n.push(this.alignTop=!0);break;case"bottom":n.push(this.alignBottom=!0);break;default:n.push(void 0)}return n},t.prototype.Center=function(t){return null==t&&(t=!0),this.centered=t},t.prototype.CenterVertical=function(t){return null==t&&(t=!0),this.centerVertical=t},t.prototype.Append=function(t){return t.Grid.parent=this.sprite,t.drawIndex=this.sprite.drawIndex+1,t.fixed=this.sprite.fixed},t.prototype.Parent=function(){return this.parent},t.prototype.Children=function(t){var e,i,r,n,o,s,h,a;if(!t)return this.children;for(i=[],h=this.children,r=0,o=h.length;r<o;r++){e=h[r],s=!0;for(n in t)a=t[n],!e[n]===a&&(s=!1);s&&i.append(e)}return i},t.prototype.Ancestors=function(t){var e,i,r,n,o,s;if(!this.parent)return null;for(i=[],e=this.parent,o=[];null!==e.Parent();){if(t){n=!0;for(r in t)s=t[r],e[r]!==s&&(n=!1);n&&i.push(e)}else i.push(e);o.push(e=e.Parent())}return o},t.prototype.ApplyCentering=function(t){return this.centered&&(t.x=t.x+this.parent.rectangle.width/2-this.sprite.rectangle.width/2),this.centerVertical&&(t.y=t.y+this.parent.rectangle.height/2-this.sprite.rectangle.height/2),t},t.prototype.ApplyAlignment=function(t){return this.alignLeft&&(t.x=0),this.alignRight&&(t.x=t.x+(this.parent.rectangle.width-this.sprite.rectangle.width)),this.alignTop&&(t.y=0),this.alignBottom&&(t.y=t.y+(this.parent.rectangle.height-this.sprite.rectangle.height)),t},t.prototype.ResolveAbosolutePosition=function(){var t;return null===this.parent?this.sprite.position:(t=this.parent.position.Clone(),t=this.ApplyCentering(t),t=this.ApplyAlignment(t),t.Apply(this.position),t)},t.prototype.Update=function(){if(this.sprite.position=this.ResolveAbosolutePosition(),null!==this.parent)return this.sprite.drawIndex=this.parent.drawIndex+1,this.sprite.fixed=this.parent.fixed},t}(),Torch.GridManager=t}.call(this),function(){var t,e,i=[].slice,r=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=function(){function t(t,e,i){this.InitSprite(t,e,i)}return t.MixIn(Torch.EventDispatcher).MixIn(Torch.Trashable),t.prototype.__torch__=Torch.Types.Sprite,t.prototype.InitSprite=function(t,e,i){return null==e&&(e=0),null==i&&(i=0),null!==t&&void 0!==t||Torch.FatalError("Unable to initialize sprite without game"),this.InitEventDispatch(),this.game=t,this.rectangle=new Torch.Rectangle(e,i,0,0),this.position=new Torch.Point(e,i),this.Bind=new Torch.Bind(this),this.Collisions=new Torch.CollisionManager(this),this.Body=new Torch.Body(this),this.Size=new Torch.SizeManager(this),this.Events=new Torch.EventManager(this),this.Effects=new Torch.EffectManager(this),this.States=new Torch.StateMachineManager(this),this.Grid=new Torch.GridManager(this),this.DrawTexture=null,this.TexturePack=null,this.TextureSheet=null,this.TextureSimple=null,this.fixed=!1,this.draw=!0,this.drawIndex=0,this.rotation=0,this.opacity=1,this._torch_add="Sprite",this._torch_uid="",this.events={},this.renderer=new CanvasRenderer(this),t.Add(this)},t.prototype.UpdateSprite=function(){return this.Body.Update(),this.Size.Update(),this.Events.Update(),this.States.Update(),this.Grid.Update(),this.rectangle.x=this.position.x,this.rectangle.y=this.position.y,this.Collisions.Update()},t.prototype.Update=function(){return this.UpdateSprite()},t.prototype.Draw=function(){return this.renderer.Draw()},t.prototype.GetCurrentDraw=function(){return this.TexturePack?this.TexturePackAnimation.GetCurrentFrame():this.TextureSheet?this.TextureSheetAnimation.GetCurrentFrame():this.DrawTexture?this.DrawTexture:void 0},t.prototype.Clone=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],e=this.constructor,function(t,e,i){i.prototype=t.prototype;var r=new i,n=t.apply(r,e);return Object(n)===n?n:r}(e,t,function(){})},t.prototype.NotSelf=function(t){return t._torch_uid!==this._torch_uid},t.prototype.Center=function(){var t,e;return t=this.game.canvasNode.width,e=t/2-this.rectangle.width/2,this.position.x=e,this},t.prototype.CenterVertical=function(){var t,e;return t=this.game.canvasNode.height,e=t/2-this.rectangle.height/2,this.position.y=e,this},t.prototype.CollidesWith=function(t){return new Torch.Collider.CollisionDetector(this,t)},t}(),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.GHOST_SPRITE=!0,e}(e),Torch.Sprite=e,Torch.GhostSprite=t}.call(this),function(){var t,e,i=function(t,e){function i(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},r={}.hasOwnProperty;e=document.createElement("CANVAS"),e.width=500,e.height=500,t=function(t){function r(t,e,i,r){this.InitText(t,e,i,r)}return i(r,t),r.prototype.TEXT=!0,r.measureCanvas=e.getContext("2d"),r.prototype.InitText=function(t,e,i,r){return this.InitSprite(t,e,i),this.data=r,this.font="Arial",this.fontSize=16,this.fontWeight="",this.color="#2b4531",this.text="",this.lastText="",this.width=100,this.height=100,this.Size.scale={width:1,height:1},this.Init()},r.prototype.Init=function(){return this.data.font&&(this.font=this.data.font),this.data.fontSize&&(this.fontSize=this.data.fontSize),this.data.fontWeight&&(this.fontWeight=this.data.fontWeight),this.data.color&&(this.color=this.data.color),this.data.text&&(this.text=this.data.text),this.data.rectangle&&(this.rectangle=this.data.rectangle),this.data.buffHeight&&(this.buffHeight=this.data.buffHeight),this.Render()},r.prototype.Render=function(){var t,e,i;return e=document.createElement("CANVAS"),r.measureCanvas.font=this.fontSize+"px "+this.font,e.width=Torch.Text.measureCanvas.measureText(this.text).width,e.height=this.fontSize,this.buffHeight&&(e.height+=this.buffHeight),t=e.getContext("2d"),t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.font,t.fillText(this.text,0,e.height),i=new Image,i.src=e.toDataURL(),i.onload=function(t){return function(){return t.GL?(t.Three()&&t.Three().Remove(),t.Bind.WebGLTexture({gl_2d_canvas_generated_image:!0,width:i.width,height:i.height,texture:(new THREE.TextureLoader).load(i.src)})):t.Bind.Texture(i)}}(this),this.rectangle.width=e.width,this.rectangle.height=this.fontSize},r.prototype.Update=function(){return r.__super__.Update.call(this),this.UpdateText()},r.prototype.UpdateText=function(){if(this.text!==this.lastText)return this.Render(),this.lastText=this.text},r}(Torch.Sprite),Torch.ExtendProperties(t,"Text","Font","FontSize","FontWeight","Color"),Torch.Text=t}.call(this),function(){var t,e=[].slice;t=function(){function t(t,e){var i,r,n,o;for(this.sprites=null!=t?t:[],this.game=e,n=this.sprites,i=0,r=n.length;i<r;i++)o=n[i],o.anchorX=o.Rectangle.x;return this}return t.prototype.Factory=function(t){return this.spriteFactory=t,this},t.prototype.Add=function(){var t,i,r,n,o;return r=arguments[0],n=arguments[1],o=arguments[2],t=4<=arguments.length?e.call(arguments,3):[],null===r||void 0===r&&void 0!==this.spriteFactory?(i=function(t,e,i){i.prototype=t.prototype;var r=new i,n=t.apply(r,e);return Object(n)===n?n:r}(this.spriteFactory,[this.game,n,o].concat(e.call(t)),function(){}),this.sprites.push(i),i):(this.sprites=this.sprites.concat(r),this)},t.prototype.Trash=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.Trash();return this},t.prototype.Shift=function(t){var e,i,r,n,o;for(r=this.sprites,n=[],e=0,i=r.length;e<i;e++)o=r[e],t.x?n.push(o.Rectangle.x=o.anchorX+t.x):n.push(void 0);return n},t.prototype.Hide=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.draw=!1;return this},t.prototype.Show=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.draw=!0;return this},t.prototype.Center=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.Center();return this},t.prototype.ToggleFixed=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.ToggleFixed();return this},t}(),Torch.SpriteGroup=t}.call(this),function(){var t;t=function(){function t(t,e){this.game=t,this.gridXml=e,this.ParseXml()}return t.prototype.ParseXml=function(){var t,e,i,r;return t=new DOMParser,r=t.parseFromString(this.gridXml,"text/xml"),e=r.getElementsByTagName("SpriteGrid")[0],null===e&&this.game.FatalError("Unable to parse SpriteGrid XML, no SpriteGrid tag"),i=e.getElementsByTagName("Sprite")},t}(),Torch.SpriteGrid=t}.call(this),function(){var t;Torch.Collider={},t=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.AABB=function(){return new Torch.Collider.AABB(this.sprite,this.otherSprite).Execute()},t.prototype.Circle=function(){return new Torch.Collider.Circle(this.sprite,this.otherSprite).Execute()},t.prototype.SAT=function(){return new Torch.Collider.SAT(this.sprite,this.otherSprite).Execute()},t}(),Torch.Collider.CollisionDetector=t}.call(this),function(){var t;t=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){return this.sprite.rectangle.Intersects(this.otherSprite.rectangle)},t}(),Torch.Collider.AABB=t}.call(this),function(){var t;t=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){var t,e,i,r,n;return t={radius:this.sprite.Width(),x:this.sprite.Position("x"),y:this.sprite.Position("y")},e={radius:this.otherSprite.Width(),x:this.otherSprite.Position("x"),y:this.otherSprite.Position("y")},r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(r*r+n*n),i<t.radius+e.radius},t}(),Torch.Collider.Circle=t}.call(this),function(){}.call(this),function(){var t;Torch.Collision={AABB:1,Circle:2,SAT:3},t=function(){function t(t){this.sprite=t,this.filter={},this.game=this.sprite.game}return t.prototype.mode=Torch.Collision.AABB,t.prototype.sprite=null,t.prototype.filter=null,t.prototype.limit=null,t.prototype.enabled=!1,t.prototype.Monitor=function(){return this.enabled=!0},t.prototype.NotFiltered=function(t){var e,i,r,n;i=this.game.filter;for(e in i)if(n=i[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!1}else if(n===t[e])return!1;r=this.filter;for(e in r)if(n=r[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!1}else if(n===t[e])return!1;return!0},t.prototype.InLimit=function(t){var e,i,r;i=this.limit;for(e in i)if(r=i[e],"__type__"===e){if(r.constructor.name===t.constructor.name)return!0}else if(r===t[e])return!0;return!1},t.prototype.Valid=function(t){return null!==this.limit?this.InLimit(t):this.NotFiltered(t)},t.prototype.Filter=function(t){return this.filter=t},t.prototype.Limit=function(t){return this.limit=t},t.prototype.Mode=function(t){var e;return e=t},t.prototype.Update=function(){var t,e,i,r,n,o,s;if(this.sprite.game&&this.enabled){for(this.game=this.sprite.game,t=!1,s=this.game.spriteList,r=0,n=s.length;r<n;r++)if(o=s[r],this.sprite.NotSelf(o)&&this.Valid(o)){switch(i=!1,e={},this.mode){case Torch.Collision.AABB:e=this.sprite.CollidesWith(o).AABB(),i=e!==!1}i&&(e.self=this.sprite,e.collider=o,this.sprite.Emit("Collision",new Torch.Event(this.game,{collisionData:e})))}return this.sprite.Emit("NoCollision",new Torch.Event(this.game,{}))}},t.prototype.SimpleCollisionHandle=function(t,e){var i,r;return null==e&&(e=1),i=t.collisionData,r={left:!1,right:!1,top:!1,bottom:!1},i.vx<i.halfWidths&&i.vy<i.halfHeights&&(i.x<i.y?i.vx>0?(t.collisionData.self.position.x+=i.x*e,r.left=!0):i.vx<0&&(t.collisionData.self.position.x-=i.x*e,r.right=!0):i.x>i.y&&(i.vy>0?(t.collisionData.self.position.y+=i.y*e,r.top=!0):i.vy<0&&(t.collisionData.self.position.y-=i.y*e,r.bottom=!0))),r},t}(),Torch.CollisionManager=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.fps=50,this.frameTime=1e3/this.fps,this.lag=0,this.updateDelta=0,this.drawDelta=0,this.lagOffset}return t.prototype.Update=function(){return this.game.update(this),this.game.Camera.Update(),this.game.Timer.Update(),this.game.Debug.Update(),this.game.Tweens.Update(),this.game.UpdateAnimations(),this.game.UpdateTimeInfo(),this.game.UpdateTasks(),this.game.UpdateGamePads(),this.game.UpdateSprites()},t.prototype.Draw=function(){return this.game.draw(this),this.game.DrawSprites()},t.prototype.AdvanceFrame=function(t){var e;for(void 0===this.game.time&&(this.game.time=t),this.game.deltaTime=Math.round(t-this.game.time),this.game.time=t,e=this.game.deltaTime,this.drawDelta=e,this.updateDelta=this.frameTime,e>1e3&&(e=this.frameTime),this.lag+=e;this.lag>=this.frameTime;)this.Update(),this.lag-=this.frameTime;return this.lagOffset=this.lag/this.frameTime,this.Draw(),window.requestAnimationFrame(function(t){return function(e){return t.AdvanceFrame(e)}}(this))},t.prototype.Run=function(t){return this.AdvanceFrame(0)},t}(),Torch.Loop=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.game.Assets={game:this.game,GetTexture:function(t){return this.game.Assets.Textures[t]},GetTexturePack:function(t){return this.game.Assets.TexturePacks[t]},GetTextureSheet:function(t){return this.game.Assets.TextureSheets[t]},GetSound:function(t){return this.game.Assets.Sounds[t].audio}},this.game.Files={},this.textures=this.game.Assets.Textures={},this.texturePacks=this.game.Assets.TexturePacks={},this.textureSheets=this.game.Assets.TextureSheets={},this.sound=this.game.Assets.Sounds={},this.audio=this.game.Assets.Audio={},this.Stack=[],this.finish_stack=0,this.progress=0,this.loaded=!1,this.loadLog=""}return t.prototype.Sound=function(t,e){return this.sound[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"sound",id:e,path:t}),this.finish_stack++},t.prototype.Audio=function(t,e){return this.audio[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"audio",id:e,path:t}),this.finish_stack++},t.prototype.Texture=function(t,e){var i,r,n,o,s;if("string"==typeof t)return this.Stack.push({_torch_asset:"texture",id:e,path:t}),this.finish_stack++;for(s=[],i=r=0,n=t.length;r<n;i=++r)o=t[i],s.push(this.Texture(t[i][0],t[i][1]));return s},t.prototype.PixlTexture=function(t,e,i){var r;return r=pixl(t,e).src,this.Stack.push({_torch_asset:"texture",id:i,path:r})},t.prototype.TexturePack=function(t,e,i,r){var n,o,s,h;for(o=[],n=1;n<=i;)h=t+"_"+n.toString()+"."+r,s=e+"_"+n.toString(),this.Stack.push({_torch_asset:"texture",id:s,path:h}),o.push(s),this.finish_stack++,n++;return this.texturePacks[e]=o},t.prototype.TextureSheet=function(t,e,i,r,n,o){var s,h,a,u,c,p;for(i+=n,u=r/o,s=i/n,c=[],this.Stack.push({_torch_asset:"texture",id:e,path:t}),h=a=0;h<s;){for(;a<u;)p={clipX:h*n,clipY:a*o,clipWidth:n,clipHeight:o},c.push(p),a++;h++}return this.textureSheets[e]=c},t.prototype.File=function(t,e){return this.finish_stack++,this.Stack.push({_torch_asset:"file",id:e,path:t})},t.prototype.LoadItemFinished=function(){var t;if(this.finish_stack--,this.progress=(this.totalLoad-this.finish_stack)/this.totalLoad,this.game.Emit("LoadProgressed",new Torch.Event(this.game,{progress:this.progress})),this.finish_stack<=0)return document.getElementsByClassName("font-loader")[0].remove(),this.loadFinished(),t=((new Date).getTime()-this.startTime)/1e3,console.log("%c"+this.game.name+" loaded in "+t+"s","background-color:green; color:white; padding:2px;padding-right:5px;padding-left:5px")},t.prototype.Load=function(t){var e,i,r,n,o,s,h,a,u;this.loadFinished=t,this.totalLoad=this.finish_stack,this.startTime=(new Date).getTime();try{for(h=this.Stack,a=[],n=0,o=h.length;n<o;n++)switch(u=h[n],u._torch_asset){case"texture":r=new Image,r.src=u.path,u.image=r,this.textures[u.id]=u,r.refId=u.id,r.stackItem=u,r.loader=this,a.push(r.onload=function(){return this.loader.textures[this.stackItem.id].width=this.width,this.loader.textures[this.stackItem.id].height=this.height,this.loader.LoadItemFinished()});break;case"sound":e=new Audio,e.src=u.path,u.audio=e,this.sound[u.id]=u,this.LoadItemFinished(),a.push(e.toggle=function(){return this.currentTime=0,this.play()});break;case"audio":s=new Torch.AjaxLoader(u.path,Torch.AjaxData.ArrayBuffer),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.audio[i.stackItem.id]={},t.audio[i.stackItem.id].encodedAudioData=e,t.game.Audio.DecodeAudioData(e,function(e){return t.audio[i.stackItem.id].audioData=e,t.LoadItemFinished()})}}(this)),a.push(s.Load());break;case"file":Torch.ELECTRON?a.push(Torch.fs.readFile(u.path,"utf8",function(t){return function(e,i){return t.LoadItemFinished(),e?t.game.FatalError(new Error("Torch.Load.File file '{0}' could not be loaded".format(u.path))):t.game.Files[u.id]=i}}(this))):(s=new Torch.AjaxLoader(u.path,Torch.AjaxData.Text),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.LoadItemFinished(),t.game.Files[i.stackItem.id]=e}}(this)),a.push(s.Load()));break;default:a.push(void 0)}return a}catch(t){return i=t,console.log("%c"+this.game.name+" could not load!","background-color:"+Torch.Color.Ruby+"; color:white; padding:2px;padding-right:5px;padding-left:5px"),Torch.FatalError(i)}},t}(),Torch.Load=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0}return t.prototype.GetViewRectangle=function(){return new Torch.Rectangle(-this.x,-this.y,this.width,this.height)},t.prototype.HalfWidth=function(){return this.width/2},t.prototype.HalfHeight=function(){return this.height/2},t}(),Torch.Viewport=t}.call(this),function(){var t,e;e=function(){function t(t){this.game=t,this.futureEvents=[]}return t.prototype.Update=function(){var t,e,i,r,n;for(r=this.futureEvents,n=[],e=0,i=r.length;e<i;e++)t=r[e],n.push(t.Update());return n},t.prototype.SetFutureEvent=function(t,e){return this.futureEvents.push(new Torch.FutureEvent(t,e,this.game))},t}(),t=function(){function t(t,e,i){this.timeToOccur=t,this.handle=e,this.game=i,
this.time=0}return t.prototype.Update=function(){if(this.time+=this.game.deltaTime,this.time>=this.timeToOccur&&null!==this.handle&&void 0!==this.handle)return this.handle(),this.handle=null},t}(),Torch.Timer=e,Torch.FutureEvent=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.x=0,this.y=0,this.down=!1}return t.prototype.SetMousePos=function(t,e){var i;return i=t.getBoundingClientRect(),this.x=e.clientX-i.left,this.y=e.clientY-i.top},t.prototype.GetRectangle=function(){return new Torch.Rectangle(this.x-this.game.Viewport.x,this.y-this.game.Viewport.y,5,5)},t}(),Torch.Mouse=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.position=new Torch.Point(0,0)}return t.prototype.position=null,t.prototype.Update=function(){},t}(),Torch.Camera=t}.call(this),function(){var t,e;t=function(){function t(t){this.drawIndex=t,this.children=[],this.mapIndex-this.drawIndex}return t.prototype.DrawIndex=function(t){var e,i,r,n;if(!t)return this.drawIndex;for(this.drawIndex=t,n=this.children,i=0,r=n.length;i<r;i++)e=n[i],e.DrawIndex(t);return this},t.prototype.Add=function(t){return t.DrawIndex(this.index),this.children.push(t)},t}(),e=function(){function e(t){this.game=t,this.layers=[],this.layerMap={}}return e.prototype.Add=function(e){var i,r,n,o,s;if(r=null,"string"==typeof e)return r=new t(this.layers.length),this.layerName[e]=r,this.layers.add(r);for(s=[],i=0,n=e.length;i<n;i++)o=e[i],r=new t(this.layers.length),this.layerMap[o]=r,s.push(this.layers.add(r));return s},e.prototype.Remove=function(t,e){var i,r,n,o,s,h,a,u,c;if(this.layerMap[t]){for(i=[],h=layerMap[t],h.Trash(),delete this.layerMap[t],u=this.layers,c=[],n=r=0,a=u.length;r<a;n=++r)o=u[n],s=i[n],n!==h.mapIndex?(i.push(s),e?c.push(s.DrawIndex(s.DrawIndex()-1)):c.push(void 0)):c.push(void 0);return c}return Torch.FatalError("Unable to remove layer '"+t+"'. Layer does not exist")},e.prototype.Get=function(t){return this.layerMap[t]?this.layerMap[t]:Torch.FatalError("Unable to get layer '"+t+"'. Layer does not exist")},e}(),Torch.Layers=e}.call(this),function(){Torch.Style=function(){var t,e;return t=document.body,t.style.backgroundColor="black",t.style.overflow="hidden",e=document.getElementsByTagName("CANVAS")[0],e.style.border="1px solid orange",e.style.cursor="pointer"}}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.text="",this.CreateHtmlDisplay()}return t.prototype.CreateHtmlDisplay=function(){var t;return t=document.createElement("DIV"),t.style.position="absolute",t.style.display="block",t.style.color="white",t.style.font="monospace",t.style.top=0,document.body.appendChild(t),this.display=t},t.prototype.Update=function(){},t}(),Torch.Debug=t}.call(this),function(){var t,e,i;i=this,t=function(){function t(t){this.keyCode=t,this.InitEventDispatch()}return t.MixIn(Torch.EventDispatcher),t.prototype.down=!1,t}(),e=function(){function e(){this.specialKeys={8:"Delete",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"PauseBreak",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow",45:"Insert",46:"Delete2",48:"Num0",49:"Num1",50:"Num2",51:"Num3",52:"Num4",53:"Num5",54:"Num6",55:"Num7",56:"Num8",57:"Num9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",106:"NumPadMultiply",107:"NumPadPlus",109:"NumPadMinus",110:"NumPadPeriod",111:"NumPadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Colon",187:"NumPlus",188:"Comma",189:"NumMinus",190:"Period",191:"ForwardSlash",192:"Tilda",219:"BracketLeft",221:"BracketRight",220:"BackSlash",222:"Quote"},this.InitKeys()}return e.MixIn(Torch.EventDispatcher),e.prototype.SpecialKey=function(t){var e,i,r;i=this.specialKeys;for(e in i)if(r=i[e],t.toString()===e.toString())return this[r];return null},e.prototype.InitKeys=function(){var e,i,r,n,o,s,h;for(i=this,r=0;r<230;)e=String.fromCharCode(r).toUpperCase(),i[e]=new t(r),r++;o=this.specialKeys,s=[];for(n in o)h=o[n],s.push(i[h]=new t(n));return s},e}(),Torch.Keys=e}.call(this),function(){var t,e,i;Torch.Easing=Torch.Enum("Linear","Square","Cube","InverseSquare","InverseCube","Smooth","SmoothSquare","SmoothCube","Sine","InverseSine"),t=function(){function t(t,e,i,r,n){var o,s,h;this.game=t,this.objectToTween=e,this.tweenProperties=i,this.timeTweenShouldTake=r,this.easing=n,this.InitEventDispatch(),this.game.Tweens.tweens.push(this),this.originalObjectValues={},s=this.tweenProperties;for(o in s)h=s[o],this.originalObjectValues[o]=this.objectToTween[o]}return t.MixIn(Trashable),t.MixIn(EventDispatcher),t.prototype.objectToTween=null,t.prototype.tweenProperties=null,t.prototype.originalObjectValues=null,t.prototype.elapsedTime=0,t.prototype.timeTweenShouldTake=0,t.prototype.easing=null,t.prototype.Update=function(){var t,e,i,r,n;i=this.elapsedTime/this.timeTweenShouldTake,t=this.Ease(i),r=this.tweenProperties;for(e in r)n=r[e],this.objectToTween[e]=this.tweenProperties[e]*t+this.originalObjectValues[e]*(1-t);if(this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.timeTweenShouldTake)return this.Emit("Finish",new Torch.Event(this.game,{tween:this})),this.Trash()},t.prototype.Ease=function(t){switch(this.easing){case Torch.Easing.Linear:return t;case Torch.Easing.Square:return Math.pow(t,2);case Torch.Easing.Cube:return Math.pow(t,3);case Torch.Easing.InverseSquare:return 1-Math.pow(1-t,2);case Torch.Easing.InverseCube:return 1-Math.pow(1-t,3);case Torch.Easing.Smooth:return t*t*(3-2*t);case Torch.Easing.SmoothSquare:return Math.pow(t*t*(3-2*t),2);case Torch.Easing.SmoothCube:return Math.pow(t*t*(3-2*t),3);case Torch.Easing.Sine:return Math.sin(t*Math.PI/2);case Torch.Easing.InverseSine:return 1-Math.sin((1-t)*Math.PI/2)}},t}(),i=function(){function e(t,e,i,r){this.game=t,this.object=e,this.timeTweenShouldTake=i,this.easing=null!=r?r:Torch.Easing.Smooth}return e.prototype.To=function(e){return new t(this.game,this.object,e,this.timeTweenShouldTake,this.easing)},e.prototype.From=function(t){var e,i;for(e in t)i=t[e],this.object[e]=i;return this},e}(),e=function(){function t(t){this.game=t,this.tweens=[]}return t.prototype.Update=function(){var t,e,i,r,n,o;for(t=[],r=this.tweens,n=[],e=0,i=r.length;e<i;e++)o=r[e],o.trash?n.push(void 0):(t.push(o),n.push(o.Update()));return n},t.prototype.Tween=function(t,e){return new i(this.game,t,e)},t.prototype.All=function(t){var e,i,r,n,o;for(r=this.game.tweens,n=[],e=0,i=r.length;e<i;e++)o=r[e],n.push(t(o));return n},t}(),Torch.TweenManager=e}.call(this),function(){var t,e,i=function(t,e){function i(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function e(t,e,i,r,n,o,s){this.game=t,this.interval=r,this.loop=n,this.particle=o,this.config=s,this.InitSprite(this.game,e,i),this.elapsedTime=0,this.hasEmitted=!1}return i(e,t),e.prototype.particle=null,e.prototype.auto=!0,e.prototype.Update=function(){if(e.__super__.Update.call(this),void 0!==this.interval){if(!this.hasEmitted)return this.UpdateParticleEmitter();if(this.loop)return this.UpdateParticleEmitter()}},e.prototype.Particle=function(t){return t=t},e.prototype.UpdateParticleEmitter=function(){if(this.auto)return this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.interval?(this.EmitParticles(),this.hasEmitted=!0,this.elapsedTime=0):void 0},e.prototype.EmitParticles=function(t){var e;for(null==t&&(t=!1),e=0;e<this.config.spread;)e++,this.EmitParticle();if(t)return this.Trash()},e.prototype.EmitParticle=function(){var t,e,i,r,n,o,s;return e=Torch.RandomInRange(this.config.minAngle,this.config.maxAngle),n=Torch.RandomInRange(this.config.minScale,this.config.maxScale),t=Torch.RandomInRange(this.config.minAlphaDecay,this.config.maxAlphaDecay),r=Torch.RandomInRange(this.config.minRadius,this.config.maxRadius),o=this.position.x,s=this.position.y,"string"!=typeof this.particle?i=new this.particle(this.game,o,s):(i=new Torch.Sprite(this.game,o,s),i.Bind.Texture(this.particle)),i.Body.velocity.x=Math.cos(e)*Torch.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.velocity.y=Math.sin(e)*Torch.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.omega=Torch.RandomInRange(this.config.minOmega,this.config.maxOmega),i.Size.scale.width=n,i.Size.scale.height=n,i.drawIndex=1e3,this.game.Tweens.Tween(i,t,Torch.Easing.Smooth).To({opacity:0}).On("Finish",function(){return i.Trash()})},e}(Torch.Sprite),e=function(){function e(t){this.game=t}return e.prototype.ParticleEmitter=function(e,i,r,n,o,s){return new t(this.game,e,i,r,n,o,s)},e}(),Torch.ParticleManager=e}.call(this),function(){var t,e,i,r=[].slice;i=function(){function t(t){this.soundId=t}return t.prototype.volume=1,t.prototype.pan=0,t}(),t=function(){function t(t){this.game=t,this.GetAudioContext()}return t.prototype.audioContext=null,t.prototype.MasterVolume=1,t.prototype.GetAudioContext=function(){var t;try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext}catch(e){return t=e,console.warn("Unable to initialize audio...")}},t.prototype.DecodeAudioData=function(t,e){return this.audioContext.decodeAudioData(t,function(t){return e(t)})},t.prototype.CreateAudioPlayer=function(){return new e(this)},t}(),e=function(){function t(t){this.audioContext=t.audioContext,this.game=t.game}return t.prototype.volume=1,t.prototype.CreateGain=function(t){var e;return null==t&&(t=1),e=this.audioContext.createGain(),e.gain.value=t,e},t.prototype.Play=function(t){return this.game.FatalError("Cannot play sound. sound must be Torch.Sound")},t.prototype.PlaySound=function(t,e,i){var n,o,s,h,a,u;for(null==e&&(e=0),null==i&&(i=null),u=this.audioContext.createBufferSource(),u.buffer=this.game.Assets.Audio[t].audioData,1!==this.game.Audio.MasterVolume&&(null===i?i=[this.CreateGain(this.game.Audio.MasterVolume)]:i.push(this.CreateGain(this.game.Audio.MasterVolume))),i=null===i?[this.CreateGain(this.volume)]:r.call(i).concat([this.CreateGain(this.volume)]),h=null,s=o=0,a=i.length;o<a;s=++o)if(n=i[s],null===h?u.connect(n):h.connect(n),h=n,s===i.length-1)return n.connect(this.audioContext.destination),void u.start(e);return u.connect(this.audioContext.destination),u.start(e)},t}(),Torch.Audio=t}.call(this),function(){var t;t=function(){function t(t){this.game=t,this.positionTransform=new Torch.Point(0,0)}return t.prototype.positionTransform=null,t}(),Torch.HookManager=t}.call(this),function(){var t;t=function(){function t(t,e,i,r,n,o){this.canvasId=t,this.width=e,this.height=i,this.name=r,this.graphicsType=n,this.pixel=null!=o?o:0,this.InitGame()}return t.MixIn(Torch.EventDispatcher),t.prototype.InitGame=function(){return this.InitEventDispatch(),this.InitGraphics(),this.InitComponents()},t.prototype.InitComponents=function(){var t,e;return e="background-color:orange; color:white; padding:2px; padding-right:5px;padding-left:5px",t="WebGL",this.graphicsType===Torch.CANVAS&&(t="Canvas"),console.log("%c Torch v"+Torch.version+" |"+t+"| - "+this.name,e),this.Loop=new Torch.Loop(this),this.Load=new Torch.Load(this),this.Viewport=new Torch.Viewport(this),this.Mouse=new Torch.Mouse(this),this.Timer=new Torch.Timer(this),this.Camera=new Torch.Camera(this),this.Layers=new Torch.Layers(this),this.Debug=new Torch.Debug(this),this.Keys=new Torch.Keys(this),this.Tweens=new Torch.TweenManager(this),this.Particles=new Torch.ParticleManager(this),this.Audio=new Torch.Audio(this),this.Hooks=new Torch.HookManager(this),Torch.Style(),this.deltaTime=0,this.fps=0,this.averageFps=0,this.allFPS=0,this.ticks=0,this.zoom=1,this.uidCounter=0,this.paused=!1,this.time=null,this.LastTimeStamp=null,this.spriteList=[],this.threeList=[],this.taskList=[],this.animations=[],this.tweens=[],this.DrawStack=[],this.AddStack=[],this.GamePads=[],this.events={},this.filter={}},t.prototype.InitGraphics=function(){return this.canvasNode=document.createElement("CANVAS"),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,document.getElementById(this.canvasId).appendChild(this.canvasNode),this.canvas=this.canvasNode.getContext("2d"),this.Clear("#cc5200")},t.prototype.PixelScale=function(){return this.canvas.webkitImageSmoothingEnabled=!1,this.canvas.mozImageSmoothingEnabled=!1,this.canvas.imageSmoothingEnabled=!1,this},t.prototype.Bounds=function(t){return void 0===t&&(this.BoundRec=this.Viewport.GetViewRectangle()),this},t.prototype.Start=function(t,e,i,r){if(void 0===t&&this.FatalError("Unable to start game '"+this.name+"' without load function"),void 0===e&&this.FatalError("Unable to start game '"+this.name+"' without update function"),void 0===i&&this.FatalError("Unable to start game '"+this.name+"' without draw function"),void 0===r&&this.FatalError("Unable to start game '"+this.name+"' without update function"),this.load=t,this.update=e,this.draw=i,this.init=r,this.load(this),this.Load.Load(function(t){return function(){return t.init(t),t.WireUpEvents(),t.Run()}}(this)),this.graphicsType!==Torch.WEBGL)return this.canvasNode.width=this.width,this.canvasNode.height=this.height,"string"==typeof this.width&&(this.canvasNode.width=document.body.clientWidth-50),"string"==typeof this.height&&(this.canvasNode.height=document.body.clientHeight-25),this.Viewport.width=this.canvasNode.width,this.Viewport.height=this.canvasNode.height},t.prototype.Add=function(t){return void 0!==t&&void 0!==t._torch_add||this.FatalError("Cannot add object: "+t.constructor.name+" to game"),"Sprite"===t._torch_add?(t._torch_uid="TORCHSPRITE"+this.uidCounter.toString(),t._torch_add_order=this.uidCounter,this.AddStack.push(t),this.uidCounter++):"Three"===t._torch_add?(t.game=this,this.gl_scene.add(t.entity)):"Task"===t._torch_add?this.taskList.push(t):void 0},t.prototype.Task=function(t){return this.taskList.push(t),this},t.prototype.Run=function(t){return this.Loop.Run(0)},t.prototype.FlushSprites=function(){var t,e,i,r,n;for(i=this.spriteList,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(n.Trash());return r},t.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),this.Clear("#000"),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302Cmargin-left:15%font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302Cfont-size:20pxfont-weight:bold'>Stack Trace:</code>\n<br>\n<code style='color:#C9302Cfont-size:20px'>"+i+"</code>\n<br>\n<code style='color:#C9302Cfont-size:18px'>Time: "+this.time+"</code>",document.body.innerHTML=e,this.RunGame=function(){},this.Run=function(){},this.Emit("FatalError",new Torch.Event(this,{error:t})),t},t.prototype.UpdateTasks=function(){var t,e,i,r,n;for(t=[],r=this.taskList,e=0,i=r.length;e<i;e++)n=r[e],n.Execute(this),n.trash||t.push(n);return this.taskList=t},t.prototype.UpdateSprites=function(){var t,e,i,r,n,o,s,h,a;for(t=[],s=this.spriteList,e=0,r=s.length;e<r;e++)a=s[e],a.trash?(a.trashed=!0,a.Emit("Trash",new Torch.Event(this))):(a.game.paused||a.Update(),t.push(a));for(this.spriteList=t,h=this.AddStack,i=0,n=h.length;i<n;i++)o=h[i],this.spriteList.push(o);return this.AddStack=[]},t.prototype.DrawSprites=function(){var t,e,i,r,n;for(this.canvas.clearRect(0,0,this.Viewport.width,this.Viewport.height),this.spriteList.sort(function(t,e){return t.drawIndex===e.drawIndex?t._torch_add_order-e._torch_add_order:t.drawIndex-e.drawIndex}),i=this.spriteList,r=[],t=0,e=i.length;t<e;t++)n=i[t],!n.draw||n.trash||n.GHOST_SPRITE?r.push(void 0):r.push(n.Draw());return r},t.prototype.UpdateAnimations=function(){var t,e,i,r,n;for(r=this.animations,n=[],e=0,i=r.length;e<i;e++)t=r[e],n.push(t.Run());return n},t.prototype.UpdateTimeInfo=function(){return this.fps=Math.round(1e3/this.deltaTime),this.fps===1/0?this.allFPS+=0:this.allFPS+=Math.round(1e3/this.deltaTime),this.ticks++,this.averageFps=Math.round(this.allFPS/this.ticks)},t.prototype.UpdateGamePads=function(){var t,e,i,r,n;if(navigator.getGamepads&&(navigator.getGamepads,!0)){for(this.GamePads=[],r=navigator.getGamepads(),n=[],t=0,e=r.length;t<e;t++)i=r[t],i?n.push(this.GamePads.push(new Torch.GamePad(i))):n.push(void 0);return n}},t.prototype.Clear=function(t){return void 0===t&&this.FatalError("Cannot clear undefined color"),"object"==typeof t&&(t=t.hex),this.canvasNode.style.backgroundColor=t,this},t.prototype.File=function(t){return void 0===this.Files[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Files[t]},t.prototype.Sound=function(t){return void 0===this.Assets.Sounds[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Assets.Sounds[t].audio},t.prototype.getCanvasEvents=function(){var t;return t=[["mousemove",function(t){return function(e){return t.Mouse.SetMousePos(t.canvasNode,e),t.Emit("MouseMove",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mousedown",function(t){return function(e){return t.Mouse.down=!0,t.Emit("MouseDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mouseup",function(t){return function(e){return t.Mouse.down=!1,t.Emit("MouseUp",new Torch.Event(t,{nativeEvent:e}))}}(this)],["touchstart",function(t){return function(e){return t.Mouse.down=!0}}(this)],["touchend",function(t){return function(e){return t.Mouse.down=!1}}(this)],["click",function(t){return function(e){return e.preventDefault(),e.stopPropagation(),t.Emit("Click",new Torch.Event(t,{nativeEvent:e})),!1}}(this)]]},t.prototype.getBodyEvents=function(){var t;return t=[["keydown",function(t){return function(e){var i,r;return i=e.keyCode,r=t.Keys.SpecialKey(i),null===r&&(r=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),r.down=!0,r.Emit("KeyDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["keyup",function(t){return function(e){var i,r;return i=e.keyCode,r=t.Keys.SpecialKey(i),null===r&&(r=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),r.down=!1,r.Emit("KeyUp",new Torch.Event(t,{nativeEvent:e}))}}(this)]]},t.prototype.WireUpEvents=function(){var t,e,i,r,n,o,s,h,a;for(s=this.getCanvasEvents(),e=0,r=s.length;e<r;e++)t=s[e],this.canvasNode.addEventListener(t[0],t[1],!1);for(h=this.getBodyEvents(),i=0,n=h.length;i<n;i++)t=h[i],document.body.addEventListener(t[0],t[1],!1);return a=function(t){return function(e){return t.Viewport.width=window.innerWidth,t.Viewport.height=window.innerHeight,t.Emit("Resize",new Torch.Event(t,{nativeEvent:e}))}}(this),window.addEventListener("resize",a,!1),o=navigator.getGamepads()},t.prototype.TogglePause=function(){return this.paused?this.paused=!1:this.paused=!0,this},t}(),Torch.CanvasGame=t}.call(this),function(){var t,e=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=function(t){function i(t,e,i,r,n,o){this.canvasId=t,this.width=e,this.height=i,this.name=r,this.graphicsType=n,this.pixel=null!=o?o:0,this.InitGame()}return e(i,t),i.prototype.InitGraphics=function(){return this.gl_rendererContainer=document.getElementById(this.canvasId),this.gl_scene=new THREE.Scene,this.gl_scene.add(new THREE.AxisHelper(100)),this.gl_camera=new THREE.PerspectiveCamera(100,window.innerWidth/window.innerHeight,1,1e3),this.gl_camera.position.z=600,this.gl_renderer=new THREE.WebGLRenderer({antialias:this.pixel!==Torch.PIXEL,alpha:!0}),this.gl_renderer.setSize(window.innerWidth,window.innerHeight),this.gl_renderer.setPixelRatio(window.devicePixelRatio),this.canvasNode=this.gl_renderer.domElement,this.gl_rendererContainer.appendChild(this.canvasNode),this.On("Resize",function(t){return function(e){return t.gl_renderer.setSize(t.Viewport.width,t.Viewport.height),t.gl_camera.aspect=t.Viewport.width/t.Viewport.height,t.gl_camera.updateProjectionMatrix()}}(this))},i.prototype.DrawSprites=function(){var t,e,i,r;for(this.spriteList.sort(function(t,e){return t.drawIndex-e.drawIndex}),i=this.spriteList,t=0,e=i.length;t<e;t++)r=i[t],!r.draw||r.trash||r.GHOST_SPRITE||r.Draw(),r.trash&&r.Three().Remove();return this.gl_camera.lookAt(this.gl_scene.position),this.gl_renderer.render(this.gl_scene,this.gl_camera)},i.prototype.UpdateSprites=function(){var t,e,i,r,n;for(t=[],r=this.spriteList,e=0,i=r.length;e<i;e++)n=r[e],n.trash?(void 0!==n.Three()&&n.Three().Remove(),n.trashed=!0,n.Emit("Trash")):(n.game.paused||n.Update(),t.push(n));return this.spriteList=t},i.prototype.GetThreeTransform=function(t,e){var i,r,n,o,s;return s=new THREE.Vector3,i=this.gl_camera,s.set(t/window.innerWidth*2-1,2*-(e/window.innerHeight)+1,1),s.unproject(i),r=s.sub(i.position).normalize(),n=-i.position.z/r.z,o=i.position.clone().add(r.multiplyScalar(n))},i}(Torch.CanvasGame),Torch.WebGLGame=t}.call(this),function(){var t;t=function(){function t(t,e,i,r,n,o){return n===Torch.CANVAS?new Torch.CanvasGame(t,e,i,r,n,o):n===Torch.WEBGL?new Torch.WebGLGame(t,e,i,r,n,o):void 0}return t}(),Torch.Game=t}.call(this),function(){var t,e,i,r,n,o,s=function(t,e){function i(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;o=this,Torch.Platformer={Gravity:.001,SHIFT_COLLIDE_LEFT:5,SetWorld:function(t){return Torch.Platformer.spawnItems=t}},t=function(){function t(){throw"Actor is a base class"}return t.prototype.ACTOR=!0,t.prototype.Health=100,t.prototype.currentFriction=1,t.prototype.inFluid=!1,t.prototype.onGround=!1,t.prototype.onLeft=!1,t.prototype.onTop=!1,t.prototype.onRight=!1,t.prototype.hitLockCounter=0,t.prototype.hitLockBlinkCounter=0,t.prototype.hitLock=!1,t.prototype.hitLockMax=1e3,t.prototype.HitLock=function(){return this.hitLock=!0},t.prototype.Hit=function(t){if(null==t&&(t=1),this.Health-=t,this.Health<=0)return this.Die},t.prototype.Die=function(){return this.isDead=!0},t.prototype.BlockCollision=function(t,e){if(e&&e.vx<e.halfWidths&&e.vy<e.halfHeights)if(e.x<e.y){if(this.Body.Velocity("y",0),e.vx>0)return t.Sprite.Slope?this.BlockSlope(t.Sprite,e):(this.Rectangle.x+=e.x+Torch.Platformer.SHIFT_COLLIDE_LEFT,this.Body.Velocity("x",0),this.onLeft=!0);if(e.vx<0)return t.Sprite.Slope?this.BlockSlope(t.Sprite,e):(this.Rectangle.x-=e.x,this.Body.Velocity("x",0),this.onRight=!0)}else if(e.x>e.y){if(e.vy>0)return this.Rectangle.y+=e.y,this.Body.Velocity("y",0);if(e.vy<0){if(t.Sprite.Slope)return this.BlockSlope(t.Sprite,e);if(this.Rectangle.y-=e.y-t.Sprite.sink,this.Body.Acceleration("y",0).Velocity("y",0),this.onGround=!0,!this.inFluid)return this.currentFriction=t.Sprite.friction}}},t.prototype.BlockSlope=function(t,e){var i;return i=e.x*Math.tan(t.Slope),this.Rectangle.y=t.Rectangle.y+(t.Rectangle.height-i)-this.Rectangle.height,this.onSlope=!0},t.prototype.FluidCollision=function(t,e){if(e)return this.currentFriction=t.Sprite.friction,this.Body.y.acceleration=t.Sprite.gravity,this.inFluid=!0},t.prototype.UpdateActor=function(){var t,e,i,r,n,o;for(this.inFluid=!1,this.onGround=!1,this.onTop=!1,this.onRight=!1,this.onLeft=!1,o=Torch.Platformer.spawnItems,t=0,i=o.length;t<i;t++)e=o[t],n=this.Rectangle,e.spawned&&e.Sprite&&e.Sprite.BLOCK&&this.NotSelf(e.Sprite)&&this.ACTOR&&(r=this.Rectangle.Intersects(e.Sprite.Rectangle),this.BlockCollision(e,r)),e.spawned&&e.Sprite&&e.Sprite.FLUID&&this.NotSelf(e.Sprite)&&this.ACTOR&&(r=this.Rectangle.Intersects(e.Sprite.Rectangle),this.FluidCollision(e,r)),this.onGround||this.inFluid||(this.Body.y.acceleration=Torch.Platformer.Gravity);if(this.hitLock&&(this.hitLockCounter+=Game.deltaTime,this.hitLockBlinkCounter+=Game.deltaTime,this.hitLockBlinkCounter>=200&&(.1===this.opacity?this.opacity=.8:this.opacity=.1,this.hitLockBlinkCounter=0),this.hitLockCounter>=this.hitLockMax))return this.hitLock=!1,this.opacity=1,this.hitLockCounter=0,this.hitLockBlinkCounter=0},t}(),e=function(){function t(){throw"Block is a base class"}return t.prototype.BLOCK=!0,t.prototype.friction=1,t.prototype.sink=0,t}(),i=function(){function t(){throw"Fluid is a base class"}return t.prototype.FLUID=!0,t.prototype.friction=.3,t.prototype.gravity=1e-4,t.prototype.drawIndex=30,t}(),n=function(t){function e(t){this.spawnItems=t,Torch.Platformer.SetWorld(this.spawnItems)}return s(e,t),e}(Torch.GhostSprite),r=function(){function t(t,e,i,r){this.spawnType=t,this.spawned=e,this.obj=i,this.position=r,this.obj&&(this.Sprite=this.obj)}return t}(),o.Facing=Torch.Enum("Right","Left"),o.Walking=Torch.Enum("Right","Left","None"),Torch.Platformer.Actor=t,Torch.Platformer.Block=e,Torch.Platformer.Fluid=i,Torch.Platformer.Spawner=n,Torch.Platformer.spawnItem=r}.call(this),function(){}.call(this),function(){var t,e=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;Torch.Sound={},t=function(t){function i(t,e){this.game=t,this.songList=e,this.currentSong=this.songList[0],this.index=0}return e(i,t),i.prototype.Play=function(){return this.game.Assets.GetSound(this.currentSong).volume=.7,this.game.Assets.GetSound(this.currentSong).play(),this},i.prototype.ShuffleArray=function(t){var e,i,r;for(e=t.length,r=null,i=null;0!==e;)i=Math.floor(Math.random()*e),e-=1,r=t[e],t[e]=t[i],t[i]=r;return t},i.prototype.Randomize=function(){return this.songList=this.ShuffleArray(this.songList),this.currentSong=this.songList[0],this},i.prototype.Update=function(){if(this.game.Assets.GetSound(this.currentSong).currentTime>=this.game.Assets.GetSound(this.currentSong).duration&&(this.index++,this.currentSong=this.songList[this.index],this.Play(),this.index===this.songList.length-1))return this.index=0},i}(Torch.GhostSprite)}.call(this),function(){var t,e,i=[].slice;e=function(){function t(t){this.obj=t,this.currentState=null,this.states={},this.game=this.obj.game}return t.prototype.State=function(t,e){return void 0===e?(void 0===this.states[t]&&Torch.FatalError("Unable to get state. State '"+t+"' has not been added to the state machine"),this.states[t]):(e.stateMachine=this,e.game=this.game,this.states[t]=e)},t.prototype.Switch=function(){var t,e,r,n;return e=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],this.currentState&&void 0!==this.currentState.End&&(r=this.currentState).End.apply(r,[this.obj].concat(i.call(t))),void 0!==this.State(e).Start&&(n=this.State(e)).Start.apply(n,[this.obj].concat(i.call(t))),this.currentState=this.State(e)},t.prototype.Update=function(){if(null!==this.currentState&&void 0!==this.currentState)return this.currentState.Execute(this.obj)},t}(),t=function(){function t(t,e,i){this.Execute=t,this.Start=e,this.End=i}return t}(),Torch.StateMachine=e,Torch.StateMachine.State=t}.call(this),function(){var t,e,i,r=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;t=function(){function t(t){return t.GL?new i(t):new e(t)}return t}(),e=function(){function t(t){this.sprite=t}return t.prototype.Reset=function(){if(this.sprite.TextureSheetAnimation&&(this.sprite.TextureSheetAnimation.Stop(),this.sprite.anim=null,this.sprite.TextureSheet=null),this.sprite.TexturePackAnimation)return this.sprite.TexturePackAnimation.Stop(),this.sprite.anim=null,this.sprite.TexturePack=null},t.prototype.Texture=function(t,e){var i,r;return r=null,"string"==typeof t?(r=this.sprite.game.Assets.Textures[t],r||this.sprite.game.FatalError("Sprite.Bind.Texture given textureId '"+t+"' was not found")):r=t,i=1,this.Reset(),Torch.Scale&&!this.sprite.TEXT&&this.sprite.Size.Scale(Torch.Scale,Torch.Scale),"string"==typeof t?this.sprite.DrawTexture=r:this.sprite.DrawTexture={image:t},this.sprite.Size.Set(r.width,r.height),this.sprite.DrawTexture},t.prototype.TexturePack=function(){},t.prototype.TextureSheet=function(t,e){var i,r,n;return null==e&&(e={}),n=this.sprite.game.Assets.TextureSheets[t],r=this.sprite.game.Assets.Textures[t],n&&r?(this.sprite.DrawTexture=r,this.sprite.TextureSheet=n):this.sprite.game.FatalError("Sprite.Bind.TextureSheet given textureSheetId '"+t+"' was not found"),i=new Torch.Animation.TextureSheet(this.sprite.TextureSheet,this.sprite.game),i.sprite=this.sprite,e.delay&&(i.delay=e.delay,i.delayCount=i.delay),e.step&&(i.step=e.step),i.Start(),this.sprite.TextureSheetAnimation=i,this.sprite.rectangle.width=i.GetCurrentFrame().clipWidth*Torch.Scale,this.sprite.rectangle.height=i.GetCurrentFrame().clipHeight*Torch.Scale,i},t}(),i=function(t){function e(t){this.sprite=t}return r(e,t),e.prototype.Texture=function(t){var e,i,r,n,o;return n=null,i=null,t.gl_2d_canvas_generated_image?(n=t,i=t.texture):(n=this.sprite.game.Assets.Textures[t],i=this.sprite.game.Assets.Textures[t].gl_texture),this.sprite.Scale()?(o=n.width*this.sprite.Scale(),e=n.height*this.sprite.Scale()):(o=n.width*Torch.Scale,e=n.height*Torch.Scale),this.sprite.gl_shape=new THREE.PlaneGeometry(o,e,8,8),r=new THREE.MeshPhongMaterial({map:i}),r.transparent=!0,this.sprite.gl_three_sprite=new Torch.ThreeSprite(this.sprite,r,this.sprite.gl_shape),this.sprite.gl_orig_width=o,this.sprite.gl_orig_height=e,this.sprite.rectangle.width=o,this.sprite.rectangle.height=e},e}(e),Torch.Bind=t}.call(this),function(){var t,e,i,r,n=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=function(){function t(t){this.game=t}return t.prototype.Run=function(){if(this.animating&&this.Update(),this.Kill&&this.hasRun)return this.Stop()},t.prototype.Start=function(){return this.animating=!0},t.prototype.Stop=function(){return this.animating=!1},t.prototype.Single=function(){return this.KillOnFirstRun=!0,this.animating=!0},t.prototype.Reset=function(){return this.elapsedTime=0,this.textureListIndex=0,this.hasRun=!1},t}(),i=function(t){function e(t,e){this.texturePack=t,this.game=e,this.step=50,this.maxIndex=texturePack.length-1,this.textureIndex=0,this.elapsedTime=0,this.game.animations.push(this)}return n(e,t),e.prototype.Update=function(){if(this.elapsedTime+=this.game.deltaTime,this.elapsedTime>=this.step&&(this.elapsedTime=0,this.textureIndex++),this.textureIndex>this.maxIndex)return this.Kill||(this.textureIndex=0),this.Kill&&(this.textureIndex=-1),this.hasRun=!0},e.prototype.GetCurrentFrame=function(){return this.game.Assets.Textures[this.texturePack[this.textureIndex]]},e}(t),r=function(t){function e(t,e){this.TextureSheet=t,this.game=e,this.step=50,this.maxIndex=this.TextureSheet.length-1,this.textureIndex=0,this.elapsedTime=0,this.delay=0,this.delayCount=0,this.onStep=null,this.game.animations.push(this)}return n(e,t),e.prototype.Update=function(){return this.elapsedTime+=this.game.deltaTime,!(this.elapsedTime>=this.step)||this.hasRun&&this.Kill||(this.elapsedTime=0,this.textureIndex++,this.onStep&&this.onStep(this.textureIndex)),this.textureIndex>=this.maxIndex&&this.delayCount<=0?(this.Kill||(this.textureIndex=0),this.hasRun=!0,this.finishCallBack&&this.finishCallBack(),this.delayCount=this.delay):this.textureIndex>=this.maxIndex?(this.delayCount-=Game.deltaTime,this.textureIndex--):void 0},e.prototype.GetCurrentFrame=function(){if(this.TextureSheet)return this.TextureSheet[this.textureIndex]},e.prototype.Step=function(t,e){return void 0===t?this.step:(this.step=t,void 0!==e&&(this.onStep=e),this)},e}(t),e=function(t){function e(t,e,i,r,n){this.InitSprite(t,0,0),this.steps=i,this.totalTime=e,this.interval=e/i.length,this.time=0,this.index=0,this.steps[0](),this.start=r,this.end=n,r&&this.start()}return n(e,t),e.prototype.Update=function(){if(this.time+=this.game.deltaTime,this.time>=this.interval&&(this.time=0,this.index++,this.steps[this.index](),this.index===this.steps.length-1))return this.end&&this.end(),this.Trash()},e}(Torch.GhostSprite),Torch.Animation=t,Torch.Animation.TextureSheet=r,
Torch.Animation.TexturePack=i,Torch.Animation.StepAnimation=e}.call(this),function(){var t;t=function(){function t(t,e,i,r){this.hex="",this.Red=0,this.Green=0,this.Blue=0,this.Alpha=1,this.Init(t,e,i,r)}return t.prototype.Init=function(t,e,i,r){return void 0===e&&null!==e?this.GetHexFromRGB(t,e,i,r):this.GetRGBFromHex(t)},t.prototype.GetHexadecimal=function(t,e){var i;return i=Math.round(t*e).toString(16),1===i.length&&(i="0"+i),i},t.prototype.GetHexFromRGB=function(t,e,i,r){return this.Red=t,this.Green=e,this.Blue=i,this.Alpha=r,this.hex="#"+this.GetHexadecimal(t,r)+this.GetHexadecimal(e,r)+this.GetHexadecimal(i,r)},t.prototype.GetRGBFromHex=function(){},t.prototype.BlendHex=function(){return this.GetRGBFromHex(this.hex)},t.prototype.BlendRGB=function(){return this.GetHexFromRGB(this.Red,this.Green,this.Blue,this.Alpha)},t.prototype.GetRGBString=function(){return"rgba("+this.Red+","+this.Green+","+this.Blue+","+this.Alpha+");"},t}(),t.Red=new t(256,0,0,1),t.Green=new t(0,256,0,1),t.Blue=new t(0,0,256,1),t.Flame=new t("#ff8000"),t.Ruby=new t("#e60000"),Torch.Color=t}.call(this),function(){var t;t=function(){function t(){}return t.Import=function(){return Torch.ELECTRON=!0,Torch.fs=require("fs")},t}(),Torch.Electron=new t}.call(this),function(){var t,e;e=this,t=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.previousPosition=new Torch.Point(this.sprite.position.x,this.sprite.position.y)}return t.prototype.Draw=function(){var t,e,i;return e=new Torch.Rectangle(this.sprite.position.x,this.sprite.position.y,this.sprite.rectangle.width,this.sprite.rectangle.height),e.x=(this.sprite.position.x-this.previousPosition.x)*this.game.Loop.lagOffset+this.previousPosition.x,e.y=(this.sprite.position.y-this.previousPosition.y)*this.game.Loop.lagOffset+this.previousPosition.y,this.previousPosition=new Torch.Point(this.sprite.position.x,this.sprite.position.y),t=new Torch.Point(0,0),this.sprite.fixed||(e.x+=this.game.Camera.position.x+this.game.Hooks.positionTransform.x,e.y+=this.game.Camera.position.y+this.game.Hooks.positionTransform.y),this.sprite.TextureSheet?(i=this.sprite.GetCurrentDraw(),this.PreRender(e),canvas.drawImage(this.sprite.DrawTexture.image,i.clipX,i.clipY,i.clipWidth,i.clipHeight,-e.width/2,-e.height/2,e.width,e.height),this.PostRender()):this.sprite.DrawTexture?(this.PreRender(e),this.game.canvas.drawImage(this.sprite.DrawTexture.image,-e.width/2,-e.height/2,e.width,e.height),this.sprite.Body.DEBUG,1,this.PostRender()):void 0},t.prototype.PreRender=function(t){var e;return e=this.game.canvas,e.save(),e.translate(t.x+t.width/2,t.y+t.height/2),null!==this.sprite.Effects.tint.color&&(this.game.canvas.fillStyle=this.sprite.Effects.tint.color,this.game.canvas.globalAlpha=this.sprite.Effects.tint.opacity,this.game.canvas.globalCompositeOperation="destination-atop",this.game.canvas.fillRect(-t.width/2,-t.height/2,t.width,t.height)),e.globalAlpha=this.sprite.opacity,e.rotate(this.sprite.rotation)},t.prototype.PostRender=function(){var t;return t=this.game.canvas,t.restore()},t}(),e.CanvasRenderer=t}.call(this),function(){var t,e,i;e=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.z=0}return t.prototype.GetOffset=function(t){var e,i,r,n,o,s,h;return s=this.x+this.width/2-(t.x+t.width/2),h=this.y+this.height/2-(t.y+t.height/2),i=this.width/2+t.width/2,e=this.height/2+t.height/2,n=this.x+this.width-(t.x+t.width),o=this.y+this.height-(t.y+t.height),r={x:i-Math.abs(s),y:e-Math.abs(h),vx:s,vy:h,halfWidths:i,halfHeights:e,sharedXPlane:n,sharedYPlane:o}},t.prototype.Intersects=function(t){var e,i;return e=this,i=t,e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y&&e.GetOffset(i)},t.prototype.ShiftFrom=function(t,e,i){var r,n;return r=null,n=null,r=void 0===e?t.x:t.x+e,n=void 0===i?t.y:t.y+i,this.x=r,this.y=n},t}(),i=function(){function t(t,e){this.x=t,this.y=e,this.ResolveVectorProperties()}return t.prototype.x=null,t.prototype.y=null,t.prototype.angle=null,t.prototype.magnitude=null,t.prototype.ResolveVectorProperties=function(){return this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y),this.angle=Math.atan2(this.x,this.y)},t.prototype.Clone=function(){return new Torch.Vector(this.x,this.y)},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this.ResolveVectorProperties()},t.prototype.AddScalar=function(t){return this.x+=t,this.y+=t,this.ResolveVectorProperties()},t.prototype.MultiplyScalar=function(t){return this.x*=t,this.y*=t,this.ResolveVectorProperties()},t.prototype.DivideScalar=function(t){return this.x/=t,this.y/=t,this.ResolveVectorProperties()},t.prototype.SubtractVector=function(t){return this.x-=t.x,this.y-=t.y,this.ResolveVectorProperties()},t.prototype.AddVector=function(t){return this.x+=t.x,this.y+=t.y,this.ResolveVectorProperties()},t.prototype.Normalize=function(){return this.DivideScalar(this.magnitude)},t.prototype.DotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.IsPerpendicular=function(t){return 0===this.DotProduct(t)},t.prototype.IsSameDirection=function(t){return this.DotProduct(t)>0},t}(),t=function(){function t(t,e,i){this.x=t,this.y=e,this.z=null!=i?i:0}return t.prototype.Apply=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.Clone=function(){return new t(this.x,this.y)},t}(),Torch.Rectangle=e,Torch.Vector=i,Torch.Point=t}.call(this),Torch.version="0.5.291";