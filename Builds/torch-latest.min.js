(function(){var AABB,Actor,AjaxLoader,Animation,AnimationManager,ArrayUtility,Audio,AudioPlayer,Bind,Block,BodyManager,Camera,CanvasBind,CanvasGame,CanvasRenderer,Circle,CollisionDetector,CollisionManager,Color,Debug,DebugConsole,EffectManager,Electron,Event,EventDispatcher,EventManager,Fluid,FunctionUtility,FutureEvent,Game,GhostSprite,GridManager,HookManager,JerkFollow,Key,Keys,Layer,Layers,Load,Loop,Mouse,ObjectUtility,ParticleEmitter,ParticleManager,PlayList,Point,Rectangle,SizeManager,Sound,SpawnItem,Spawner,Sprite,SpriteGrid,SpriteGroup,SpriteSheetAnimation,State,StateMachine,StateMachineManager,StepAnimation,StringUtility,Task,Text,TexturePack,TextureSheet,Timer,Torch,Trashable,Tween,TweenManager,TweenSetup,Utilities,Vector,Viewport,WebGLGame,exports,measureCanvas,slice=[].slice,extend=function(t,e){function i(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;Function.prototype.MixIn=Function.prototype.is=function(t){var e,i,r,n;r=this.prototype,e=Object.create(t.prototype);for(i in e)n=e[i],r[i]=n;return this},String.prototype.format=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],e=function(e,i){return void 0!==typeof t[i]?t[i]:void 0===typeof t[i]?e:void 0},this.replace(/{(\d+)}/g,e)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.unCapitalize=function(){return this.charAt(0).toLowerCase()+this.slice(1)},exports=this,EventDispatcher=function(){function t(){}return t.dispatchers=[],t.prototype.InitEventDispatch=function(){return this.events={},t.dispatchers.push(this)},t.prototype.On=function(t,e){var i;return this.events[t]||(i=[],i.triggers=0,this.events[t]=i),this.events[t].push(e),this},t.prototype.Emit=function(t,e){var i,r,n,o;if(void 0!==this.events[t])for(o=this.events[t],r=0,n=o.length;r<n;r++)i=o[r],this.events[t].triggers++,i(e);return this},t.prototype.Off=function(t){var e,i,r;if(null==t&&(t=""),""!==t)this.events[t]=void 0;else{i=this.events;for(e in i)r=i[e],this.events[e]=void 0}return this},t}(),exports.EventDispatcher=EventDispatcher,exports=this,Trashable=function(){function t(){}return t.prototype.trash=!1,t.prototype.Trash=function(){return this.trash=!0,this},t}(),exports.Trashable=Trashable,exports=this,window.onerror=function(){var t,e;if(t=1<=arguments.length?slice.call(arguments,0):[],window.Torch.STRICT_ERRORS)return e=t[4],void 0!==e?window.Torch.FatalError(e):window.Torch.FatalError("An error has occured")},Task=function(){function t(t){this.func=t}return t.MixIn(Trashable),t.prototype._torch_add="Task",t.prototype.Execute=function(t){return this.func(t)},t}(),AjaxLoader=function(){function t(t,e){null==e&&(e=window.Torch.AjaxData.Text),this.url=t,this.responseType=this.GetResponseTypeString(e)}return t.prototype.onFinish=function(){},t.prototype.onError=function(){},t.prototype.GetResponseTypeString=function(t){switch(t){case window.Torch.AjaxData.DOMString:return"";case window.Torch.AjaxData.ArrayBuffer:return"arraybuffer";case window.Torch.AjaxData.Blob:return"blob";case window.Torch.AjaxData.Document:return"document";case window.Torch.AjaxData.Json:return"json";case window.Torch.AjaxData.Text:return"text"}},t.prototype.Error=function(t){return this.onError=t},t.prototype.Finish=function(t){return this.onFinish=t},t.prototype.Load=function(){var t;return t=new XMLHttpRequest,t.open("GET",this.url,!0),t.responseType=this.responseType,t.onload=function(e){return function(){return e.onFinish(t.response,e)}}(this),t.send()},t}(),Event=function(){function t(t,e){var i,r,n;this.game=t,this.data=e,null!==this.game&&(this.time=this.game.time),r=this.data;for(i in r)n=r[i],this[i]=n}return t}(),Torch=function(){function t(){this.GamePads=this.Enum("Pad1","Pad2","Pad3","Pad4"),this.AjaxData=this.Enum("DOMString","ArrayBuffer","Blob","Document","Json","Text"),this.Types=this.Enum("String","Number","Object","Array","Function","Sprite","Game","Null"),this.AjaxLoader=AjaxLoader,this.Event=Event,this.EventDispatcher=EventDispatcher,this.Trashable=Trashable,this.Util=new Utilities}var e;return t.prototype.CANVAS=1,t.prototype.WEBGL=2,t.prototype.PIXEL=3,t.prototype.DUMP_ERRORS=!1,t.prototype.RandomInRange=function(t,e){return Math.random()*(e-t+1)+t},t.prototype.Needs=function(e){if(!t[e])throw"Compenent "+e+" is required";return this},t.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),document.body.backgroundColor="black",this.DUMP_ERRORS&&void 0!==require&&require("fs").writeFileSync("torch-error.log",t.stack),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302C;margin-left:15%;font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302C;font-size:20px;font-weight:bold'>Stack Trace:</code><br>\n<code style='color:#C9302C;font-size:20px'>"+i+"</code><br>",document.body.innerHTML=e,t},t.prototype.StrictErrors=function(){return this.STRICT_ERRORS=!0},t.prototype.DumpErrors=function(){return this.DUMP_ERRORS=!0},t.prototype.DisableConsoleWarnings=function(){return console.warn=function(){}},t.prototype.Enum=function(){var t,e,i,r,n,o;for(o=1<=arguments.length?slice.call(arguments,0):[],r={},t=e=0,i=o.length;e<i;t=++e)n=o[t],r[n]=t+1;return r},t.prototype.Assert=function(e,i){if(null==i&&(i="Assertation Failed"),!e)return t.FatalError(i)},t.prototype.TypeOf=function(e){var i,r;switch(i=[],void 0!==e.__torch__&&i.push(e.__torch__),r={}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case"string":i.push(t.Types.String);break;case"number":i.push(t.Types.Number);break;case"object":i.push(t.Types.Object);break;case"array":i.push(t.Types.Array);break;case"function":i.push(t.Types.Function);break;default:i.push(t.Types.Null)}return i},e=function(e,i){return t.TypeOf(e).indexOf(i)!==-1},t.prototype.ExtendObject=function(t,e){var i,r,n;r=[];for(i in e)n=e[i],r.push(t[i]=n);return r},t.prototype.ExtendProperties=function(){var t,e,i,r,n,o,s,h;for(t=arguments[0],s=2<=arguments.length?slice.call(arguments,1):[],h=[],i=0,n=s.length;i<n;i++)o=s[i],r=o.unCapitalize(),e=function(t){return void 0===t?this[r]:(this[r]=t,this)},h.push(t.prototype[o]=e);return h},t}(),Utilities=function(){function t(){}return t.prototype.Expose=function(){return window.T=this},t.prototype.RandomInRange=function(){},t.prototype.String=function(t){return new StringUtility(t)},t.prototype.Array=function(t){return new ArrayUtility(t)},t.prototype.Function=function(t){return new FunctionUtility(t)},t.prototype.Object=function(t){return new ObjectUtility(t)},t}(),StringUtility=function(){function t(t){this.str=t}return t.prototype.String=function(){return this.str},t.prototype.Chunk=function(t){return this.str=this.str.match(new RegExp(".{1,"+t+"}","g")),this.str},t.prototype.Capitalize=function(){return this.str[0]=this.str[0].toUpperCase(),this.str},t}(),ArrayUtility=function(){function t(t){this.array=t}return t.prototype.Array=function(){return this.array},t.prototype.All=function(t){var e,i,r,n,o;for(n=this.array,o=[],i=0,r=n.length;i<r;i++)e=n[i],o.push(t(e));return o},t.prototype.Find=function(t){var e,i,r,n;for(n=this.array,i=0,r=n.length;i<r;i++)if(e=n[i],t(e))return e},t.prototype.Filter=function(t){var e,i,r,n,o;for(o=[],n=this.array,i=0,r=n.length;i<r;i++)e=n[i],t(e)&&o.push(e);return o},t.prototype.Reject=function(t){var e,i,r,n,o;for(o=[],n=this.array,i=0,r=n.length;i<r;i++)e=n[i],t(e)||o.push(e);return o},t.prototype.Where=function(t){var e;return e=this.Filter(function(e){var i,r;for(i in t)if(r=t[i],e[i]!==r)return!1;return!0})},t.prototype.Every=function(t){var e,i,r,n;for(n=this.array,i=0,r=n.length;i<r;i++)if(e=n[i],!t(e))return!1;return!0},t.prototype.Some=function(t){var e,i,r,n;for(n=this.array,i=0,r=n.length;i<r;i++)if(e=n[i],t(e))return!0;return!1},t.prototype.Contains=function(t,e){var i;return null==e&&(e=0),i=this.array.indexOf(t),i!==-1&&i>=e},t.prototype.Pluck=function(t){var e,i,r,n,o;for(n=[],o=this.array,i=0,r=o.length;i<r;i++)e=o[i],n.push(e[t]);return n},t.prototype.Max=function(t){var e,i,r,n,o,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,n=0,o=s.length;n<o;n++)r=s[n],e=t(r),e>i&&(i=r);return i},t.prototype.Min=function(t){var e,i,r,n,o,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,n=0,o=s.length;n<o;n++)r=s[n],e=t(r),e<i&&(i=e);return i},t.prototype.SortBy=function(t){},t.prototype.GroupBy=function(t){var e,i,r,n,o,s;for(null==t&&(t=function(t){return t.toString().length}),i={},s=this.array,n=0,o=s.length;n<o;n++)r=s[n],e=t(r),null==i[e]?i[e]=[r]:i[e].push(r);return i},t.prototype.CountBy=function(t){var e,i,r;e=this.GroupBy(t);for(i in e)r=e[i],e[i]=r.length;return e},t.prototype.Shuffle=function(){var t,e,i;for(t=this.array.length,i=t,e=t;0!==t;)e=Math.floor(Math.random()*t),t-=1,i=this.array[t],this.array[t]=this.array[e],this.array[e]=i;return this.array},t.prototype.Sample=function(t){var e,i;for(null==t&&(t=1),i=[],e=[];t>0;)e.push(t--);return e},t.prototype.Partition=function(t){return[this.Filter(t),this.Reject(t)]},t.prototype.First=function(t){var e;if(null==t&&(t=1),1===t)return this.array[0];for(e=[];t<=this.array.length;)e.push(this.array[t-1]),t++;return e},t.prototype.Last=function(t){var e;if(null==t&&(t=1),1===t)return this.array[this.array.length-1];for(e=[];t<=this.array.length;)e.push(this.array[this.array.length-(t-1)]),t++;return e},t.prototype.Flatten=function(){},t.prototype.Without=function(){var t,e,i,r,n,o;for(o=1<=arguments.length?slice.call(arguments,0):[],t=[],n=this.array,i=0,r=n.length;i<r;i++)e=n[i],o.indexOf(e)===-1&&t.push(e);return t},t.prototype.Union=function(){var t,e,i,r,n,o,s,h,a;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),r=[],o=0,s=i.length;o<s;o++)for(t=i[o],a=0,h=t.length;a<h;a++)n=t[a],r.indexOf(n)===-1&&r.push(n);return r},t.prototype.Intersection=function(){var t,e,i,r,n,o,s,h,a,u,p,c;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),r=[],n={},s=0,a=i.length;s<a;s++)for(t=i[s],p=0,u=t.length;p<u;p++)o=t[p],null==n[o]?n[o]=1:n[o]+=1;for(h in n)c=n[h],c>=e.length&&r.push(h);return r},t.prototype.Uniq=function(){},t.prototype.Zip=function(){var t,e,i,r,n,o,s,h,a,u,p;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[],p=this.array,r=o=0,s=p.length;o<s;r=++o){for(n=p[r],u=[n],a=0,h=e.length;a<h;a++)t=e[a],u.push(t[r]);i.push(u)}return i},t.prototype.UnZip=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[]},t}(),FunctionUtility=function(){function t(t){this.func=t}return t.prototype.Defer=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],e=function(e){return function(){return e.func.apply(e,t)}}(this),setTimeout(e,0)},t.prototype.Once=function(){var t,e;return e=this.func,t=function(){var t;if(t=1<=arguments.length?slice.call(arguments,0):[],!this.called)return e.apply(null,t),this.called=!0}},t.prototype.After=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesBeforeExecuted+=1,!(this.calledCount<t))return i.apply(null,e),this.called=!0},e.timesBeforeExecuted=0,e},t.prototype.Before=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesExecuted+=1,!(this.calledCount>t))return i.apply(null,e),this.called=!0},e.timesExecuted=0,e},t.prototype.Compose=function(){var t,e,i,r;return e=1<=arguments.length?slice.call(arguments,0):[],t=[this.func].concat(slice.call(e)),i=0,r=function(){var e,r;for(e=void 0,r=[];i<t.length;)e=t[i](e),r.push(i++);return r}},t}(),ObjectUtility=function(){function t(t){this.obj=t}return t.prototype.Keys=function(){var t,e,i,r;e=[],i=this.obj;for(t in i)r=i[t],e.push(t);return e},t.prototype.Values=function(){var t,e,i,r;r=[],e=this.obj;for(t in e)i=e[t],r.push(i);return r},t.prototype.All=function(t){var e,i,r;i=this.obj;for(e in i)r=i[e],this.obj[e]=t(e,r);return this.obj},t.prototype.Invert=function(){var t,e,i,r;e={},i=this.obj;for(t in i)r=i[t],e[r]=t;return e},t.prototype.Functions=function(){var t,e,i,r;t=[],i=this.obj;for(e in i)r=i[e],"function"==typeof r&&t.push(r.name);return t},t.prototype.Extend=function(){var t,e,i,r,n,o;for(n=1<=arguments.length?slice.call(arguments,0):[],t=0,i=n.length;t<i;t++){r=n[t];for(e in r)o=r[e],this.obj[e]=o}return this.obj},t.prototype.Pick=function(){var t,e,i,r,n,o,s;if(n=1<=arguments.length?slice.call(arguments,0):[],r={},"function"==typeof n){o=this.obj;for(e in o)s=o[e],n(e,s,this.obj)&&(r[e]=s)}else for(t=0,i=n.length;t<i;t++)e=n[t],r[e]=this.obj[e];return r},t.prototype.Omit=function(){var t,e,i,r,n,o;if(i=1<=arguments.length?slice.call(arguments,0):[],e={},"function"==typeof i){r=this.obj;for(t in r)o=r[t],i(t,o,this.obj)||(e[t]=o)}else{n=this.obj;for(t in n)o=n[t],i.indexOf(t)===-1&&(e[t]=this.obj[t])}return e},t.prototype.Clone=function(){},t.prototype.Has=function(t){return null!=this.obj[t]},t.prototype.Matches=function(t){var e,i;for(e in t)if(i=t[e],this.obj[e]!==i)return!1;return!0},t.prototype.Empty=function(){return 0===this.Keys().length},t}(),exports.Torch=new Torch,DebugConsole=function(){function DebugConsole(t){var e,i;this.game=t,i='<div id = "torch-console" style = "position: absolute;z-index: 100;top:0;border: 1px solid orange;background-color:black">\n    <p style = "color:white;margin-left:1%;font-family:monospace">Torch Dev Console. Type /HELP for usage</p>\n    <input type="text" id = "torch-console-input" placeholder="Torch Dev Console, type /HELP for usage"/ style = "outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 16px;padding: 3%;width: 100%;" />\n    <div id = "torch-console-output" style = "overflow:auto;outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 14px;padding: 1%;width: 98%;height:250px"></div>\n</div>',e=document.createElement("div"),e.innerHTML=i,e.style.display="none",document.body.appendChild(e),this.console=e,this.consoleInput=document.getElementById("torch-console-input"),this.consoleOutput=document.getElementById("torch-console-output"),this.commands={},this.variables={},this.LoadDefaultCommands(),document.addEventListener("keypress",function(t){return function(e){return 47===e.keyCode?t.Toggle(!0):13===e.keyCode?t.ParseCommand():void 0}}(this)),document.addEventListener("keydown",function(t){return function(e){if(27===e.keyCode)return t.Toggle(!1)}}(this))}return DebugConsole.prototype.enabled=!1,DebugConsole.prototype.console=null,DebugConsole.prototype.consoleInput=null,DebugConsole.prototype.consoleOutput=null,DebugConsole.prototype.commands=null,DebugConsole.prototype.variables=null,DebugConsole.prototype.Toggle=function(t){return null==t&&(t=!0),t?(this.console.style.display="block",this.consoleInput.focus(),this.enabled=!0):(this.console.style.display="none",this.consoleInput.value="",this.enabled=!1)},DebugConsole.prototype.Output=function(t,e){return null==e&&(e="white"),t=t.replace(/\n/g,"<br>"),this.consoleOutput.innerHTML+="<p style='color:orange'>TorchDev$</p><p style='color:"+e+"'>"+t+"</p>"},DebugConsole.prototype.ParseCommand=function(){var t,e,i,r,n,o,s,h;if(this.enabled){for(i=this.consoleInput.value,i=i.replace(/\$(.*?)\$/g,function(t){return function(e){var i;return i=e.substring(1,e.length-1),t.variables[i]}}(this)),e=i.split(" ")[0].split("/")[1],t=[],h=i.split(" "),r=n=0,o=h.length;n<o;r=++n)s=h[r],0!==r&&t.push(s);return this.ExecuteCommand(e,t)}},DebugConsole.prototype.ExecuteCommand=function(t,e){var i;return this.commands[t]?(i=this.commands)[t].apply(i,[this].concat(slice.call(e))):void this.Output("Command '"+t+"' does not exist.","red")},DebugConsole.prototype.AddCommand=function(t,e){return this.commands[t]=e},DebugConsole.prototype.LoadDefaultCommands=function(){return this.AddCommand("HELP",function(t){return function(t){return t.Output("type '/HELP' for help\ntype '/FPS' for frame rate\ntype '/TIME' for game time\ntype '/E [statement]' to execute a JavaScript statement\ntype '/RUN [path] to load and execute a JavaScript file'")}}(this)),this.AddCommand("CLEAR",function(t){return function(e){return t.consoleOutput.innerHTML=""}}(this)),this.AddCommand("FPS",function(t){return function(e){return e.Output("Current FPS: "+t.game.fps+"\nAverage FPS: 0")}}(this)),this.AddCommand("TIME",function(t){return function(e){return e.Output("Total Game Time: "+t.game.time+"\nDelta Time: "+t.game.deltaTime)}}(this)),this.AddCommand("RUN",function(_this){return function(tConsole,filePath){var loader;return loader=new Torch.AjaxLoader(filePath,Torch.AjaxData.Text),loader.Finish(function(data){var error,error1;try{return eval(data),tConsole.Output("File Executed","green")}catch(t){return error=t,tConsole.Output("File: '"+statement+"' caused an error. "+error,"red")}}),loader.Load()}}(this)),this.AddCommand("SET",function(t){return function(e,i,r){return isNaN(r)?t.variables[i]=r:t.variables[i]=parseFloat(r),t.Output("Set "+i+" to "+r,"green")}}(this)),this.AddCommand("E",function(_this){return function(tConsole,statement){var error,error1;try{return eval(statement),tConsole.Output("Statment Executed","green")}catch(t){return error=t,tConsole.Output("Statement: '"+statement+"' caused an error. "+error,"red")}}}(this))},DebugConsole}(),Torch.DebugConsole=DebugConsole,BodyManager=function(){function t(t){this.sprite=t,Torch.Assert(null!==this.sprite&&this.sprite.__torch__===Torch.Types.Sprite),this.game=this.sprite.game,this.velocity=new Torch.Vector(0,0),this.acceleration=new Torch.Vector(0,0),this.omega=0,this.alpha=0}return t.prototype.Update=function(){return this.sprite.position.x+=this.velocity.x*this.game.Loop.updateDelta,this.sprite.position.y+=this.velocity.y*this.game.Loop.updateDelta,this.velocity.x+=this.acceleration.x*this.game.Loop.updateDelta,this.velocity.y+=this.acceleration.y*this.game.Loop.updateDelta,this.sprite.rotation+=this.omega*this.game.Loop.updateDelta},t.prototype.Debug=function(t){return null==t&&(t=!0),this.DEBUG=t},t.prototype.AngleTo=function(t){var e;return e=this.DirectionTo(t),e.angle},t.prototype.DistanceTo=function(t){var e,i;return i=new Torch.Vector(this.sprite.position.x,this.sprite.position.y),e=new Torch.Vector(t.position.x,t.position.y),e.SubtractVector(i),e.magnitude},t.prototype.DirectionTo=function(t){var e;return e=new Torch.Vector(t.position.x-this.sprite.position.x,t.position.y-this.sprite.position.y),e.Normalize(),e},t}(),Torch.Body=BodyManager,SizeManager=function(){function t(t){var e;this.sprite=t,e=this.sprite.rectangle,this.width=e.width,this.height=e.height,this.scale={width:1,height:1}}return t.prototype.width=0,t.prototype.height=0,t.prototype.scale=null,t.prototype.Update=function(){var t;return t=this.sprite.rectangle,t.width=this.width*this.scale.width,t.height=this.height*this.scale.height},t.prototype.Set=function(t,e){return this.width=t,this.height=e},t.prototype.Scale=function(t,e){return this.scale.width=t,this.scale.height=e},t}(),Torch.SizeManager=SizeManager,EventManager=function(){function t(t){this.sprite=t,this.game=this.sprite.game}return t.prototype.mouseOver=!1,t.prototype.clickTrigger=!1,t.prototype.clickAwayTrigger=!1,t.prototype.draw=!0,t.prototype.wasClicked=!1,t.prototype.Update=function(){var t,e;return!this.game.Mouse.GetRectangle().Intersects(this.sprite.rectangle)&&this.mouseOver&&(this.mouseOver=!1,this.sprite.Emit("MouseLeave",new Torch.Event(this.game,{sprite:this.sprite}))),this.game.Mouse.GetRectangle(this.game).Intersects(this.sprite.rectangle)?(this.mouseOver||this.sprite.Emit("MouseOver",new Torch.Event(this.game,{sprite:this.sprite})),this.mouseOver=!0):this.sprite.fixed?(t=this.game.Mouse.GetRectangle(),e=new Torch.Rectangle(t.x,t.y,t.width,t.height),e.x+=this.game.Camera.position.x,e.y+=this.game.Camera.position.y,e.Intersects(this.sprite.rectangle)?this.mouseOver=!0:this.mouseOver=!1):this.mouseOver=!1,this.mouseOver&&this.game.Mouse.down&&!this.clickTrigger&&(this.clickTrigger=!0),this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver&&(this.wasClicked=!0,this.sprite.Emit("Click",new Torch.Event(this.game,{sprite:this.sprite})),this.clickTrigger=!1),!this.clickTrigger||this.game.Mouse.down||this.mouseOver||(this.clickTrigger=!1),this.game.Mouse.down||this.mouseOver||!this.clickAwayTrigger?this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver?this.clickAwayTrigger=!1:this.game.Mouse.down&&!this.mouseOver?this.clickAwayTrigger=!0:void 0:(this.sprite.Emit("ClickAway",new Torch.Event(this.game,{sprite:this.sprite})),this.wasClicked=!1,this.clickAwayTrigger=!1)},t}(),Torch.EventManager=EventManager,EffectManager=function(){function t(t){this.sprite=t,this.tint={color:null,opacity:.5},this.mask={texture:null,in:!1,out:!1}}return t.prototype.tint=null,t.prototype.mask=null,t}(),Torch.EffectManager=EffectManager,StateMachineManager=function(){function t(t){this.sprite=t,this.stateMachines={}}return t.prototype.CreateStateMachine=function(t){return this.stateMachines[t]=new Torch.StateMachine(this.sprite),this.stateMachines[t]},t.prototype.GetStateMachine=function(t){return this.stateMachines[t]},t.prototype.Update=function(){var t,e,i,r;e=this.stateMachines,i=[];for(t in e)r=e[t],i.push(r.Update());return i},t}(),Torch.StateMachineManager=StateMachineManager,GridManager=function(){function t(t){this.sprite=t,this.position=new Torch.Point(0,0),this.children=[]}return t.prototype.parent=null,t.prototype.children=null,t.prototype.centered=!1,t.prototype.centerVertical=!1,t.prototype.alignLeft=!1,t.prototype.alignRight=!1,t.prototype.alignTop=!1,t.prototype.alignBottom=!1,t.prototype.Align=function(){var t,e,i,r,n;for(i=1<=arguments.length?slice.call(arguments,0):[],r=[],t=0,e=i.length;t<e;t++)switch(n=i[t]){case"left":r.push(this.alignLeft=!0);break;case"right":r.push(this.alignRight=!0);break;case"top":r.push(this.alignTop=!0);break;case"bottom":r.push(this.alignBottom=!0);break;default:r.push(void 0)}return r},t.prototype.Center=function(t){return null==t&&(t=!0),this.centered=t},t.prototype.CenterVertical=function(t){return null==t&&(t=!0),this.centerVertical=t},t.prototype.Append=function(t){return t.Grid.parent=this.sprite,t.drawIndex=this.sprite.drawIndex+1,t.fixed=this.sprite.fixed},t.prototype.Parent=function(){return this.parent},t.prototype.Children=function(t){var e,i,r,n,o,s,h,a;if(!t)return this.children;for(i=[],h=this.children,r=0,o=h.length;r<o;r++){e=h[r],s=!0;for(n in t)a=t[n],!e[n]===a&&(s=!1);s&&i.append(e)}return i},t.prototype.Ancestors=function(t){var e,i,r,n,o,s;if(!this.parent)return null;for(i=[],e=this.parent,o=[];null!==e.Parent();){if(t){n=!0;for(r in t)s=t[r],e[r]!==s&&(n=!1);n&&i.push(e)}else i.push(e);o.push(e=e.Parent())}return o},t.prototype.ApplyCentering=function(t){return this.centered&&(t.x=t.x+this.parent.rectangle.width/2-this.sprite.rectangle.width/2),this.centerVertical&&(t.y=t.y+this.parent.rectangle.height/2-this.sprite.rectangle.height/2),t},t.prototype.ApplyAlignment=function(t){return this.alignLeft&&(t.x=0),this.alignRight&&(t.x=t.x+(this.parent.rectangle.width-this.sprite.rectangle.width)),this.alignTop&&(t.y=0),this.alignBottom&&(t.y=t.y+(this.parent.rectangle.height-this.sprite.rectangle.height)),t},t.prototype.ResolveAbosolutePosition=function(){var t;return null===this.parent?this.sprite.position:(t=this.parent.position.Clone(),t=this.ApplyCentering(t),t=this.ApplyAlignment(t),t.Apply(this.position),t)},t.prototype.Update=function(){if(this.sprite.position=this.ResolveAbosolutePosition(),null!==this.parent)return this.sprite.drawIndex=this.parent.drawIndex+1,this.sprite.fixed=this.parent.fixed},t}(),Torch.GridManager=GridManager,Animation=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.loop=!1,e.prototype.stopped=!1,e.prototype.intervalTime=0,e.prototype.stepTime=0,e}(Torch.Trashable),AnimationManager=function(){function t(t){this.sprite=t,this.animations=[]}return t.prototype.animations=null,t.prototype.Update=function(){var t,e,i,r,n;for(e=[],n=this.animations,i=0,r=n.length;i<r;i++)t=n[i],t.Update(),t.trash||e.push(t);return this.animations=e},t.prototype.SpriteSheet=function(t,e,i,r){var n;return null==r&&(r={step:200}),n=new SpriteSheetAnimation(this.sprite,t,e,i,r.step),this.animations.push(n),n},t}(),SpriteSheetAnimation=function(t){function e(t,e,i,r,n){this.sprite=t,this.clipWidth=e,this.clipHeight=i,this.numberOfFrames=r,this.stepTime=n,this.loop=!0,this.game=this.sprite.game,this.Reset()}return extend(e,t),e.prototype.index=-1,e.prototype.clipX=0,e.prototype.clipY=0,e.prototype.game=null,e.prototype.clipWidth=null,e.prototype.clipHeight=null,e.prototype.numberOfFrames=null,e.prototype.stepTime=null,e.prototype.Update=function(){if(!this.stopped)return this.intervalTime+=this.game.Loop.updateDelta,this.intervalTime>=this.stepTime?this.AdvanceFrame():void 0},e.prototype.AdvanceFrame=function(){if(this.intervalTime=0,this.index+=1,this.sprite.DrawTexture.drawParams.clipX=this.index*this.clipWidth,this.index>=this.numberOfFrames-1)return this.loop?this.index=-1:this.Trash()},e.prototype.Stop=function(){return this.stopped=!0},e.prototype.Start=function(){return this.stopped=!1},e.prototype.Index=function(t){return this.index=t-1,this.sprite.DrawTexture.drawParams.clipX=(this.index+1)*this.clipWidth},e.prototype.Reset=function(){return this.intervalTime=0,this.index=-1,this.sprite.DrawTexture.drawParams.clipX=0,this.sprite.DrawTexture.drawParams.clipY=0,this.sprite.DrawTexture.drawParams.clipWidth=this.clipWidth,this.sprite.DrawTexture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e.prototype.SyncFrame=function(){return this.sprite.DrawTexture.drawParams.clipX=0,this.sprite.DrawTexture.drawParams.clipY=0,this.sprite.DrawTexture.drawParams.clipWidth=this.clipWidth,this.sprite.DrawTexture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e}(Animation),Torch.AnimationManager=AnimationManager,Sprite=function(){function t(t,e,i){this.InitSprite(t,e,i)}return t.MixIn(Torch.EventDispatcher).MixIn(Torch.Trashable),t.prototype.__torch__=Torch.Types.Sprite,t.prototype.InitSprite=function(t,e,i){return null==e&&(e=0),null==i&&(i=0),null!==t&&void 0!==t||Torch.FatalError("Unable to initialize sprite without game"),this.InitEventDispatch(),this.game=t,this.rectangle=new Torch.Rectangle(e,i,0,0),this.position=new Torch.Point(e,i),this.Bind=new Torch.Bind(this),this.Collisions=new Torch.CollisionManager(this),this.Body=new Torch.Body(this),this.Size=new Torch.SizeManager(this),this.Events=new Torch.EventManager(this),this.Effects=new Torch.EffectManager(this),this.States=new Torch.StateMachineManager(this),this.Grid=new Torch.GridManager(this),this.Animations=new Torch.AnimationManager(this),this.DrawTexture=null,this.TexturePack=null,this.TextureSheet=null,this.TextureSimple=null,this.fixed=!1,this.draw=!0,this.drawIndex=0,this.rotation=0,this.opacity=1,this._torch_add="Sprite",this._torch_uid="",this.events={},this.renderer=new CanvasRenderer(this),t.Add(this)},t.prototype.UpdateSprite=function(){return this.Body.Update(),this.Size.Update(),this.Events.Update(),this.States.Update(),this.Grid.Update(),this.Animations.Update(),this.rectangle.x=this.position.x,this.rectangle.y=this.position.y,this.Collisions.Update()},t.prototype.Update=function(){return this.UpdateSprite()},t.prototype.Draw=function(){return this.renderer.Draw()},t.prototype.GetCurrentDraw=function(){return this.TexturePack?this.TexturePackAnimation.GetCurrentFrame():this.TextureSheet?this.TextureSheetAnimation.GetCurrentFrame():this.DrawTexture?this.DrawTexture:void 0},t.prototype.Clone=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],e=this.constructor,function(t,e,i){i.prototype=t.prototype;var r=new i,n=t.apply(r,e);return Object(n)===n?n:r}(e,t,function(){})},t.prototype.NotSelf=function(t){return t._torch_uid!==this._torch_uid},t.prototype.Center=function(){var t,e;return t=this.game.canvasNode.width,e=t/2-this.rectangle.width/2,this.position.x=e,this},t.prototype.CenterVertical=function(){var t,e;return t=this.game.canvasNode.height,e=t/2-this.rectangle.height/2,this.position.y=e,this},t.prototype.CollidesWith=function(t){return new Torch.Collider.CollisionDetector(this,t)},t}(),GhostSprite=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.GHOST_SPRITE=!0,e}(Sprite),Torch.Sprite=Sprite,Torch.GhostSprite=GhostSprite,measureCanvas=document.createElement("CANVAS"),measureCanvas.width=500,measureCanvas.height=500,Text=function(t){function e(t,e,i,r){this.InitText(t,e,i,r)}return extend(e,t),e.prototype.TEXT=!0,e.measureCanvas=measureCanvas.getContext("2d"),e.prototype.InitText=function(t,e,i,r){return this.InitSprite(t,e,i),this.data=r,this.font="Arial",this.fontSize=16,this.fontWeight="",this.color="#2b4531",this.text="",this.lastText="",this.width=100,this.height=100,this.Size.scale={width:1,height:1},this.Init()},e.prototype.Init=function(){return this.data.font&&(this.font=this.data.font),this.data.fontSize&&(this.fontSize=this.data.fontSize),this.data.fontWeight&&(this.fontWeight=this.data.fontWeight),this.data.color&&(this.color=this.data.color),this.data.text&&(this.text=this.data.text),this.data.rectangle&&(this.rectangle=this.data.rectangle),this.data.buffHeight&&(this.buffHeight=this.data.buffHeight),this.Render()},e.prototype.Render=function(){var t,i,r;return i=document.createElement("CANVAS"),e.measureCanvas.font=this.fontSize+"px "+this.font,i.width=Torch.Text.measureCanvas.measureText(this.text).width,i.height=this.fontSize,this.buffHeight&&(i.height+=this.buffHeight),t=i.getContext("2d"),t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.font,t.fillText(this.text,0,i.height),r=new Image,r.src=i.toDataURL(),r.onload=function(t){return function(){return t.GL?(t.Three()&&t.Three().Remove(),t.Bind.WebGLTexture({gl_2d_canvas_generated_image:!0,width:r.width,height:r.height,texture:(new THREE.TextureLoader).load(r.src)})):t.Bind.Texture(r)}}(this),this.rectangle.width=i.width,this.rectangle.height=this.fontSize},e.prototype.Update=function(){return e.__super__.Update.call(this),this.UpdateText()},e.prototype.UpdateText=function(){if(this.text!==this.lastText)return this.Render(),this.lastText=this.text},e}(Torch.Sprite),Torch.ExtendProperties(Text,"Text","Font","FontSize","FontWeight","Color"),Torch.Text=Text,SpriteGroup=function(){function t(t,e){var i,r,n,o;for(this.sprites=null!=t?t:[],this.game=e,n=this.sprites,i=0,r=n.length;i<r;i++)o=n[i],o.anchorX=o.Rectangle.x;return this}return t.prototype.Factory=function(t){return this.spriteFactory=t,this},t.prototype.Add=function(){var t,e,i,r,n;return i=arguments[0],r=arguments[1],n=arguments[2],t=4<=arguments.length?slice.call(arguments,3):[],null===i||void 0===i&&void 0!==this.spriteFactory?(e=function(t,e,i){i.prototype=t.prototype;var r=new i,n=t.apply(r,e);return Object(n)===n?n:r}(this.spriteFactory,[this.game,r,n].concat(slice.call(t)),function(){}),this.sprites.push(e),e):(this.sprites=this.sprites.concat(i),this)},t.prototype.Trash=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.Trash();return this},t.prototype.Shift=function(t){var e,i,r,n,o;for(r=this.sprites,n=[],e=0,i=r.length;e<i;e++)o=r[e],t.x?n.push(o.Rectangle.x=o.anchorX+t.x):n.push(void 0);return n},t.prototype.Hide=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.draw=!1;return this},t.prototype.Show=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.draw=!0;return this},t.prototype.Center=function(){var t,e,i,r;for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.Center();return this},t.prototype.ToggleFixed=function(){var t,e,i,r;
for(i=this.sprites,t=0,e=i.length;t<e;t++)r=i[t],r.ToggleFixed();return this},t}(),Torch.SpriteGroup=SpriteGroup,SpriteGrid=function(){function t(t,e){this.game=t,this.gridXml=e,this.ParseXml()}return t.prototype.ParseXml=function(){var t,e,i,r;return t=new DOMParser,r=t.parseFromString(this.gridXml,"text/xml"),e=r.getElementsByTagName("SpriteGrid")[0],null===e&&this.game.FatalError("Unable to parse SpriteGrid XML, no SpriteGrid tag"),i=e.getElementsByTagName("Sprite")},t}(),Torch.SpriteGrid=SpriteGrid,Torch.Collider={},CollisionDetector=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.AABB=function(){return new Torch.Collider.AABB(this.sprite,this.otherSprite).Execute()},t.prototype.Circle=function(){return new Torch.Collider.Circle(this.sprite,this.otherSprite).Execute()},t.prototype.SAT=function(){return new Torch.Collider.SAT(this.sprite,this.otherSprite).Execute()},t}(),Torch.Collider.CollisionDetector=CollisionDetector,AABB=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){return this.sprite.rectangle.Intersects(this.otherSprite.rectangle)},t}(),Torch.Collider.AABB=AABB,Circle=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){var t,e,i,r,n;return t={radius:this.sprite.Width(),x:this.sprite.Position("x"),y:this.sprite.Position("y")},e={radius:this.otherSprite.Width(),x:this.otherSprite.Position("x"),y:this.otherSprite.Position("y")},r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(r*r+n*n),i<t.radius+e.radius},t}(),Torch.Collider.Circle=Circle,Torch.Collision={AABB:1,Circle:2,SAT:3},CollisionManager=function(){function t(t){this.sprite=t,this.filter={},this.game=this.sprite.game}return t.prototype.mode=Torch.Collision.AABB,t.prototype.sprite=null,t.prototype.filter=null,t.prototype.limit=null,t.prototype.enabled=!1,t.prototype.Monitor=function(){return this.enabled=!0},t.prototype.NotFiltered=function(t){var e,i,r,n;i=this.game.filter;for(e in i)if(n=i[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!1}else if(n===t[e])return!1;r=this.filter;for(e in r)if(n=r[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!1}else if(n===t[e])return!1;return!0},t.prototype.InLimit=function(t){var e,i,r;i=this.limit;for(e in i)if(r=i[e],"__type__"===e){if(r.constructor.name===t.constructor.name)return!0}else if(r===t[e])return!0;return!1},t.prototype.Valid=function(t){return null!==this.limit?this.InLimit(t):this.NotFiltered(t)},t.prototype.Filter=function(t){return this.filter=t},t.prototype.Limit=function(t){return this.limit=t},t.prototype.Mode=function(t){var e;return e=t},t.prototype.Update=function(){var t,e,i,r,n,o,s;if(this.sprite.game&&this.enabled){for(this.game=this.sprite.game,t=!1,s=this.game.spriteList,r=0,n=s.length;r<n;r++)if(o=s[r],this.sprite.NotSelf(o)&&this.Valid(o)){switch(i=!1,e={},this.mode){case Torch.Collision.AABB:e=this.sprite.CollidesWith(o).AABB(),i=e!==!1}i&&(e.self=this.sprite,e.collider=o,this.sprite.Emit("Collision",new Torch.Event(this.game,{collisionData:e})))}return this.sprite.Emit("NoCollision",new Torch.Event(this.game,{}))}},t.prototype.SimpleCollisionHandle=function(t,e){var i,r;return null==e&&(e=1),i=t.collisionData,r={left:!1,right:!1,top:!1,bottom:!1},i.vx<i.halfWidths&&i.vy<i.halfHeights&&(i.x<i.y?i.vx>0?(t.collisionData.self.position.x+=i.x*e,r.left=!0):i.vx<0&&(t.collisionData.self.position.x-=i.x*e,r.right=!0):i.x>i.y&&(i.vy>0?(t.collisionData.self.position.y+=i.y*e,r.top=!0):i.vy<0&&(t.collisionData.self.position.y-=i.y*e,r.bottom=!0))),r},t}(),Torch.CollisionManager=CollisionManager,Loop=function(){function t(t){this.game=t,this.fps=50,this.frameTime=1e3/this.fps,this.lag=0,this.updateDelta=0,this.drawDelta=0,this.lagOffset}return t.prototype.Update=function(){return this.game.update(this),this.game.Camera.Update(),this.game.Timer.Update(),this.game.Debug.Update(),this.game.Tweens.Update(),this.game.UpdateAnimations(),this.game.UpdateTimeInfo(),this.game.UpdateTasks(),this.game.UpdateGamePads(),this.game.UpdateSprites()},t.prototype.Draw=function(){return this.game.draw(this),this.game.DrawSprites()},t.prototype.AdvanceFrame=function(t){var e;for(void 0===this.game.time&&(this.game.time=t),this.game.deltaTime=Math.round(t-this.game.time),this.game.time=t,e=this.game.deltaTime,this.drawDelta=e,this.updateDelta=this.frameTime,e>1e3&&(e=this.frameTime),this.lag+=e;this.lag>=this.frameTime;)this.Update(),this.lag-=this.frameTime;return this.lagOffset=this.lag/this.frameTime,this.Draw(),window.requestAnimationFrame(function(t){return function(e){return t.AdvanceFrame(e)}}(this))},t.prototype.Run=function(t){return this.AdvanceFrame(0)},t}(),Torch.Loop=Loop,Load=function(){function t(t){this.game=t,this.game.Assets={game:this.game,GetTexture:function(t){return this.game.Assets.Textures[t]},GetTexturePack:function(t){return this.game.Assets.TexturePacks[t]},GetTextureSheet:function(t){return this.game.Assets.TextureSheets[t]},GetSound:function(t){return this.game.Assets.Sounds[t].audio}},this.game.Files={},this.textures=this.game.Assets.Textures={},this.texturePacks=this.game.Assets.TexturePacks={},this.textureSheets=this.game.Assets.TextureSheets={},this.sound=this.game.Assets.Sounds={},this.audio=this.game.Assets.Audio={},this.Stack=[],this.finish_stack=0,this.progress=0,this.loaded=!1,this.loadLog=""}return t.prototype.Sound=function(t,e){return this.sound[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"sound",id:e,path:t}),this.finish_stack++},t.prototype.Audio=function(t,e){return this.audio[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"audio",id:e,path:t}),this.finish_stack++},t.prototype.Texture=function(t,e){var i,r,n,o,s;if("string"==typeof t)return this.Stack.push({_torch_asset:"texture",id:e,path:t}),this.finish_stack++;for(s=[],i=r=0,n=t.length;r<n;i=++r)o=t[i],s.push(this.Texture(t[i][0],t[i][1]));return s},t.prototype.PixlTexture=function(t,e,i){var r;return r=pixl(t,e).src,this.Stack.push({_torch_asset:"texture",id:i,path:r})},t.prototype.TexturePack=function(t,e,i,r){var n,o,s,h;for(o=[],n=1;n<=i;)h=t+"_"+n.toString()+"."+r,s=e+"_"+n.toString(),this.Stack.push({_torch_asset:"texture",id:s,path:h}),o.push(s),this.finish_stack++,n++;return this.texturePacks[e]=o},t.prototype.TextureSheet=function(t,e,i,r,n,o){var s,h,a,u,p,c;for(i+=n,u=r/o,s=i/n,p=[],this.Stack.push({_torch_asset:"texture",id:e,path:t}),h=a=0;h<s;){for(;a<u;)c={clipX:h*n,clipY:a*o,clipWidth:n,clipHeight:o},p.push(c),a++;h++}return this.textureSheets[e]=p},t.prototype.File=function(t,e){return this.finish_stack++,this.Stack.push({_torch_asset:"file",id:e,path:t})},t.prototype.LoadItemFinished=function(){var t;if(this.finish_stack--,this.progress=(this.totalLoad-this.finish_stack)/this.totalLoad,this.game.Emit("LoadProgressed",new Torch.Event(this.game,{progress:this.progress})),this.finish_stack<=0)return document.getElementsByClassName("font-loader")[0].remove(),this.loadFinished(),t=((new Date).getTime()-this.startTime)/1e3,console.log("%c"+this.game.name+" loaded in "+t+"s","background-color:green; color:white; padding:2px;padding-right:5px;padding-left:5px")},t.prototype.Load=function(t){var e,i,r,n,o,s,h,a,u;this.loadFinished=t,this.totalLoad=this.finish_stack,this.startTime=(new Date).getTime();try{for(h=this.Stack,a=[],n=0,o=h.length;n<o;n++)switch(u=h[n],u._torch_asset){case"texture":r=new Image,r.src=u.path,u.image=r,this.textures[u.id]=u,r.refId=u.id,r.stackItem=u,r.loader=this,a.push(r.onload=function(){return this.loader.textures[this.stackItem.id].width=this.width,this.loader.textures[this.stackItem.id].height=this.height,this.loader.LoadItemFinished()});break;case"sound":e=new Audio,e.src=u.path,u.audio=e,this.sound[u.id]=u,this.LoadItemFinished(),a.push(e.toggle=function(){return this.currentTime=0,this.play()});break;case"audio":s=new Torch.AjaxLoader(u.path,Torch.AjaxData.ArrayBuffer),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.audio[i.stackItem.id]={},t.audio[i.stackItem.id].encodedAudioData=e,t.game.Audio.DecodeAudioData(e,function(e){return t.audio[i.stackItem.id].audioData=e,t.LoadItemFinished()})}}(this)),a.push(s.Load());break;case"file":Torch.ELECTRON?a.push(Torch.fs.readFile(u.path,"utf8",function(t){return function(e,i){return t.LoadItemFinished(),e?t.game.FatalError(new Error("Torch.Load.File file '{0}' could not be loaded".format(u.path))):t.game.Files[u.id]=i}}(this))):(s=new Torch.AjaxLoader(u.path,Torch.AjaxData.Text),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.LoadItemFinished(),t.game.Files[i.stackItem.id]=e}}(this)),a.push(s.Load()));break;default:a.push(void 0)}return a}catch(t){return i=t,console.log("%c"+this.game.name+" could not load!","background-color:"+Torch.Color.Ruby+"; color:white; padding:2px;padding-right:5px;padding-left:5px"),Torch.FatalError(i)}},t}(),Torch.Load=Load,Timer=function(){function t(t){this.game=t,this.futureEvents=[]}return t.prototype.Update=function(){var t,e,i,r,n;for(r=this.futureEvents,n=[],e=0,i=r.length;e<i;e++)t=r[e],n.push(t.Update());return n},t.prototype.SetFutureEvent=function(t,e){return this.futureEvents.push(new Torch.FutureEvent(t,e,this.game))},t}(),FutureEvent=function(){function t(t,e,i){this.timeToOccur=t,this.handle=e,this.game=i,this.time=0}return t.prototype.Update=function(){if(this.time+=this.game.deltaTime,this.time>=this.timeToOccur&&null!==this.handle&&void 0!==this.handle)return this.handle(),this.handle=null},t}(),Torch.Timer=Timer,Torch.FutureEvent=FutureEvent,Mouse=function(){function t(t){this.game=t,this.x=0,this.y=0,this.down=!1}return t.prototype.SetMousePos=function(t,e){var i;return i=t.getBoundingClientRect(),this.x=e.clientX-i.left,this.y=e.clientY-i.top},t.prototype.GetRectangle=function(){return new Torch.Rectangle(this.x,this.y,5,5)},t}(),Torch.Mouse=Mouse,Camera=function(){function t(t){this.game=t,this.position=new Torch.Point(0,0),this.Viewport=new Viewport(this)}return t.prototype.position=null,t.prototype._jerkFollow=null,t.prototype.JerkFollow=function(t,e,i){return null==e&&(e=5),null==i&&(i={maxLeft:-500,maxRight:2e3,maxTop:-500,maxBottom:2e3}),this._jerkFollow=new JerkFollow(this,t,e,i)},t.prototype.Update=function(){if(this.Viewport.Update(),null!=this._jerkFollow)return this._jerkFollow.Update()},t}(),Viewport=function(){function t(t){this.camera=t,this.maxWidth=this.width=window.innerWidth,this.maxHeight=this.height=window.innerHeight,this.rectangle=new Torch.Rectangle(this.camera.position.x,this.camera.position.y,this.width,this.height)}return t.prototype.width=0,t.prototype.height=0,t.prototype.maxWidth=0,t.prototype.maxHeight=0,t.prototype.Update=function(){return this.rectangle.x=this.camera.position.x,this.rectangle.y=this.camera.position.y,this.rectangle.width=this.width,this.rectangle.height=this.height},t}(),JerkFollow=function(){function t(t,e,i,r){var n;this.camera=t,this.sprite=e,this.config=r,n=this.camera.Viewport,this.game=this.camera.game,this.Inc=n.width/i,this.boundLeft=n.width/i,this.boundRight=n.width-this.boundLeft,this.boundTop=0}return t.prototype.boundLeft=0,t.prototype.boundRight=0,t.prototype.boundTop=0,t.prototype.boundBottom=0,t.prototype.Inc=0,t.prototype.Update=function(){if(this.sprite.position.x>=this.boundRight){if(this.sprite.position.x>=this.config.maxRight)return void(this.sprite.position.x=this.boundRight);this.boundRight+=this.Inc,this.boundLeft+=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x-this.Inc})}if(this.sprite.position.x<=this.boundLeft){if(this.sprite.position.x<=this.config.maxLeft)return void(this.sprite.position.x=this.boundLeft);this.boundRight-=this.Inc,this.boundLeft-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x+this.Inc})}if(this.sprite.position.y<=this.boundTop)return this.sprite.position.y<=this.config.maxTop?void(this.sprite.position.y=this.boundTop):(this.boundTop-=this.Inc,this.boundBottom-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.y+this.Inc}))},t}(),Torch.Camera=Camera,Layer=function(){function t(t){this.drawIndex=t,this.children=[],this.mapIndex-this.drawIndex}return t.prototype.DrawIndex=function(t){var e,i,r,n;if(!t)return this.drawIndex;for(this.drawIndex=t,n=this.children,i=0,r=n.length;i<r;i++)e=n[i],e.DrawIndex(t);return this},t.prototype.Add=function(t){return t.DrawIndex(this.index),this.children.push(t)},t}(),Layers=function(){function t(t){this.game=t,this.layers=[],this.layerMap={}}return t.prototype.Add=function(t){var e,i,r,n,o;if(i=null,"string"==typeof t)return i=new Layer(this.layers.length),this.layerName[t]=i,this.layers.add(i);for(o=[],e=0,r=t.length;e<r;e++)n=t[e],i=new Layer(this.layers.length),this.layerMap[n]=i,o.push(this.layers.add(i));return o},t.prototype.Remove=function(t,e){var i,r,n,o,s,h,a,u,p;if(this.layerMap[t]){for(i=[],h=layerMap[t],h.Trash(),delete this.layerMap[t],u=this.layers,p=[],r=o=0,a=u.length;o<a;r=++o)n=u[r],s=i[r],r!==h.mapIndex?(i.push(s),e?p.push(s.DrawIndex(s.DrawIndex()-1)):p.push(void 0)):p.push(void 0);return p}return Torch.FatalError("Unable to remove layer '"+t+"'. Layer does not exist")},t.prototype.Get=function(t){return this.layerMap[t]?this.layerMap[t]:Torch.FatalError("Unable to get layer '"+t+"'. Layer does not exist")},t}(),Torch.Layers=Layers,Torch.Style=function(){var t,e;return t=document.body,t.style.backgroundColor="black",t.style.overflow="hidden",e=document.getElementsByTagName("CANVAS")[0],e.style.border="1px solid orange",e.style.cursor="pointer"},Debug=function(){function t(t){this.game=t,this.text="",this.CreateHtmlDisplay()}return t.prototype.CreateHtmlDisplay=function(){var t;return t=document.createElement("DIV"),t.style.position="absolute",t.style.display="block",t.style.color="white",t.style.font="monospace",t.style.top=0,document.body.appendChild(t),this.display=t},t.prototype.Update=function(){},t}(),Torch.Debug=Debug,exports=this,Key=function(){function t(t){this.keyCode=t,this.InitEventDispatch()}return t.MixIn(Torch.EventDispatcher),t.prototype.down=!1,t}(),Keys=function(){function t(){this.specialKeys={8:"Delete",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"PauseBreak",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow",45:"Insert",46:"Delete2",48:"Num0",49:"Num1",50:"Num2",51:"Num3",52:"Num4",53:"Num5",54:"Num6",55:"Num7",56:"Num8",57:"Num9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",106:"NumPadMultiply",107:"NumPadPlus",109:"NumPadMinus",110:"NumPadPeriod",111:"NumPadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Colon",187:"NumPlus",188:"Comma",189:"NumMinus",190:"Period",191:"ForwardSlash",192:"Tilda",219:"BracketLeft",221:"BracketRight",220:"BackSlash",222:"Quote"},this.InitKeys()}return t.MixIn(Torch.EventDispatcher),t.prototype.SpecialKey=function(t){var e,i,r;i=this.specialKeys;for(e in i)if(r=i[e],t.toString()===e.toString())return this[r];return null},t.prototype.InitKeys=function(){var t,e,i,r,n,o,s;for(e=this,i=0;i<230;)t=String.fromCharCode(i).toUpperCase(),e[t]=new Key(i),i++;n=this.specialKeys,o=[];for(r in n)s=n[r],o.push(e[s]=new Key(r));return o},t}(),Torch.Keys=Keys,Torch.Easing=Torch.Enum("Linear","Square","Cube","InverseSquare","InverseCube","Smooth","SmoothSquare","SmoothCube","Sine","InverseSine"),Tween=function(){function t(t,e,i,r,n){var o,s,h;this.game=t,this.objectToTween=e,this.tweenProperties=i,this.timeTweenShouldTake=r,this.easing=n,this.InitEventDispatch(),this.game.Tweens.tweens.push(this),this.originalObjectValues={},s=this.tweenProperties;for(o in s)h=s[o],this.originalObjectValues[o]=this.objectToTween[o]}return t.MixIn(Trashable),t.MixIn(EventDispatcher),t.prototype.objectToTween=null,t.prototype.tweenProperties=null,t.prototype.originalObjectValues=null,t.prototype.elapsedTime=0,t.prototype.timeTweenShouldTake=0,t.prototype.easing=null,t.prototype.Update=function(){var t,e,i,r,n;i=this.elapsedTime/this.timeTweenShouldTake,t=this.Ease(i),r=this.tweenProperties;for(e in r)n=r[e],this.objectToTween[e]=this.tweenProperties[e]*t+this.originalObjectValues[e]*(1-t);if(this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.timeTweenShouldTake)return this.Emit("Finish",new Torch.Event(this.game,{tween:this})),this.Trash()},t.prototype.Ease=function(t){switch(this.easing){case Torch.Easing.Linear:return t;case Torch.Easing.Square:return Math.pow(t,2);case Torch.Easing.Cube:return Math.pow(t,3);case Torch.Easing.InverseSquare:return 1-Math.pow(1-t,2);case Torch.Easing.InverseCube:return 1-Math.pow(1-t,3);case Torch.Easing.Smooth:return t*t*(3-2*t);case Torch.Easing.SmoothSquare:return Math.pow(t*t*(3-2*t),2);case Torch.Easing.SmoothCube:return Math.pow(t*t*(3-2*t),3);case Torch.Easing.Sine:return Math.sin(t*Math.PI/2);case Torch.Easing.InverseSine:return 1-Math.sin((1-t)*Math.PI/2)}},t}(),TweenSetup=function(){function t(t,e,i,r){this.game=t,this.object=e,this.timeTweenShouldTake=i,this.easing=null!=r?r:Torch.Easing.Smooth}return t.prototype.To=function(t){return new Tween(this.game,this.object,t,this.timeTweenShouldTake,this.easing)},t.prototype.From=function(t){var e,i;for(e in t)i=t[e],this.object[e]=i;return this},t}(),TweenManager=function(){function t(t){this.game=t,this.tweens=[]}return t.prototype.Update=function(){var t,e,i,r,n,o;for(t=[],r=this.tweens,n=[],e=0,i=r.length;e<i;e++)o=r[e],o.trash?n.push(void 0):(t.push(o),n.push(o.Update()));return n},t.prototype.Tween=function(t,e){return new TweenSetup(this.game,t,e)},t.prototype.All=function(t){var e,i,r,n,o;for(r=this.game.tweens,n=[],e=0,i=r.length;e<i;e++)o=r[e],n.push(t(o));return n},t}(),Torch.TweenManager=TweenManager,ParticleEmitter=function(t){function e(t,e,i,r,n,o,s){this.game=t,this.interval=r,this.loop=n,this.particle=o,this.config=s,this.InitSprite(this.game,e,i),this.elapsedTime=0,this.hasEmitted=!1}return extend(e,t),e.prototype.particle=null,e.prototype.auto=!0,e.prototype.Update=function(){if(e.__super__.Update.call(this),void 0!==this.interval){if(!this.hasEmitted)return this.UpdateParticleEmitter();if(this.loop)return this.UpdateParticleEmitter()}},e.prototype.Particle=function(t){return t=t},e.prototype.UpdateParticleEmitter=function(){if(this.auto)return this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.interval?(this.EmitParticles(),this.hasEmitted=!0,this.elapsedTime=0):void 0},e.prototype.EmitParticles=function(t){var e;for(null==t&&(t=!1),e=0;e<this.config.spread;)e++,this.EmitParticle();if(t)return this.Trash()},e.prototype.EmitParticle=function(){var t,e,i,r,n,o,s;return e=Torch.RandomInRange(this.config.minAngle,this.config.maxAngle),n=Torch.RandomInRange(this.config.minScale,this.config.maxScale),t=Torch.RandomInRange(this.config.minAlphaDecay,this.config.maxAlphaDecay),r=Torch.RandomInRange(this.config.minRadius,this.config.maxRadius),o=this.position.x,s=this.position.y,"string"!=typeof this.particle?i=new this.particle(this.game,o,s):(i=new Torch.Sprite(this.game,o,s),i.Bind.Texture(this.particle)),i.Body.velocity.x=Math.cos(e)*Torch.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.velocity.y=Math.sin(e)*Torch.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.omega=Torch.RandomInRange(this.config.minOmega,this.config.maxOmega),i.Size.scale.width=n,i.Size.scale.height=n,i.drawIndex=1e3,this.game.Tweens.Tween(i,t,Torch.Easing.Smooth).To({opacity:0}).On("Finish",function(){return i.Trash()})},e}(Torch.Sprite),ParticleManager=function(){function t(t){this.game=t}return t.prototype.ParticleEmitter=function(t,e,i,r,n,o){return new ParticleEmitter(this.game,t,e,i,r,n,o)},t}(),Torch.ParticleManager=ParticleManager,Sound=function(){function t(t){this.soundId=t}return t.prototype.volume=1,t.prototype.pan=0,t}(),Audio=function(){function t(t){this.game=t,this.GetAudioContext()}return t.prototype.audioContext=null,t.prototype.MasterVolume=1,t.prototype.GetAudioContext=function(){var t;try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext}catch(e){return t=e,console.warn("Unable to initialize audio...")}},t.prototype.DecodeAudioData=function(t,e){return this.audioContext.decodeAudioData(t,function(t){return e(t)})},t.prototype.CreateAudioPlayer=function(){return new AudioPlayer(this)},t}(),AudioPlayer=function(){function t(t){this.audioContext=t.audioContext,this.game=t.game}return t.prototype.volume=1,t.prototype.CreateGain=function(t){var e;return null==t&&(t=1),e=this.audioContext.createGain(),e.gain.value=t,e},t.prototype.Play=function(t){return this.game.FatalError("Cannot play sound. sound must be Torch.Sound")},t.prototype.PlaySound=function(t,e,i){var r,n,o,s,h,a;for(null==e&&(e=0),null==i&&(i=null),a=this.audioContext.createBufferSource(),a.buffer=this.game.Assets.Audio[t].audioData,1!==this.game.Audio.MasterVolume&&(null===i?i=[this.CreateGain(this.game.Audio.MasterVolume)]:i.push(this.CreateGain(this.game.Audio.MasterVolume))),i=null===i?[this.CreateGain(this.volume)]:slice.call(i).concat([this.CreateGain(this.volume)]),s=null,n=o=0,h=i.length;o<h;n=++o)if(r=i[n],null===s?a.connect(r):s.connect(r),s=r,n===i.length-1)return r.connect(this.audioContext.destination),void a.start(e);return a.connect(this.audioContext.destination),a.start(e)},t}(),Torch.Audio=Audio,HookManager=function(){function t(t){this.game=t,this.positionTransform=new Torch.Point(0,0)}return t.prototype.positionTransform=null,t}(),Torch.HookManager=HookManager,CanvasGame=function(){function t(t,e,i,r,n,o){this.canvasId=t,this.width=e,this.height=i,this.name=r,this.graphicsType=n,this.pixel=null!=o?o:0,this.InitGame()}return t.MixIn(Torch.EventDispatcher),t.prototype.InitGame=function(){return this.InitEventDispatch(),this.InitGraphics(),this.InitComponents()},t.prototype.InitComponents=function(){var t,e;return e="background-color:orange; color:white; padding:2px; padding-right:5px;padding-left:5px",t="WebGL",this.graphicsType===Torch.CANVAS&&(t="Canvas"),console.log("%c Torch v"+Torch.version+" |"+t+"| - "+this.name,e),this.Loop=new Torch.Loop(this),this.Load=new Torch.Load(this),this.Mouse=new Torch.Mouse(this),this.Timer=new Torch.Timer(this),this.Camera=new Torch.Camera(this),this.Layers=new Torch.Layers(this),this.Debug=new Torch.Debug(this),this.Keys=new Torch.Keys(this),this.Tweens=new Torch.TweenManager(this),this.Particles=new Torch.ParticleManager(this),this.Audio=new Torch.Audio(this),this.Hooks=new Torch.HookManager(this),Torch.Style(),this.deltaTime=0,this.fps=0,this.averageFps=0,this.allFPS=0,this.ticks=0,this.zoom=1,this.uidCounter=0,this.paused=!1,this.time=null,this.LastTimeStamp=null,this.spriteList=[],this.threeList=[],this.taskList=[],this.animations=[],this.tweens=[],this.DrawStack=[],this.AddStack=[],this.GamePads=[],this.events={},this.filter={}},t.prototype.InitGraphics=function(){return this.canvasNode=document.createElement("CANVAS"),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,document.getElementById(this.canvasId).appendChild(this.canvasNode),this.canvas=this.canvasNode.getContext("2d"),this.Clear("#cc5200")},t.prototype.PixelScale=function(){return this.canvas.webkitImageSmoothingEnabled=!1,this.canvas.mozImageSmoothingEnabled=!1,this.canvas.imageSmoothingEnabled=!1,this},t.prototype.Start=function(t,e,i,r){if(void 0===t&&this.FatalError("Unable to start game '"+this.name+"' without load function"),void 0===e&&this.FatalError("Unable to start game '"+this.name+"' without update function"),void 0===i&&this.FatalError("Unable to start game '"+this.name+"' without draw function"),void 0===r&&this.FatalError("Unable to start game '"+this.name+"' without update function"),this.load=t,this.update=e,this.draw=i,this.init=r,this.load(this),this.Load.Load(function(t){return function(){return t.init(t),t.WireUpEvents(),t.Run()}}(this)),this.graphicsType!==Torch.WEBGL)return this.canvasNode.width=this.width,this.canvasNode.height=this.height,"string"==typeof this.width&&(this.canvasNode.width=document.body.clientWidth-50),"string"==typeof this.height?this.canvasNode.height=document.body.clientHeight-25:void 0},t.prototype.Add=function(t){return void 0!==t&&void 0!==t._torch_add||this.FatalError("Cannot add object: "+t.constructor.name+" to game"),"Sprite"===t._torch_add?(t._torch_uid="TORCHSPRITE"+this.uidCounter.toString(),t._torch_add_order=this.uidCounter,this.AddStack.push(t),this.uidCounter++):"Three"===t._torch_add?(t.game=this,this.gl_scene.add(t.entity)):"Task"===t._torch_add?this.taskList.push(t):void 0},t.prototype.Task=function(t){return this.taskList.push(t),this},t.prototype.Run=function(t){return this.Loop.Run(0)},t.prototype.FlushSprites=function(){var t,e,i,r,n;for(i=this.spriteList,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(n.Trash());return r},t.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),this.Clear("#000"),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302Cmargin-left:15%font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302Cfont-size:20pxfont-weight:bold'>Stack Trace:</code>\n<br>\n<code style='color:#C9302Cfont-size:20px'>"+i+"</code>\n<br>\n<code style='color:#C9302Cfont-size:18px'>Time: "+this.time+"</code>",document.body.innerHTML=e,this.RunGame=function(){},this.Run=function(){},this.Emit("FatalError",new Torch.Event(this,{error:t})),t},t.prototype.UpdateTasks=function(){var t,e,i,r;for(i=this.taskList,t=0,e=i.length;t<e;t++)r=i[t],r.Execute(this);return this.taskList=Torch.Util.Array(this.taskList).Filter(function(t){return!t.trash})},t.prototype.UpdateSprites=function(){var t,e,i,r;for(i=this.spriteList,t=0,e=i.length;t<e;t++)r=i[t],r.trash?(r.trashed=!0,r.Emit("Trash",new Torch.Event(this))):r.game.paused||r.Update();return this.spriteList=Torch.Util.Array(this.spriteList).Filter(function(t){return!t.trash}),this.spriteList=this.spriteList.concat(this.AddStack),this.AddStack=[]},t.prototype.DrawSprites=function(){var t,e,i,r,n;for(this.canvas.clearRect(0,0,this.Camera.Viewport.maxWidth,this.Camera.Viewport.maxHeight),this.spriteList.sort(function(t,e){return t.drawIndex===e.drawIndex?t._torch_add_order-e._torch_add_order:t.drawIndex-e.drawIndex}),i=this.spriteList,r=[],t=0,e=i.length;t<e;t++)n=i[t],!n.draw||n.trash||n.GHOST_SPRITE?r.push(void 0):r.push(n.Draw());return r},t.prototype.UpdateAnimations=function(){var t,e,i,r,n;for(r=this.animations,n=[],e=0,i=r.length;e<i;e++)t=r[e],n.push(t.Run());return n},t.prototype.UpdateTimeInfo=function(){return this.fps=Math.round(1e3/this.deltaTime),this.fps===1/0?this.allFPS+=0:this.allFPS+=Math.round(1e3/this.deltaTime),this.ticks++,this.averageFps=Math.round(this.allFPS/this.ticks)},t.prototype.UpdateGamePads=function(){var t,e,i,r,n;if(navigator.getGamepads&&(navigator.getGamepads,!0)){for(this.GamePads=[],r=navigator.getGamepads(),n=[],t=0,e=r.length;t<e;t++)i=r[t],i?n.push(this.GamePads.push(new Torch.GamePad(i))):n.push(void 0);return n}},t.prototype.Clear=function(t){return void 0===t&&this.FatalError("Cannot clear undefined color"),"object"==typeof t&&(t=t.hex),this.canvasNode.style.backgroundColor=t,this},t.prototype.File=function(t){return void 0===this.Files[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Files[t]},t.prototype.Sound=function(t){return void 0===this.Assets.Sounds[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Assets.Sounds[t].audio},t.prototype.getCanvasEvents=function(){var t;return t=[["mousemove",function(t){return function(e){return t.Mouse.SetMousePos(t.canvasNode,e),t.Emit("MouseMove",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mousedown",function(t){return function(e){return t.Mouse.down=!0,t.Emit("MouseDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mouseup",function(t){return function(e){return t.Mouse.down=!1,t.Emit("MouseUp",new Torch.Event(t,{nativeEvent:e}))}}(this)],["touchstart",function(t){return function(e){return t.Mouse.down=!0}}(this)],["touchend",function(t){return function(e){return t.Mouse.down=!1}}(this)],["click",function(t){return function(e){return e.preventDefault(),e.stopPropagation(),t.Emit("Click",new Torch.Event(t,{nativeEvent:e})),!1}}(this)]]},t.prototype.getBodyEvents=function(){var t;return t=[["keydown",function(t){return function(e){var i,r;return i=e.keyCode,r=t.Keys.SpecialKey(i),null===r&&(r=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),r.down=!0,r.Emit("KeyDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["keyup",function(t){return function(e){var i,r;return i=e.keyCode,r=t.Keys.SpecialKey(i),null===r&&(r=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),r.down=!1,r.Emit("KeyUp",new Torch.Event(t,{nativeEvent:e}))}}(this)]]},t.prototype.WireUpEvents=function(){var t,e,i,r,n,o,s,h,a;for(s=this.getCanvasEvents(),e=0,i=s.length;e<i;e++)t=s[e],this.canvasNode.addEventListener(t[0],t[1],!1);for(h=this.getBodyEvents(),n=0,r=h.length;n<r;n++)t=h[n],document.body.addEventListener(t[0],t[1],!1);return a=function(t){return function(e){return t.Emit("Resize",new Torch.Event(t,{nativeEvent:e}))}}(this),window.addEventListener("resize",a,!1),o=navigator.getGamepads()},t.prototype.TogglePause=function(){return this.paused?this.paused=!1:this.paused=!0,this},t}(),Torch.CanvasGame=CanvasGame,WebGLGame=function(t){function e(t,e,i,r,n,o){this.canvasId=t,this.width=e,this.height=i,this.name=r,this.graphicsType=n,this.pixel=null!=o?o:0,this.InitGame()}return extend(e,t),e.prototype.InitGraphics=function(){return this.gl_rendererContainer=document.getElementById(this.canvasId),this.gl_scene=new THREE.Scene,this.gl_scene.add(new THREE.AxisHelper(100)),this.gl_camera=new THREE.PerspectiveCamera(100,window.innerWidth/window.innerHeight,1,1e3),this.gl_camera.position.z=600,this.gl_renderer=new THREE.WebGLRenderer({antialias:this.pixel!==Torch.PIXEL,alpha:!0}),this.gl_renderer.setSize(window.innerWidth,window.innerHeight),this.gl_renderer.setPixelRatio(window.devicePixelRatio),this.canvasNode=this.gl_renderer.domElement,this.gl_rendererContainer.appendChild(this.canvasNode),this.On("Resize",function(t){return function(e){return t.gl_renderer.setSize(t.Viewport.width,t.Viewport.height),t.gl_camera.aspect=t.Viewport.width/t.Viewport.height,t.gl_camera.updateProjectionMatrix()}}(this))},e.prototype.DrawSprites=function(){var t,e,i,r;for(this.spriteList.sort(function(t,e){return t.drawIndex-e.drawIndex}),i=this.spriteList,t=0,e=i.length;t<e;t++)r=i[t],!r.draw||r.trash||r.GHOST_SPRITE||r.Draw(),r.trash&&r.Three().Remove();return this.gl_camera.lookAt(this.gl_scene.position),this.gl_renderer.render(this.gl_scene,this.gl_camera)},e.prototype.UpdateSprites=function(){var t,e,i,r,n;for(t=[],r=this.spriteList,e=0,i=r.length;e<i;e++)n=r[e],n.trash?(void 0!==n.Three()&&n.Three().Remove(),n.trashed=!0,n.Emit("Trash")):(n.game.paused||n.Update(),t.push(n));return this.spriteList=t},e.prototype.GetThreeTransform=function(t,e){var i,r,n,o,s;return s=new THREE.Vector3,i=this.gl_camera,s.set(t/window.innerWidth*2-1,2*-(e/window.innerHeight)+1,1),s.unproject(i),r=s.sub(i.position).normalize(),n=-i.position.z/r.z,o=i.position.clone().add(r.multiplyScalar(n))},e}(Torch.CanvasGame),Torch.WebGLGame=WebGLGame,Game=function(){function t(t,e,i,r,n,o){return n===Torch.CANVAS?new Torch.CanvasGame(t,e,i,r,n,o):n===Torch.WEBGL?new Torch.WebGLGame(t,e,i,r,n,o):void 0}return t}(),Torch.Game=Game,exports=this,Torch.Platformer={Gravity:.001,SHIFT_COLLIDE_LEFT:5,SetWorld:function(t){return Torch.Platformer.spawnItems=t}},Actor=function(){function t(){
throw"Actor is a base class"}return t.prototype.ACTOR=!0,t.prototype.Health=100,t.prototype.currentFriction=1,t.prototype.inFluid=!1,t.prototype.onGround=!1,t.prototype.onLeft=!1,t.prototype.onTop=!1,t.prototype.onRight=!1,t.prototype.hitLockCounter=0,t.prototype.hitLockBlinkCounter=0,t.prototype.hitLock=!1,t.prototype.hitLockMax=1e3,t.prototype.HitLock=function(){return this.hitLock=!0},t.prototype.Hit=function(t){if(null==t&&(t=1),this.Health-=t,this.Health<=0)return this.Die},t.prototype.Die=function(){return this.isDead=!0},t.prototype.BlockCollision=function(t,e){if(e&&e.vx<e.halfWidths&&e.vy<e.halfHeights)if(e.x<e.y){if(this.Body.Velocity("y",0),e.vx>0)return t.Sprite.Slope?this.BlockSlope(t.Sprite,e):(this.Rectangle.x+=e.x+Torch.Platformer.SHIFT_COLLIDE_LEFT,this.Body.Velocity("x",0),this.onLeft=!0);if(e.vx<0)return t.Sprite.Slope?this.BlockSlope(t.Sprite,e):(this.Rectangle.x-=e.x,this.Body.Velocity("x",0),this.onRight=!0)}else if(e.x>e.y){if(e.vy>0)return this.Rectangle.y+=e.y,this.Body.Velocity("y",0);if(e.vy<0){if(t.Sprite.Slope)return this.BlockSlope(t.Sprite,e);if(this.Rectangle.y-=e.y-t.Sprite.sink,this.Body.Acceleration("y",0).Velocity("y",0),this.onGround=!0,!this.inFluid)return this.currentFriction=t.Sprite.friction}}},t.prototype.BlockSlope=function(t,e){var i;return i=e.x*Math.tan(t.Slope),this.Rectangle.y=t.Rectangle.y+(t.Rectangle.height-i)-this.Rectangle.height,this.onSlope=!0},t.prototype.FluidCollision=function(t,e){if(e)return this.currentFriction=t.Sprite.friction,this.Body.y.acceleration=t.Sprite.gravity,this.inFluid=!0},t.prototype.UpdateActor=function(){var t,e,i,r,n,o;for(this.inFluid=!1,this.onGround=!1,this.onTop=!1,this.onRight=!1,this.onLeft=!1,o=Torch.Platformer.spawnItems,e=0,i=o.length;e<i;e++)t=o[e],n=this.Rectangle,t.spawned&&t.Sprite&&t.Sprite.BLOCK&&this.NotSelf(t.Sprite)&&this.ACTOR&&(r=this.Rectangle.Intersects(t.Sprite.Rectangle),this.BlockCollision(t,r)),t.spawned&&t.Sprite&&t.Sprite.FLUID&&this.NotSelf(t.Sprite)&&this.ACTOR&&(r=this.Rectangle.Intersects(t.Sprite.Rectangle),this.FluidCollision(t,r)),this.onGround||this.inFluid||(this.Body.y.acceleration=Torch.Platformer.Gravity);if(this.hitLock&&(this.hitLockCounter+=Game.deltaTime,this.hitLockBlinkCounter+=Game.deltaTime,this.hitLockBlinkCounter>=200&&(.1===this.opacity?this.opacity=.8:this.opacity=.1,this.hitLockBlinkCounter=0),this.hitLockCounter>=this.hitLockMax))return this.hitLock=!1,this.opacity=1,this.hitLockCounter=0,this.hitLockBlinkCounter=0},t}(),Block=function(){function t(){throw"Block is a base class"}return t.prototype.BLOCK=!0,t.prototype.friction=1,t.prototype.sink=0,t}(),Fluid=function(){function t(){throw"Fluid is a base class"}return t.prototype.FLUID=!0,t.prototype.friction=.3,t.prototype.gravity=1e-4,t.prototype.drawIndex=30,t}(),Spawner=function(t){function e(t){this.spawnItems=t,Torch.Platformer.SetWorld(this.spawnItems)}return extend(e,t),e}(Torch.GhostSprite),SpawnItem=function(){function t(t,e,i,r){this.spawnType=t,this.spawned=e,this.obj=i,this.position=r,this.obj&&(this.Sprite=this.obj)}return t}(),exports.Facing=Torch.Enum("Right","Left"),exports.Walking=Torch.Enum("Right","Left","None"),Torch.Platformer.Actor=Actor,Torch.Platformer.Block=Block,Torch.Platformer.Fluid=Fluid,Torch.Platformer.Spawner=Spawner,Torch.Platformer.spawnItem=SpawnItem,Torch.Sound={},PlayList=function(t){function e(t,e){this.game=t,this.songList=e,this.currentSong=this.songList[0],this.index=0}return extend(e,t),e.prototype.Play=function(){return this.game.Assets.GetSound(this.currentSong).volume=.7,this.game.Assets.GetSound(this.currentSong).play(),this},e.prototype.ShuffleArray=function(t){var e,i,r;for(e=t.length,r=null,i=null;0!==e;)i=Math.floor(Math.random()*e),e-=1,r=t[e],t[e]=t[i],t[i]=r;return t},e.prototype.Randomize=function(){return this.songList=this.ShuffleArray(this.songList),this.currentSong=this.songList[0],this},e.prototype.Update=function(){if(this.game.Assets.GetSound(this.currentSong).currentTime>=this.game.Assets.GetSound(this.currentSong).duration&&(this.index++,this.currentSong=this.songList[this.index],this.Play(),this.index===this.songList.length-1))return this.index=0},e}(Torch.GhostSprite),StateMachine=function(){function t(t){this.obj=t,this.currentState=null,this.states={},this.game=this.obj.game}return t.prototype.State=function(t,e){return void 0===e?(void 0===this.states[t]&&Torch.FatalError("Unable to get state. State '"+t+"' has not been added to the state machine"),this.states[t]):(e.stateMachine=this,e.game=this.game,this.states[t]=e)},t.prototype.Switch=function(){var t,e,i,r;return e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],this.currentState&&void 0!==this.currentState.End&&(i=this.currentState).End.apply(i,[this.obj].concat(slice.call(t))),void 0!==this.State(e).Start&&(r=this.State(e)).Start.apply(r,[this.obj].concat(slice.call(t))),this.currentState=this.State(e)},t.prototype.Update=function(){if(null!==this.currentState&&void 0!==this.currentState)return this.currentState.Execute(this.obj)},t}(),State=function(){function t(t,e,i){this.Execute=t,this.Start=e,this.End=i}return t}(),Torch.StateMachine=StateMachine,Torch.StateMachine.State=State,Bind=function(){function t(t){return t.GL?new WebGLBind(t):new CanvasBind(t)}return t}(),CanvasBind=function(){function t(t){this.sprite=t}return t.prototype.Texture=function(t,e){var i,r;return r=null,"string"==typeof t?(r=this.sprite.game.Assets.Textures[t],r||this.sprite.game.FatalError("Sprite.Bind.Texture given textureId '"+t+"' was not found")):r=t,i=1,"string"==typeof t?this.sprite.DrawTexture=r:this.sprite.DrawTexture={image:t},this.sprite.Size.Set(r.width,r.height),this.sprite.DrawTexture.drawParams={clipX:0,clipY:0,clipWidth:this.sprite.DrawTexture.image.width,clipHeight:this.sprite.DrawTexture.image.height},this.sprite.DrawTexture},t}(),Torch.Bind=Bind,Animation=function(){function t(t){this.game=t}return t.prototype.Run=function(){if(this.animating&&this.Update(),this.Kill&&this.hasRun)return this.Stop()},t.prototype.Start=function(){return this.animating=!0},t.prototype.Stop=function(){return this.animating=!1},t.prototype.Single=function(){return this.KillOnFirstRun=!0,this.animating=!0},t.prototype.Reset=function(){return this.elapsedTime=0,this.textureListIndex=0,this.hasRun=!1},t}(),TexturePack=function(t){function e(t,e){this.texturePack=t,this.game=e,this.step=50,this.maxIndex=texturePack.length-1,this.textureIndex=0,this.elapsedTime=0,this.game.animations.push(this)}return extend(e,t),e.prototype.Update=function(){if(this.elapsedTime+=this.game.deltaTime,this.elapsedTime>=this.step&&(this.elapsedTime=0,this.textureIndex++),this.textureIndex>this.maxIndex)return this.Kill||(this.textureIndex=0),this.Kill&&(this.textureIndex=-1),this.hasRun=!0},e.prototype.GetCurrentFrame=function(){return this.game.Assets.Textures[this.texturePack[this.textureIndex]]},e}(Animation),TextureSheet=function(t){function e(t,e){this.TextureSheet=t,this.game=e,this.step=50,this.maxIndex=this.TextureSheet.length-1,this.textureIndex=0,this.elapsedTime=0,this.delay=0,this.delayCount=0,this.onStep=null,this.game.animations.push(this)}return extend(e,t),e.prototype.Update=function(){return this.elapsedTime+=this.game.deltaTime,!(this.elapsedTime>=this.step)||this.hasRun&&this.Kill||(this.elapsedTime=0,this.textureIndex++,this.onStep&&this.onStep(this.textureIndex)),this.textureIndex>=this.maxIndex&&this.delayCount<=0?(this.Kill||(this.textureIndex=0),this.hasRun=!0,this.finishCallBack&&this.finishCallBack(),this.delayCount=this.delay):this.textureIndex>=this.maxIndex?(this.delayCount-=Game.deltaTime,this.textureIndex--):void 0},e.prototype.GetCurrentFrame=function(){if(this.TextureSheet)return this.TextureSheet[this.textureIndex]},e.prototype.Step=function(t,e){return void 0===t?this.step:(this.step=t,void 0!==e&&(this.onStep=e),this)},e}(Animation),StepAnimation=function(t){function e(t,e,i,r,n){this.InitSprite(t,0,0),this.steps=i,this.totalTime=e,this.interval=e/i.length,this.time=0,this.index=0,this.steps[0](),this.start=r,this.end=n,r&&this.start()}return extend(e,t),e.prototype.Update=function(){if(this.time+=this.game.deltaTime,this.time>=this.interval&&(this.time=0,this.index++,this.steps[this.index](),this.index===this.steps.length-1))return this.end&&this.end(),this.Trash()},e}(Torch.GhostSprite),Torch.Animation=Animation,Torch.Animation.TextureSheet=TextureSheet,Torch.Animation.TexturePack=TexturePack,Torch.Animation.StepAnimation=StepAnimation,Color=function(){function t(t,e,i,r){this.hex="",this.Red=0,this.Green=0,this.Blue=0,this.Alpha=1,this.Init(t,e,i,r)}return t.prototype.Init=function(t,e,i,r){return void 0===e&&null!==e?this.GetHexFromRGB(t,e,i,r):this.GetRGBFromHex(t)},t.prototype.GetHexadecimal=function(t,e){var i;return i=Math.round(t*e).toString(16),1===i.length&&(i="0"+i),i},t.prototype.GetHexFromRGB=function(t,e,i,r){return this.Red=t,this.Green=e,this.Blue=i,this.Alpha=r,this.hex="#"+this.GetHexadecimal(t,r)+this.GetHexadecimal(e,r)+this.GetHexadecimal(i,r)},t.prototype.GetRGBFromHex=function(){},t.prototype.BlendHex=function(){return this.GetRGBFromHex(this.hex)},t.prototype.BlendRGB=function(){return this.GetHexFromRGB(this.Red,this.Green,this.Blue,this.Alpha)},t.prototype.GetRGBString=function(){return"rgba("+this.Red+","+this.Green+","+this.Blue+","+this.Alpha+");"},t}(),Color.Red=new Color(256,0,0,1),Color.Green=new Color(0,256,0,1),Color.Blue=new Color(0,0,256,1),Color.Flame=new Color("#ff8000"),Color.Ruby=new Color("#e60000"),Torch.Color=Color,Electron=function(){function t(){}return t.Import=function(){return Torch.ELECTRON=!0,Torch.fs=require("fs")},t}(),Torch.Electron=new Electron,exports=this,CanvasRenderer=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.previousPosition=new Torch.Point(this.sprite.position.x,this.sprite.position.y)}return t.prototype.Draw=function(){var t,e,i,r;if(e=new Torch.Rectangle(this.sprite.position.x,this.sprite.position.y,this.sprite.rectangle.width,this.sprite.rectangle.height),e.x=(this.sprite.position.x-this.previousPosition.x)*this.game.Loop.lagOffset+this.previousPosition.x,e.y=(this.sprite.position.y-this.previousPosition.y)*this.game.Loop.lagOffset+this.previousPosition.y,this.previousPosition=new Torch.Point(this.sprite.position.x,this.sprite.position.y),t=new Torch.Point(0,0),this.sprite.fixed||(e.x+=this.game.Camera.position.x+this.game.Hooks.positionTransform.x,e.y+=this.game.Camera.position.y+this.game.Hooks.positionTransform.y),this.sprite.DrawTexture)return i=this.sprite.DrawTexture,r=i.drawParams,this.PreRender(e),this.game.canvas.drawImage(this.sprite.DrawTexture.image,r.clipX,r.clipY,r.clipWidth,r.clipHeight,-e.width/2,-e.height/2,e.width,e.height),this.sprite.Body.DEBUG,1,this.PostRender()},t.prototype.PreRender=function(t){var e;return e=this.game.canvas,e.save(),e.translate(t.x+t.width/2,t.y+t.height/2),null!==this.sprite.Effects.tint.color&&(this.game.canvas.fillStyle=this.sprite.Effects.tint.color,this.game.canvas.globalAlpha=this.sprite.Effects.tint.opacity,this.game.canvas.globalCompositeOperation="destination-atop",this.game.canvas.fillRect(-t.width/2,-t.height/2,t.width,t.height)),e.globalAlpha=this.sprite.opacity,e.rotate(this.sprite.rotation)},t.prototype.PostRender=function(){var t;return t=this.game.canvas,t.restore()},t}(),exports.CanvasRenderer=CanvasRenderer,Rectangle=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.z=0}return t.prototype.GetOffset=function(t){var e,i,r,n,o,s,h;return s=this.x+this.width/2-(t.x+t.width/2),h=this.y+this.height/2-(t.y+t.height/2),i=this.width/2+t.width/2,e=this.height/2+t.height/2,n=this.x+this.width-(t.x+t.width),o=this.y+this.height-(t.y+t.height),r={x:i-Math.abs(s),y:e-Math.abs(h),vx:s,vy:h,halfWidths:i,halfHeights:e,sharedXPlane:n,sharedYPlane:o}},t.prototype.Intersects=function(t){var e,i;return e=this,i=t,e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y&&e.GetOffset(i)},t.prototype.ShiftFrom=function(t,e,i){var r,n;return r=null,n=null,r=void 0===e?t.x:t.x+e,n=void 0===i?t.y:t.y+i,this.x=r,this.y=n},t}(),Vector=function(){function t(t,e){this.x=t,this.y=e,this.ResolveVectorProperties()}return t.prototype.x=null,t.prototype.y=null,t.prototype.angle=null,t.prototype.magnitude=null,t.prototype.ResolveVectorProperties=function(){return this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y),this.angle=Math.atan2(this.x,this.y)},t.prototype.Clone=function(){return new Torch.Vector(this.x,this.y)},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this.ResolveVectorProperties()},t.prototype.AddScalar=function(t){return this.x+=t,this.y+=t,this.ResolveVectorProperties()},t.prototype.MultiplyScalar=function(t){return this.x*=t,this.y*=t,this.ResolveVectorProperties()},t.prototype.DivideScalar=function(t){return this.x/=t,this.y/=t,this.ResolveVectorProperties()},t.prototype.SubtractVector=function(t){return this.x-=t.x,this.y-=t.y,this.ResolveVectorProperties()},t.prototype.AddVector=function(t){return this.x+=t.x,this.y+=t.y,this.ResolveVectorProperties()},t.prototype.Normalize=function(){return this.DivideScalar(this.magnitude)},t.prototype.DotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.IsPerpendicular=function(t){return 0===this.DotProduct(t)},t.prototype.IsSameDirection=function(t){return this.DotProduct(t)>0},t}(),Point=function(){function t(t,e,i){this.x=t,this.y=e,this.z=null!=i?i:0}return t.prototype.Apply=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.Clone=function(){return new t(this.x,this.y)},t}(),Torch.Rectangle=Rectangle,Torch.Vector=Vector,Torch.Point=Point}).call(this);