(function(){var AABB,AjaxLoader,Animation,AnimationManager,ArrayUtility,Audio,AudioPlayer,BindManager,BodyManager,Camera,CanvasGame,CanvasRenderer,Circle,Collision,CollisionDetector,CollisionManager,Color,Debug,DebugConsole,EffectComponent,EffectManager,Electron,Event,EventDispatcher,EventManager,FunctionUtility,FutureEvent,Game,GridManager,HookManager,JerkFollow,Key,Keys,Layer,Layers,Load,Loop,MathUtility,Mouse,ObjectUtility,ParticleEmitter,ParticleManager,Point,Rectangle,Shapes,SizeManager,Sound,Sprite,SpriteGroup,SpriteSheetAnimation,State,StateMachine,StateMachineManager,StringUtility,Style,Task,Text,Timer,Torch,TorchModule,TorchModules,Trashable,Tween,TweenManager,TweenSetup,Util,Utilities,Vector,Viewport,_measureCanvas,exports,slice=[].slice,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;TorchModules=[],TorchModule=function(t,e){var i;return i=t.name,null!=e&&(i=e),TorchModules.push({name:i,mod:t})},Utilities=function(){function t(){this.Math=new MathUtility}return t.prototype.String=function(t){return new StringUtility(t)},t.prototype.Array=function(t){return new ArrayUtility(t)},t.prototype.Function=function(t){return new FunctionUtility(t)},t.prototype.Object=function(t){return new ObjectUtility(t)},t.prototype.Type=function(t){var e,i,n,r,o,s;if(null!=t){for(e={},s=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"],i=0,n=s.length;i<n;i++)r=s[i],e["[object "+r+"]"]=r.toLowerCase();return o=Object.prototype.toString.call(t),e[o]||"object"}return null},t.prototype.Enum=function(){var t,e,i,n,r,o;for(o=1<=arguments.length?slice.call(arguments,0):[],n={},t=e=0,i=o.length;e<i;t=++e)r=o[t],n[r]=t+1;return n},t}(),StringUtility=function(){function t(t){this.str=t}return t.prototype.String=function(){return this.str},t.prototype.Chunk=function(t){return this.str=this.str.match(new RegExp(".{1,"+t+"}","g")),this.str},t.prototype.Capitalize=function(){return this.str[0]=this.str[0].toUpperCase(),this.str},t}(),ArrayUtility=function(){function t(t){this.array=t}return t.prototype.Array=function(){return this.array},t.prototype.All=function(t){var e,i,n,r,o;for(r=this.array,o=[],i=0,n=r.length;i<n;i++)e=r[i],o.push(t(e));return o},t.prototype.Find=function(t){var e,i,n,r;for(r=this.array,i=0,n=r.length;i<n;i++)if(e=r[i],t(e))return e},t.prototype.Filter=function(t){var e,i,n,r,o;for(o=[],r=this.array,i=0,n=r.length;i<n;i++)e=r[i],t(e)&&o.push(e);return o},t.prototype.Reject=function(t){var e,i,n,r,o;for(o=[],r=this.array,i=0,n=r.length;i<n;i++)e=r[i],t(e)||o.push(e);return o},t.prototype.Where=function(t){var e;return e=this.Filter(function(e){var i,n;for(i in t)if(n=t[i],e[i]!==n)return!1;return!0})},t.prototype.Every=function(t){var e,i,n,r;for(r=this.array,i=0,n=r.length;i<n;i++)if(e=r[i],!t(e))return!1;return!0},t.prototype.Some=function(t){var e,i,n,r;for(r=this.array,i=0,n=r.length;i<n;i++)if(e=r[i],t(e))return!0;return!1},t.prototype.Contains=function(t,e){var i;return null==e&&(e=0),i=this.array.indexOf(t),i!==-1&&i>=e},t.prototype.Pluck=function(t){var e,i,n,r,o;for(r=[],o=this.array,i=0,n=o.length;i<n;i++)e=o[i],r.push(e[t]);return r},t.prototype.Max=function(t){var e,i,n,r,o,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,r=0,o=s.length;r<o;r++)n=s[r],e=t(n),e>i&&(i=n);return i},t.prototype.Min=function(t){var e,i,n,r,o,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,r=0,o=s.length;r<o;r++)n=s[r],e=t(n),e<i&&(i=e);return i},t.prototype.SortBy=function(t){},t.prototype.GroupBy=function(t){var e,i,n,r,o,s;for(null==t&&(t=function(t){return t.toString().length}),i={},s=this.array,r=0,o=s.length;r<o;r++)n=s[r],e=t(n),null==i[e]?i[e]=[n]:i[e].push(n);return i},t.prototype.CountBy=function(t){var e,i,n;e=this.GroupBy(t);for(i in e)n=e[i],e[i]=n.length;return e},t.prototype.Shuffle=function(){var t,e,i;for(t=this.array.length,i=t,e=t;0!==t;)e=Math.floor(Math.random()*t),t-=1,i=this.array[t],this.array[t]=this.array[e],this.array[e]=i;return this.array},t.prototype.Sample=function(t){var e,i;for(null==t&&(t=1),i=[],e=[];t>0;)e.push(t--);return e},t.prototype.Partition=function(t){return[this.Filter(t),this.Reject(t)]},t.prototype.First=function(t){var e;if(null==t&&(t=1),1===t)return this.array[0];for(e=[];t<=this.array.length;)e.push(this.array[t-1]),t++;return e},t.prototype.Last=function(t){var e;if(null==t&&(t=1),1===t)return this.array[this.array.length-1];for(e=[];t<=this.array.length;)e.push(this.array[this.array.length-(t-1)]),t++;return e},t.prototype.Flatten=function(){},t.prototype.Without=function(){var t,e,i,n,r,o;for(o=1<=arguments.length?slice.call(arguments,0):[],t=[],r=this.array,i=0,n=r.length;i<n;i++)e=r[i],o.indexOf(e)===-1&&t.push(e);return t},t.prototype.Union=function(){var t,e,i,n,r,o,s,a,h;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),n=[],o=0,s=i.length;o<s;o++)for(t=i[o],h=0,a=t.length;h<a;h++)r=t[h],n.indexOf(r)===-1&&n.push(r);return n},t.prototype.Intersection=function(){var t,e,i,n,r,o,s,a,h,u,p,c;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),n=[],r={},s=0,h=i.length;s<h;s++)for(t=i[s],p=0,u=t.length;p<u;p++)o=t[p],null==r[o]?r[o]=1:r[o]+=1;for(a in r)c=r[a],c>=e.length&&n.push(a);return n},t.prototype.Uniq=function(){},t.prototype.Zip=function(){var t,e,i,n,r,o,s,a,h,u,p;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[],p=this.array,n=o=0,s=p.length;o<s;n=++o){for(r=p[n],u=[r],h=0,a=e.length;h<a;h++)t=e[h],u.push(t[n]);i.push(u)}return i},t.prototype.UnZip=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[]},t}(),FunctionUtility=function(){function t(t){this.func=t}return t.prototype.Defer=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],e=function(e){return function(){return e.func.apply(e,t)}}(this),setTimeout(e,0)},t.prototype.Once=function(){var t,e;return e=this.func,t=function(){var t;if(t=1<=arguments.length?slice.call(arguments,0):[],!this.called)return e.apply(null,t),this.called=!0}},t.prototype.After=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesBeforeExecuted+=1,!(this.calledCount<t))return i.apply(null,e),this.called=!0},e.timesBeforeExecuted=0,e},t.prototype.Before=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesExecuted+=1,!(this.calledCount>t))return i.apply(null,e),this.called=!0},e.timesExecuted=0,e},t.prototype.Compose=function(){var t,e,i,n;return e=1<=arguments.length?slice.call(arguments,0):[],t=[this.func].concat(slice.call(e)),i=0,n=function(){var e,n;for(e=void 0,n=[];i<t.length;)e=t[i](e),n.push(i++);return n}},t}(),ObjectUtility=function(){function t(t){this.obj=t}return t.prototype.Keys=function(){var t,e,i,n;e=[],i=this.obj;for(t in i)n=i[t],e.push(t);return e},t.prototype.Values=function(){var t,e,i,n;n=[],e=this.obj;for(t in e)i=e[t],n.push(i);return n},t.prototype.All=function(t){var e,i,n;i=this.obj;for(e in i)n=i[e],this.obj[e]=t(e,n);return this.obj},t.prototype.Invert=function(){var t,e,i,n;e={},i=this.obj;for(t in i)n=i[t],e[n]=t;return e},t.prototype.Functions=function(){var t,e,i,n;t=[],i=this.obj;for(e in i)n=i[e],"function"==typeof n&&t.push(n.name);return t},t.prototype.Extend=function(){var t,e,i,n,r,o;for(r=1<=arguments.length?slice.call(arguments,0):[],t=0,i=r.length;t<i;t++){n=r[t];for(e in n)o=n[e],this.obj[e]=o}return this.obj},t.prototype.Pick=function(){var t,e,i,n,r,o,s;if(r=1<=arguments.length?slice.call(arguments,0):[],n={},"function"==typeof r){o=this.obj;for(e in o)s=o[e],r(e,s,this.obj)&&(n[e]=s)}else for(t=0,i=r.length;t<i;t++)e=r[t],n[e]=this.obj[e];return n},t.prototype.Omit=function(){var t,e,i,n,r,o;if(i=1<=arguments.length?slice.call(arguments,0):[],e={},"function"==typeof i){n=this.obj;for(t in n)o=n[t],i(t,o,this.obj)||(e[t]=o)}else{r=this.obj;for(t in r)o=r[t],i.indexOf(t)===-1&&(e[t]=this.obj[t])}return e},t.prototype.Clone=function(){},t.prototype.Has=function(t){return null!=this.obj[t]},t.prototype.Matches=function(t){var e,i;for(e in t)if(i=t[e],this.obj[e]!==i)return!1;return!0},t.prototype.Empty=function(){return 0===this.Keys().length},t}(),MathUtility=function(){function t(){}return t.prototype.RandomInRange=function(t,e){return Math.random()*(e-t+1)+t},t}(),Util=new Utilities,"undefined"!=typeof window&&null!==window&&(window.onerror=function(){var t,e;if(t=1<=arguments.length?slice.call(arguments,0):[],window.Torch.STRICT_ERRORS)return document.body.style.backgroundColor="black",e=t[4],void 0!==e?Torch.FatalError(e):Torch.FatalError("An error has occured")}),Function.prototype.MixIn=Function.prototype.is=function(t){var e,i,n,r;n=this.prototype,e=Object.create(t.prototype);for(i in e)r=e[i],n[i]=r;return this},Function.prototype.property=function(t,e){return Object.defineProperty(this.prototype,t,e)},EventDispatcher=function(){function t(){}return t.dispatchers=[],t.prototype.InitEventDispatch=function(){return this.events={},t.dispatchers.push(this)},t.prototype.On=function(t,e){var i;return this.events[t]||(i=[],i.triggers=0,this.events[t]=i),this.events[t].push(e),this},t.prototype.Emit=function(t,e){var i,n,r,o;if(void 0!==this.events[t])for(o=this.events[t],n=0,r=o.length;n<r;n++)i=o[n],this.events[t].triggers++,i(e);return this},t.prototype.Off=function(t){var e,i,n;if(null==t&&(t=""),""!==t)this.events[t]=void 0;else{i=this.events;for(e in i)n=i[e],this.events[e]=void 0}return this},t}(),Trashable=function(){function t(){}return t.prototype.trash=!1,t.prototype.Trash=function(){return this.trash=!0,this},t}(),TorchModule(DebugConsole=function(){function DebugConsole(t){var e,i;this.game=t,i='<div id = "torch-console" style = "position: absolute;z-index: 100;top:0;border: 1px solid orange;background-color:black">\n    <p style = "color:white;margin-left:1%;font-family:monospace">Torch Dev Console. Type /HELP for usage</p>\n    <input type="text" id = "torch-console-input" placeholder="Torch Dev Console, type /HELP for usage"/ style = "outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 16px;padding: 3%;width: 100%;" />\n    <div id = "torch-console-output" style = "overflow:auto;outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 14px;padding: 1%;width: 98%;height:250px"></div>\n</div>',e=document.createElement("div"),e.innerHTML=i,e.style.display="none",document.body.appendChild(e),this.console=e,this.consoleInput=document.getElementById("torch-console-input"),this.consoleOutput=document.getElementById("torch-console-output"),this.commands={},this.variables={},this.LoadDefaultCommands(),document.addEventListener("keypress",function(t){return function(e){return 47===e.keyCode?t.Toggle(!0):13===e.keyCode?t.ParseCommand():void 0}}(this)),document.addEventListener("keydown",function(t){return function(e){if(27===e.keyCode)return t.Toggle(!1)}}(this))}return DebugConsole.prototype.enabled=!1,DebugConsole.prototype.console=null,DebugConsole.prototype.consoleInput=null,DebugConsole.prototype.consoleOutput=null,DebugConsole.prototype.commands=null,DebugConsole.prototype.variables=null,DebugConsole.prototype.Toggle=function(t){return null==t&&(t=!0),t?(this.console.style.display="block",this.consoleInput.focus(),this.enabled=!0):(this.console.style.display="none",this.consoleInput.value="",this.enabled=!1)},DebugConsole.prototype.Output=function(t,e){return null==e&&(e="white"),t=t.replace(/\n/g,"<br>"),this.consoleOutput.innerHTML+="<p style='color:orange'>TorchDev$</p><p style='color:"+e+"'>"+t+"</p>"},DebugConsole.prototype.ParseCommand=function(){var t,e,i,n,r,o,s,a;if(this.enabled){for(i=this.consoleInput.value,i=i.replace(/\$(.*?)\$/g,function(t){return function(e){var i;return i=e.substring(1,e.length-1),t.variables[i]}}(this)),e=i.split(" ")[0].split("/")[1],t=[],a=i.split(" "),n=r=0,o=a.length;r<o;n=++r)s=a[n],0!==n&&t.push(s);return this.ExecuteCommand(e,t)}},DebugConsole.prototype.ExecuteCommand=function(t,e){var i;return this.commands[t]?(i=this.commands)[t].apply(i,[this].concat(slice.call(e))):void this.Output("Command '"+t+"' does not exist.","red")},DebugConsole.prototype.AddCommand=function(t,e){return this.commands[t]=e},DebugConsole.prototype.LoadDefaultCommands=function(){return this.AddCommand("HELP",function(t){return function(t){return t.Output("type '/HELP' for help\ntype '/FPS' for frame rate\ntype '/TIME' for game time\ntype '/E [statement]' to execute a JavaScript statement\ntype '/RUN [path] to load and execute a JavaScript file'")}}(this)),this.AddCommand("CLEAR",function(t){return function(e){return t.consoleOutput.innerHTML=""}}(this)),this.AddCommand("FPS",function(t){return function(e){return e.Output("Current FPS: "+t.game.fps+"\nAverage FPS: 0")}}(this)),this.AddCommand("TIME",function(t){return function(e){return e.Output("Total Game Time: "+t.game.time+"\nDelta Time: "+t.game.deltaTime)}}(this)),this.AddCommand("RUN",function(_this){return function(tConsole,filePath){var loader;return loader=new Torch.AjaxLoader(filePath,Torch.AjaxData.Text),loader.Finish(function(data){var error;try{return eval(data),tConsole.Output("File Executed","green")}catch(t){return error=t,tConsole.Output("File: '"+statement+"' caused an error. "+error,"red")}}),loader.Load()}}(this)),this.AddCommand("SET",function(t){return function(e,i,n){return isNaN(n)?t.variables[i]=n:t.variables[i]=parseFloat(n),t.Output("Set "+i+" to "+n,"green")}}(this)),this.AddCommand("E",function(_this){return function(tConsole,statement){var error;try{return eval(statement),tConsole.Output("Statment Executed","green")}catch(t){return error=t,tConsole.Output("Statement: '"+statement+"' caused an error. "+error,"red")}}}(this))},DebugConsole}()),BodyManager=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.velocity=new Vector(0,0),this.acceleration=new Vector(0,0),this.omega=0,this.alpha=0,this.distance=0}return t.prototype.Update=function(){var t,e;return t=this.velocity.x*this.game.Loop.updateDelta,e=this.velocity.y*this.game.Loop.updateDelta,this.distance+=Math.sqrt(t*t+e*e),this.sprite.position.x+=t,this.sprite.position.y+=e,this.velocity.x+=this.acceleration.x*this.game.Loop.updateDelta,this.velocity.y+=this.acceleration.y*this.game.Loop.updateDelta,this.sprite.rotation+=this.omega*this.game.Loop.updateDelta,this.sprite.omega+=this.alpha*this.game.Loop.updateDelta},t.prototype.Debug=function(t){return null==t&&(t="red"),this.DEBUG=t},t.prototype.AngleTo=function(t){var e;return e=this.DirectionTo(t),e.angle},t.prototype.DistanceTo=function(t){var e,i;return i=new Vector(this.sprite.position.x,this.sprite.position.y),e=new Vector(t.position.x,t.position.y),e.SubtractVector(i),e.magnitude},t.prototype.DirectionTo=function(t){var e;return e=new Vector(t.position.x-this.sprite.position.x,t.position.y-this.sprite.position.y),e.Normalize(),e},t}(),SizeManager=function(){function t(t){var e;this.sprite=t,e=this.sprite.rectangle,this.width=e.width,this.height=e.height,this.scale={width:1,height:1}}return t.prototype.width=0,t.prototype.height=0,t.prototype.scale=null,t.prototype.Update=function(){var t;return t=this.sprite.rectangle,t.width=this.width*this.scale.width,t.height=this.height*this.scale.height},t.prototype.Set=function(t,e){return this.width=t,this.height=e},t.prototype.Scale=function(t,e){return this.scale.width=t,this.scale.height=e},t}(),EventManager=function(){function t(t){this.sprite=t,this.game=this.sprite.game}return t.prototype.mouseOver=!1,t.prototype.clickTrigger=!1,t.prototype.clickAwayTrigger=!1,t.prototype.draw=!0,t.prototype.wasClicked=!1,t.prototype.Update=function(){var t,e;return!this.game.Mouse.GetRectangle().Intersects(this.sprite.rectangle)&&this.mouseOver&&(this.mouseOver=!1,this.sprite.Emit("MouseLeave",new Torch.Event(this.game,{sprite:this.sprite}))),this.game.Mouse.GetRectangle(this.game).Intersects(this.sprite.rectangle)?(this.mouseOver||this.sprite.Emit("MouseOver",new Torch.Event(this.game,{sprite:this.sprite})),this.mouseOver=!0):this.sprite.fixed?(t=this.game.Mouse.GetRectangle(),e=new Rectangle(t.x,t.y,t.width,t.height),e.x+=this.game.Camera.position.x,e.y+=this.game.Camera.position.y,e.Intersects(this.sprite.rectangle)?this.mouseOver=!0:this.mouseOver=!1):this.mouseOver=!1,this.mouseOver&&this.game.Mouse.down&&!this.clickTrigger&&(this.clickTrigger=!0),this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver&&(this.wasClicked=!0,this.sprite.Emit("Click",new Torch.Event(this.game,{sprite:this.sprite})),this.clickTrigger=!1),!this.clickTrigger||this.game.Mouse.down||this.mouseOver||(this.clickTrigger=!1),this.game.Mouse.down||this.mouseOver||!this.clickAwayTrigger?this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver?this.clickAwayTrigger=!1:this.game.Mouse.down&&!this.mouseOver?this.clickAwayTrigger=!0:void 0:(this.sprite.Emit("ClickAway",new Torch.Event(this.game,{sprite:this.sprite})),this.wasClicked=!1,this.clickAwayTrigger=!1)},t}(),EffectManager=function(){function t(t){this.sprite=t,this.tint=new EffectComponent.Tint,this.mask=new EffectComponent.Mask}return t.prototype.tint=null,t.prototype.mask=null,t}(),EffectComponent={},EffectComponent.Tint=function(){function t(){}return t.prototype._color=null,t.prototype._opacity=.5,t.property("color",{get:function(){return this._color},set:function(t){return this._color=t}}),t.property("opacity",{get:function(){return this._opacity},set:function(t){return this._opacity=t}}),t}(),EffectComponent.Mask=function(){function t(){}return t.prototype._texture=null,t.prototype._in=!1,t.prototype._out=!1,t.property("texture",{get:function(){return this._texture},set:function(t){return this._texture=t}}),t.property("in",{get:function(){return this._in},set:function(t){return this._in=t}}),t.property("out",{get:function(){return this._out},set:function(t){return this._out=t}}),t}(),StateMachineManager=function(){function t(t){this.sprite=t,this.stateMachines={}}return t.prototype.CreateStateMachine=function(t){return this.stateMachines[t]=new StateMachine(this.sprite),this.stateMachines[t]},t.prototype.GetStateMachine=function(t){return this.stateMachines[t]},t.prototype.Update=function(){var t,e,i,n;e=this.stateMachines,i=[];for(t in e)n=e[t],i.push(n.Update());return i},t}(),GridManager=function(){function t(t){this.sprite=t,this.position=new Point(0,0),this.children=[]}return t.prototype.parent=null,t.prototype.children=null,t.prototype.centered=!1,t.prototype.centerVertical=!1,t.prototype.alignLeft=!1,t.prototype.alignRight=!1,t.prototype.alignTop=!1,t.prototype.alignBottom=!1,t.prototype.Align=function(){var t,e,i,n,r;for(i=1<=arguments.length?slice.call(arguments,0):[],n=[],t=0,e=i.length;t<e;t++)switch(r=i[t]){case"left":n.push(this.alignLeft=!0);break;case"right":n.push(this.alignRight=!0);break;case"top":n.push(this.alignTop=!0);break;case"bottom":n.push(this.alignBottom=!0);break;default:n.push(void 0)}return n},t.prototype.Center=function(t){return null==t&&(t=!0),this.centered=t},t.prototype.CenterVertical=function(t){return null==t&&(t=!0),this.centerVertical=t},t.prototype.Append=function(t){return t.Grid.parent=this.sprite,t.drawIndex=this.sprite.drawIndex+1,t.fixed=this.sprite.fixed},t.prototype.Parent=function(){return this.parent},t.prototype.Children=function(t){var e,i,n,r,o,s,a,h;if(!t)return this.children;for(i=[],a=this.children,n=0,o=a.length;n<o;n++){e=a[n],s=!0;for(r in t)h=t[r],!e[r]===h&&(s=!1);s&&i.append(e)}return i},t.prototype.Ancestors=function(t){var e,i,n,r,o,s;if(!this.parent)return null;for(i=[],e=this.parent,o=[];null!==e.Parent();){if(t){r=!0;for(n in t)s=t[n],e[n]!==s&&(r=!1);r&&i.push(e)}else i.push(e);o.push(e=e.Parent())}return o},t.prototype.ApplyCentering=function(t){return this.centered&&(t.x=t.x+this.parent.rectangle.width/2-this.sprite.rectangle.width/2),this.centerVertical&&(t.y=t.y+this.parent.rectangle.height/2-this.sprite.rectangle.height/2),t},t.prototype.ApplyAlignment=function(t){return this.alignLeft&&(t.x=0),this.alignRight&&(t.x=t.x+(this.parent.rectangle.width-this.sprite.rectangle.width)),this.alignTop&&(t.y=0),this.alignBottom&&(t.y=t.y+(this.parent.rectangle.height-this.sprite.rectangle.height)),t},t.prototype.ResolveAbosolutePosition=function(){var t;return null===this.parent?this.sprite.position:(t=this.parent.position.Clone(),t=this.ApplyCentering(t),t=this.ApplyAlignment(t),t.Apply(this.position),t)},t.prototype.Update=function(){if(this.sprite.position=this.ResolveAbosolutePosition(),null!==this.parent)return this.sprite.drawIndex=this.parent.drawIndex+1,this.sprite.fixed=this.parent.fixed},t}(),Animation=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.loop=!1,e.prototype.stopped=!1,e.prototype.intervalTime=0,e.prototype.stepTime=0,e}(Trashable),AnimationManager=function(){function t(t){this.sprite=t,this.animations=[]}return t.prototype.animations=null,t.prototype.Update=function(){var t,e,i,n,r;for(e=[],r=this.animations,i=0,n=r.length;i<n;i++)t=r[i],t.Update(),t.trash||e.push(t);return this.animations=e},t.prototype.SpriteSheet=function(t,e,i,n){var r;return null==n&&(n={step:200}),r=new SpriteSheetAnimation(this.sprite,t,e,i,n.step),this.animations.push(r),r},t}(),SpriteSheetAnimation=function(t){function e(t,e,i,n,r){this.sprite=t,this.clipWidth=e,this.clipHeight=i,this.numberOfFrames=n,this.stepTime=r,this.loop=!0,this.game=this.sprite.game,this.Reset()}return extend(e,t),e.prototype.index=-1,e.prototype.clipX=0,e.prototype.clipY=0,e.prototype.game=null,e.prototype.clipWidth=null,e.prototype.clipHeight=null,e.prototype.numberOfFrames=null,e.prototype.stepTime=null,e.prototype.Update=function(){if(!this.stopped)return this.intervalTime+=this.game.Loop.updateDelta,this.intervalTime>=this.stepTime?this.AdvanceFrame():void 0},e.prototype.AdvanceFrame=function(){if(this.intervalTime=0,this.index+=1,this.sprite.DrawTexture.drawParams.clipX=this.index*this.clipWidth,this.index>=this.numberOfFrames-1)return this.loop?this.index=-1:this.Trash()},e.prototype.Stop=function(){return this.stopped=!0},e.prototype.Start=function(){return this.stopped=!1},e.prototype.Index=function(t){return this.index=t-1,this.sprite.DrawTexture.drawParams.clipX=(this.index+1)*this.clipWidth},e.prototype.Reset=function(){return this.intervalTime=0,this.index=-1,this.sprite.DrawTexture.drawParams.clipX=0,this.sprite.DrawTexture.drawParams.clipY=0,this.sprite.DrawTexture.drawParams.clipWidth=this.clipWidth,this.sprite.DrawTexture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e.prototype.SyncFrame=function(){return this.sprite.DrawTexture.drawParams.clipX=0,this.sprite.DrawTexture.drawParams.clipY=0,this.sprite.DrawTexture.drawParams.clipWidth=this.clipWidth,this.sprite.DrawTexture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e}(Animation),BindManager=function(){function t(t){this.sprite=t}return t.prototype.Texture=function(t,e){var i,n;return n=null,"string"==typeof t?(n=this.sprite.game.Assets.Textures[t],n||this.sprite.game.FatalError("Sprite.Bind.Texture given textureId '"+t+"' was not found")):n=t,i=1,"string"==typeof t?this.sprite.DrawTexture=n:this.sprite.DrawTexture={image:t},this.sprite.Size.Set(n.width,n.height),this.sprite.DrawTexture.drawParams={clipX:0,clipY:0,clipWidth:this.sprite.DrawTexture.image.width,clipHeight:this.sprite.DrawTexture.image.height},this.sprite.DrawTexture},t}(),CanvasRenderer=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.previousPosition=new Point(this.sprite.position.x,this.sprite.position.y)}return t.prototype.Draw=function(){var t,e;switch(e=new Rectangle(this.sprite.position.x,this.sprite.position.y,this.sprite.rectangle.width,this.sprite.rectangle.height),e.x=(this.sprite.position.x-this.previousPosition.x)*this.game.Loop.lagOffset+this.previousPosition.x,e.y=(this.sprite.position.y-this.previousPosition.y)*this.game.Loop.lagOffset+this.previousPosition.y,this.previousPosition=new Point(this.sprite.position.x,this.sprite.position.y),t=new Point(0,0),this.sprite.fixed||(e.x+=this.game.Camera.position.x+this.game.Hooks.positionTransform.x,e.y+=this.game.Camera.position.y+this.game.Hooks.positionTransform.y),this.sprite.torch_render_type){case"Image":return this.RenderImageSprite(e);case"Line":return this.RenderLineSprite(e)}},t.prototype.PreRender=function(t){var e;return e=this.game.canvas,e.save(),e.translate(t.x+t.width/2,t.y+t.height/2),null!==this.sprite.Effects.tint.color&&(this.game.canvas.fillStyle=this.sprite.Effects.tint.color,this.game.canvas.globalAlpha=this.sprite.Effects.tint.opacity,this.game.canvas.globalCompositeOperation="destination-atop",this.game.canvas.fillRect(-t.width/2,-t.height/2,t.width,t.height)),e.globalAlpha=this.sprite.opacity,e.rotate(this.sprite.rotation)},t.prototype.PostRender=function(){var t;return t=this.game.canvas,t.restore()},t.prototype.RenderImageSprite=function(t){var e,i;if(null!=this.sprite.DrawTexture)return e=this.sprite.DrawTexture,i=e.drawParams,this.PreRender(t),this.game.canvas.drawImage(this.sprite.DrawTexture.image,i.clipX,i.clipY,i.clipWidth,i.clipHeight,-t.width/2,-t.height/2,t.width,t.height),this.sprite.Body.DEBUG&&(this.game.canvas.fillStyle=this.sprite.Body.DEBUG,this.game.canvas.globalAlpha=.5,this.game.canvas.fillRect(-t.width/2,-t.height/2,t.width,t.height)),this.PostRender()},t.prototype.RenderLineSprite=function(t){var e;return this.game.canvas.save(),this.game.canvas.globalAlpha=this.sprite.opacity,this.game.canvas.strokeStyle=this.sprite.color,this.game.canvas.lineWidth=this.sprite.lineWidth,null!=(null!=(e=this.sprite.DrawTexture)?e.image:void 0)&&(this.game.canvas.strokeStyle=this.game.canvas.createPattern(this.sprite.DrawTexture.image,"repeat")),this.game.canvas.beginPath(),this.game.canvas.moveTo(t.x,t.y),this.game.canvas.lineTo(this.sprite.endPosition.x+this.game.Camera.position.x,this.sprite.endPosition.y+this.game.Camera.position.y),this.game.canvas.stroke(),this.game.canvas.restore()},t}(),TorchModule(Sprite=function(){function t(t,e,i){this.InitSprite(t,e,i)}return t.prototype.torch_render_type="Image",t.MixIn(EventDispatcher).MixIn(Trashable),t.prototype.InitSprite=function(t,e,i){return null==e&&(e=0),null==i&&(i=0),null!==t&&void 0!==t||Torch.FatalError("Unable to initialize sprite without game"),this.InitEventDispatch(),this.game=t,this.rectangle=new Rectangle(e,i,0,0),this.position=new Point(e,i),this.Bind=new BindManager(this),this.Collisions=new CollisionManager(this),this.Body=new BodyManager(this),this.Size=new SizeManager(this),this.Events=new EventManager(this),this.Effects=new EffectManager(this),this.States=new StateMachineManager(this),this.Grid=new GridManager(this),this.Animations=new AnimationManager(this),this.DrawTexture=null,this.TexturePack=null,this.TextureSheet=null,this.TextureSimple=null,this.fixed=!1,this.draw=!0,this.paused=!1,this.drawIndex=0,this.rotation=0,this.opacity=1,this._torch_add="Sprite",this._torch_uid="",this.events={},this.renderer=new CanvasRenderer(this),t.Add(this)},t.prototype.UpdateSprite=function(){return this.Body.Update(),this.Size.Update(),this.Events.Update(),this.States.Update(),this.Grid.Update(),this.Animations.Update(),this.rectangle.x=this.position.x,this.rectangle.y=this.position.y,this.Collisions.Update()},t.prototype.Update=function(){return this.UpdateSprite()},t.prototype.Draw=function(){return this.renderer.Draw()},t.prototype.NotSelf=function(t){return t._torch_uid!==this._torch_uid},t.prototype.Center=function(){var t,e;return t=this.game.canvasNode.width,e=t/2-this.rectangle.width/2,this.position.x=e,this},t.prototype.CenterVertical=function(){var t,e;return t=this.game.canvasNode.height,e=t/2-this.rectangle.height/2,this.position.y=e,this},t.prototype.CollidesWith=function(t){return new CollisionDetector(this,t)},t.prototype.Pause=function(t){return null==t&&(t=!0),this.paused=t},t}()),"undefined"!=typeof document&&null!==document?(_measureCanvas=document.createElement("CANVAS"),_measureCanvas.width=500,_measureCanvas.height=500):_measureCanvas={getContext:function(){}},TorchModule(Text=function(t){function e(t,e,i,n){this.InitText(t,e,i,n)}return extend(e,t),e.prototype.TEXT=!0,e.measureCanvas=_measureCanvas.getContext("2d"),e.property("fontSize",{get:function(){return this._fontSize},set:function(t){return this._fontSize=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("font",{get:function(){return this._font},set:function(t){return this._font=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("fontWeight",{get:function(){return this._fontWeight},set:function(t){return this._fontWeight=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("color",{get:function(){return this._color},set:function(t){return this._color=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("text",{get:function(){return this._text},set:function(t){return this._text=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.prototype.InitText=function(t,e,i,n){return this.InitSprite(t,e,i),this.data=n,this._font="Arial",this._fontSize=16,this._fontWeight="",this._color="#2b4531",this._text="",this.width=100,this.height=100,this.Size.scale={width:1,height:1},this.Init()},e.prototype.Init=function(){return this.data.font&&(this._font=this.data.font),this.data.fontSize&&(this._fontSize=this.data.fontSize),this.data.fontWeight&&(this._fontWeight=this.data.fontWeight),this.data.color&&(this._color=this.data.color),this.data.text&&(this._text=this.data.text),this.data.rectangle&&(this.rectangle=this.data.rectangle),this.data.buffHeight&&(this.buffHeight=this.data.buffHeight),this.Render()},e.prototype.Render=function(){var t,i,n;return i=document.createElement("CANVAS"),e.measureCanvas.font=this._fontSize+"px "+this._font,i.width=e.measureCanvas.measureText(this._text).width,i.height=this._fontSize,this.buffHeight&&(i.height+=this.buffHeight),t=i.getContext("2d"),t.fillStyle=this._color,t.font=this._fontWeight+" "+this._fontSize+"px "+this._font,t.fillText(this._text,0,i.height),n=new Image,n.src=i.toDataURL(),n.onload=function(t){return function(){return t.Bind.Texture(n)}}(this),this.rectangle.width=i.width,this.rectangle.height=this._fontSize},e.prototype.Update=function(){return e.__super__.Update.call(this)},e}(Sprite)),Shapes={name:"Shapes"},TorchModule(Shapes),Shapes.Circle=function(t){function e(t,e,i,n,r,o){null==r&&(r="black"),null==o&&(o="black"),this.InitSprite(t,e,i),this._radius=n,this._fillColor=r,this._strokeColor=o,this.Render()}return extend(e,t),e.prototype._EXPERIMENTAL_OPTIMAZATION=!0,e.prototype._radius=0,e.prototype._fillColor="black",e.prototype._strokeColor="black",e.prototype._startAngle=0,e.prototype._endAngle=2*Math.PI,e.prototype._drawDirection="clockwise",e.prototype.Render=function(){var t,e,i;if(this._EXPERIMENTAL_OPTIMAZATION)return e=document.createElement("CANVAS"),t=e.getContext("2d"),t.strokeStyle=this._strokeColor,t.fillStyle=this._fillColor,t.beginPath(),t.arc(this._radius,this._radius,this._radius,this._startAngle,this._endAngle,"counterclockwise"===this._drawDirection),t.fill(),t.stroke(),i=new Image,i.src=e.toDataURL(),i.onload=function(t){return function(){return t.Bind.Texture(i)}}(this)},e.prototype.Draw=function(){if(this._EXPERIMENTAL_OPTIMAZATION)return e.__super__.Draw.call(this)},e.property("radius",{get:function(){return this._radius},set:function(t){return this._radius=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("fillColor",{
get:function(){return this._fillColor},set:function(t){return this._fillColor=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("strokeColor",{get:function(){return this._strokeColor},set:function(t){return this._strokeColor=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("startAngle",{get:function(){return this._startAngle},set:function(t){return this._startAngle=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("endAngle",{get:function(){return this._endAngle},set:function(t){return this._endAngle=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("drawDirection",{get:function(){return this._drawDirection},set:function(t){return this._drawDirection=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e}(Sprite),Shapes.Line=function(t){function e(t,e,i,n,r,o,s){this.color=o,this.InitSprite(t,e,i),this.endPosition=new Point(n,r),Util.Object(this).Extend(s)}return extend(e,t),e.prototype.torch_render_type="Line",e.prototype.color="black",e.prototype.lineWidth=1,e.prototype.endPosition=null,e}(Sprite),Shapes.Box=function(t){function e(t,e,i,n,r,o,s){null==o&&(o="black"),null==s&&(s="black")}return extend(e,t),e}(Sprite),TorchModule(SpriteGroup=function(){function t(t,e){var i,n,r,o;for(this.sprites=null!=t?t:[],this.game=e,r=this.sprites,i=0,n=r.length;i<n;i++)o=r[i],o.anchorX=o.Rectangle.x;return this}return t.prototype.Factory=function(t){return this.spriteFactory=t,this},t.prototype.Add=function(){var t,e,i,n,r;return i=arguments[0],n=arguments[1],r=arguments[2],t=4<=arguments.length?slice.call(arguments,3):[],null===i||void 0===i&&void 0!==this.spriteFactory?(e=function(t,e,i){i.prototype=t.prototype;var n=new i,r=t.apply(n,e);return Object(r)===r?r:n}(this.spriteFactory,[this.game,n,r].concat(slice.call(t)),function(){}),this.sprites.push(e),e):(this.sprites=this.sprites.concat(i),this)},t.prototype.Trash=function(){var t,e,i,n;for(i=this.sprites,t=0,e=i.length;t<e;t++)n=i[t],n.Trash();return this},t.prototype.Shift=function(t){var e,i,n,r,o;for(n=this.sprites,r=[],e=0,i=n.length;e<i;e++)o=n[e],t.x?r.push(o.Rectangle.x=o.anchorX+t.x):r.push(void 0);return r},t.prototype.Hide=function(){var t,e,i,n;for(i=this.sprites,t=0,e=i.length;t<e;t++)n=i[t],n.draw=!1;return this},t.prototype.Show=function(){var t,e,i,n;for(i=this.sprites,t=0,e=i.length;t<e;t++)n=i[t],n.draw=!0;return this},t.prototype.Center=function(){var t,e,i,n;for(i=this.sprites,t=0,e=i.length;t<e;t++)n=i[t],n.Center();return this},t.prototype.ToggleFixed=function(){var t,e,i,n;for(i=this.sprites,t=0,e=i.length;t<e;t++)n=i[t],n.ToggleFixed();return this},t}()),CollisionDetector=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.AABB=function(){return new AABB(this.sprite,this.otherSprite).Execute()},t.prototype.Circle=function(){return new Circle(this.sprite,this.otherSprite).Execute()},t.prototype.SAT=function(){return new SAT(this.sprite,this.otherSprite).Execute()},t}(),AABB=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){return this.sprite.rectangle.Intersects(this.otherSprite.rectangle)},t}(),Circle=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){var t,e,i,n,r;return t={radius:this.sprite.Width(),x:this.sprite.Position("x"),y:this.sprite.Position("y")},e={radius:this.otherSprite.Width(),x:this.otherSprite.Position("x"),y:this.otherSprite.Position("y")},n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r),i<t.radius+e.radius},t}(),Collision={AABB:1,Circle:2,SAT:3},CollisionManager=function(){function t(t){this.sprite=t,this.filter={},this.game=this.sprite.game}return t.prototype.mode=Collision.AABB,t.prototype.sprite=null,t.prototype.filter=null,t.prototype.limit=null,t.prototype.enabled=!1,t.prototype.Monitor=function(){return this.enabled=!0},t.prototype.NotFiltered=function(t){var e,i,n,r;i=this.game.filter;for(e in i)if(r=i[e],"__type__"===e){if(r.constructor.name===t.constructor.name)return!1}else if(r===t[e])return!1;n=this.filter;for(e in n)if(r=n[e],"__type__"===e){if(r.constructor.name===t.constructor.name)return!1}else if(r===t[e])return!1;return!0},t.prototype.InLimit=function(t){var e,i,n;i=this.limit;for(e in i)if(n=i[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!0}else if(n===t[e])return!0;return!1},t.prototype.Valid=function(t){return null!==this.limit?this.InLimit(t):this.NotFiltered(t)},t.prototype.Filter=function(t){return this.filter=t},t.prototype.Limit=function(t){return this.limit=t},t.prototype.Mode=function(t){var e;return e=t},t.prototype.Update=function(){var t,e,i,n,r,o,s;if(this.sprite.game&&this.enabled){for(this.game=this.sprite.game,t=!1,s=this.game.spriteList,n=0,r=s.length;n<r;n++)if(o=s[n],this.sprite.NotSelf(o)&&this.Valid(o)){switch(i=!1,e={},this.mode){case Collision.AABB:e=this.sprite.CollidesWith(o).AABB(),i=e!==!1}i&&(e.self=this.sprite,e.collider=o,this.sprite.Emit("Collision",new Torch.Event(this.game,{collisionData:e})))}return this.sprite.Emit("NoCollision",new Torch.Event(this.game,{}))}},t.prototype.SimpleCollisionHandle=function(t,e){var i,n;return null==e&&(e=1),i=t.collisionData,n={left:!1,right:!1,top:!1,bottom:!1},i.vx<i.halfWidths&&i.vy<i.halfHeights&&(i.x<i.y?i.vx>0?(t.collisionData.self.position.x+=i.x*e,n.left=!0):i.vx<0&&(t.collisionData.self.position.x-=i.x*e,n.right=!0):i.x>i.y&&(i.vy>0?(t.collisionData.self.position.y+=i.y*e,n.top=!0):i.vy<0&&(t.collisionData.self.position.y-=i.y*e,n.bottom=!0))),n},t.prototype.CastRay=function(){},t}(),Loop=function(){function t(t){this.game=t,this.fps=50,this.frameTime=1e3/this.fps,this.lag=0,this.updateDelta=0,this.drawDelta=0,this.lagOffset}return t.prototype.Update=function(){return this.game.update(this),this.game.Camera.Update(),this.game.Timer.Update(),this.game.Debug.Update(),this.game.Tweens.Update(),this.game.UpdateAnimations(),this.game.UpdateTimeInfo(),this.game.UpdateTasks(),this.game.UpdateGamePads(),this.game.UpdateSprites()},t.prototype.Draw=function(){return this.game.draw(this),this.game.DrawSprites()},t.prototype.AdvanceFrame=function(t){var e;for(void 0===this.game.time&&(this.game.time=t),this.game.deltaTime=Math.round(t-this.game.time),this.game.time=t,e=this.game.deltaTime,this.drawDelta=e,this.updateDelta=this.frameTime,e>1e3&&(e=this.frameTime),this.lag+=e;this.lag>=this.frameTime;)this.Update(),this.lag-=this.frameTime;return this.lagOffset=this.lag/this.frameTime,this.Draw(),window.requestAnimationFrame(function(t){return function(e){return t.AdvanceFrame(e)}}(this))},t.prototype.Run=function(t){return this.AdvanceFrame(0)},t}(),Load=function(){function t(t){this.game=t,this.InitEventDispatch(),this.game.Assets={game:this.game,GetTexture:function(t){return this.game.Assets.Textures[t]},GetTexturePack:function(t){return this.game.Assets.TexturePacks[t]},GetTextureSheet:function(t){return this.game.Assets.TextureSheets[t]},GetSound:function(t){return this.game.Assets.Sounds[t].audio}},this.game.Files={},this.textures=this.game.Assets.Textures={},this.texturePacks=this.game.Assets.TexturePacks={},this.textureSheets=this.game.Assets.TextureSheets={},this.sound=this.game.Assets.Sounds={},this.audio=this.game.Assets.Audio={},this.Stack=[],this.finish_stack=0,this.progress=0,this.loaded=!1,this.loadLog=""}return t.MixIn(EventDispatcher),t.prototype.Sound=function(t,e){return this.sound[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"sound",id:e,path:t}),this.finish_stack++},t.prototype.Audio=function(t,e){return this.audio[e]&&Torch.Error("Asset ID '"+e+"' already exists"),this.Stack.push({_torch_asset:"audio",id:e,path:t}),this.finish_stack++},t.prototype.Texture=function(t,e){var i,n,r,o,s;if("string"==typeof t)return this.Stack.push({_torch_asset:"texture",id:e,path:t}),this.finish_stack++;for(s=[],i=n=0,r=t.length;n<r;i=++n)o=t[i],s.push(this.Texture(t[i][0],t[i][1]));return s},t.prototype.PixlTexture=function(t,e,i){var n;return n=pixl(t,e).src,this.Stack.push({_torch_asset:"texture",id:i,path:n})},t.prototype.TexturePack=function(t,e,i,n){var r,o,s,a;for(o=[],r=1;r<=i;)a=t+"_"+r.toString()+"."+n,s=e+"_"+r.toString(),this.Stack.push({_torch_asset:"texture",id:s,path:a}),o.push(s),this.finish_stack++,r++;return this.texturePacks[e]=o},t.prototype.TextureSheet=function(t,e,i,n,r,o){var s,a,h,u,p,c;for(i+=r,u=n/o,s=i/r,p=[],this.Stack.push({_torch_asset:"texture",id:e,path:t}),a=h=0;a<s;){for(;h<u;)c={clipX:a*r,clipY:h*o,clipWidth:r,clipHeight:o},p.push(c),h++;a++}return this.textureSheets[e]=p},t.prototype.File=function(t,e){return this.finish_stack++,this.Stack.push({_torch_asset:"file",id:e,path:t})},t.prototype.LoadItemFinished=function(){var t;if(this.finish_stack--,this.progress=(this.totalLoad-this.finish_stack)/this.totalLoad,this.game.Emit("LoadProgressed",new Torch.Event(this.game,{progress:this.progress})),this.finish_stack<=0)return document.getElementsByClassName("font-loader")[0].remove(),this.loadFinished(),t=((new Date).getTime()-this.startTime)/1e3,console.log("%c"+this.game.name+" loaded in "+t+"s","background-color:green; color:white; padding:2px;padding-right:5px;padding-left:5px")},t.prototype.Load=function(t){var e,i,n,r,o,s,a,h,u;this.loadFinished=t,this.totalLoad=this.finish_stack,this.startTime=(new Date).getTime();try{for(a=this.Stack,h=[],r=0,o=a.length;r<o;r++)switch(u=a[r],u._torch_asset){case"texture":n=new Image,n.src=u.path,u.image=n,this.textures[u.id]=u,n.refId=u.id,n.stackItem=u,n.loader=this,h.push(n.onload=function(){return this.loader.textures[this.stackItem.id].width=this.width,this.loader.textures[this.stackItem.id].height=this.height,this.loader.LoadItemFinished()});break;case"sound":e=new Audio,e.src=u.path,u.audio=e,this.sound[u.id]=u,this.LoadItemFinished(),h.push(e.toggle=function(){return this.currentTime=0,this.play()});break;case"audio":s=new Torch.AjaxLoader(u.path,Torch.AjaxData.ArrayBuffer),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.audio[i.stackItem.id]={},t.audio[i.stackItem.id].encodedAudioData=e,t.game.Audio.DecodeAudioData(e,function(e){return t.audio[i.stackItem.id].audioData=e,t.LoadItemFinished()})}}(this)),h.push(s.Load());break;case"file":Torch.ELECTRON?h.push(Torch.fs.readFile(u.path,"utf8",function(t){return function(e,i){return t.LoadItemFinished(),e?t.game.FatalError(new Error("Torch.Load.File file '{0}' could not be loaded".format(u.path))):t.game.Files[u.id]=i}}(this))):(s=new Torch.AjaxLoader(u.path,Torch.AjaxData.Text),s.stackItem=u,s.Finish(function(t){return function(e,i){return t.LoadItemFinished(),t.game.Files[i.stackItem.id]=e}}(this)),h.push(s.Load()));break;default:h.push(void 0)}return h}catch(t){return i=t,console.log("%c"+this.game.name+" could not load!","background-color:"+Color.Ruby+"; color:white; padding:2px;padding-right:5px;padding-left:5px"),Torch.FatalError(i)}},t}(),Timer=function(){function t(t){this.game=t,this.futureEvents=[]}return t.prototype.Update=function(){var t,e,i,n,r;for(n=this.futureEvents,r=[],e=0,i=n.length;e<i;e++)t=n[e],r.push(t.Update());return r},t.prototype.SetFutureEvent=function(t,e){return this.futureEvents.push(new FutureEvent(t,e,this.game))},t}(),FutureEvent=function(){function t(t,e,i){this.timeToOccur=t,this.handle=e,this.game=i,this.time=0}return t.prototype.Update=function(){if(this.time+=this.game.deltaTime,this.time>=this.timeToOccur&&null!==this.handle&&void 0!==this.handle)return this.handle(),this.handle=null},t}(),Mouse=function(){function t(t){this.game=t,this.x=0,this.y=0,this.down=!1}return t.prototype.SetMousePos=function(t,e){var i;return i=t.getBoundingClientRect(),this.x=e.clientX-i.left,this.y=e.clientY-i.top},t.prototype.GetRectangle=function(){return new Rectangle(this.x,this.y,5,5)},t}(),Camera=function(){function t(t){this.game=t,this.position=new Point(0,0),this.Viewport=new Viewport(this)}return t.prototype.position=null,t.prototype._jerkFollow=null,t.prototype.JerkFollow=function(t,e,i){return null==e&&(e=5),null==i&&(i={maxLeft:-500,maxRight:2e3,maxTop:-500,maxBottom:2e3}),this._jerkFollow=new JerkFollow(this,t,e,i)},t.prototype.Update=function(){if(this.Viewport.Update(),null!=this._jerkFollow)return this._jerkFollow.Update()},t}(),Viewport=function(){function t(t){this.camera=t,this.maxWidth=this.width=window.innerWidth,this.maxHeight=this.height=window.innerHeight,this.rectangle=new Rectangle(this.camera.position.x,this.camera.position.y,this.width,this.height)}return t.prototype.width=0,t.prototype.height=0,t.prototype.maxWidth=0,t.prototype.maxHeight=0,t.prototype.Update=function(){return this.rectangle.x=this.camera.position.x,this.rectangle.y=this.camera.position.y,this.rectangle.width=this.width,this.rectangle.height=this.height},t}(),JerkFollow=function(){function t(t,e,i,n){var r;this.camera=t,this.sprite=e,this.config=n,r=this.camera.Viewport,this.game=this.camera.game,this.Inc=r.width/i,this.boundLeft=r.width/i,this.boundRight=r.width-this.boundLeft,this.boundTop=0}return t.prototype.boundLeft=0,t.prototype.boundRight=0,t.prototype.boundTop=0,t.prototype.boundBottom=0,t.prototype.Inc=0,t.prototype.Update=function(){if(this.sprite.position.x>=this.boundRight){if(this.sprite.position.x>=this.config.maxRight)return void(this.sprite.position.x=this.boundRight);this.boundRight+=this.Inc,this.boundLeft+=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x-this.Inc})}if(this.sprite.position.x<=this.boundLeft){if(this.sprite.position.x<=this.config.maxLeft)return void(this.sprite.position.x=this.boundLeft);this.boundRight-=this.Inc,this.boundLeft-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x+this.Inc})}if(this.sprite.position.y<=this.boundTop)return this.sprite.position.y<=this.config.maxTop?void(this.sprite.position.y=this.boundTop):(this.boundTop-=this.Inc,this.boundBottom-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.y+this.Inc}))},t}(),Layer=function(){function t(t){this.drawIndex=t,this.children=[],this.mapIndex-this.drawIndex}return t.prototype.DrawIndex=function(t){var e,i,n,r;if(!t)return this.drawIndex;for(this.drawIndex=t,r=this.children,i=0,n=r.length;i<n;i++)e=r[i],e.DrawIndex(t);return this},t.prototype.Add=function(t){return t.DrawIndex(this.index),this.children.push(t)},t}(),Layers=function(){function t(t){this.game=t,this.layers=[],this.layerMap={}}return t.prototype.Add=function(t){var e,i,n,r,o;if(i=null,"string"==typeof t)return i=new Layer(this.layers.length),this.layerName[t]=i,this.layers.add(i);for(o=[],e=0,n=t.length;e<n;e++)r=t[e],i=new Layer(this.layers.length),this.layerMap[r]=i,o.push(this.layers.add(i));return o},t.prototype.Remove=function(t,e){var i,n,r,o,s,a,h,u,p;if(this.layerMap[t]){for(i=[],a=layerMap[t],a.Trash(),delete this.layerMap[t],u=this.layers,p=[],n=o=0,h=u.length;o<h;n=++o)r=u[n],s=i[n],n!==a.mapIndex?(i.push(s),e?p.push(s.DrawIndex(s.DrawIndex()-1)):p.push(void 0)):p.push(void 0);return p}return Torch.FatalError("Unable to remove layer '"+t+"'. Layer does not exist")},t.prototype.Get=function(t){return this.layerMap[t]?this.layerMap[t]:Torch.FatalError("Unable to get layer '"+t+"'. Layer does not exist")},t}(),Style=function(){var t,e;return t=document.body,t.style.backgroundColor="black",t.style.overflow="hidden",e=document.getElementsByTagName("CANVAS")[0],e.style.border="1px solid orange",e.style.cursor="pointer"},Debug=function(){function t(t){this.game=t,this.text="",this.CreateHtmlDisplay()}return t.prototype.CreateHtmlDisplay=function(){var t;return t=document.createElement("DIV"),t.style.position="absolute",t.style.display="block",t.style.color="white",t.style.font="monospace",t.style.top=0,document.body.appendChild(t),this.display=t},t.prototype.Update=function(){},t}(),Key=function(){function t(t){this.keyCode=t,this.InitEventDispatch()}return t.MixIn(EventDispatcher),t.prototype.down=!1,t}(),Keys=function(){function t(){this.specialKeys={8:"Delete",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"PauseBreak",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow",45:"Insert",46:"Delete2",48:"Num0",49:"Num1",50:"Num2",51:"Num3",52:"Num4",53:"Num5",54:"Num6",55:"Num7",56:"Num8",57:"Num9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",106:"NumPadMultiply",107:"NumPadPlus",109:"NumPadMinus",110:"NumPadPeriod",111:"NumPadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Colon",187:"NumPlus",188:"Comma",189:"NumMinus",190:"Period",191:"ForwardSlash",192:"Tilda",219:"BracketLeft",221:"BracketRight",220:"BackSlash",222:"Quote"},this.InitKeys()}return t.MixIn(EventDispatcher),t.prototype.SpecialKey=function(t){var e,i,n;i=this.specialKeys;for(e in i)if(n=i[e],t.toString()===e.toString())return this[n];return null},t.prototype.InitKeys=function(){var t,e,i,n,r,o,s;for(e=this,i=0;i<230;)t=String.fromCharCode(i).toUpperCase(),e[t]=new Key(i),i++;r=this.specialKeys,o=[];for(n in r)s=r[n],o.push(e[s]=new Key(n));return o},t}(),Tween=function(){function t(t,e,i,n,r){var o,s,a;this.game=t,this.objectToTween=e,this.tweenProperties=i,this.timeTweenShouldTake=n,this.easing=r,this.InitEventDispatch(),this.game.Tweens.tweens.push(this),this.originalObjectValues={},s=this.tweenProperties;for(o in s)a=s[o],this.originalObjectValues[o]=this.objectToTween[o]}return t.MixIn(Trashable),t.MixIn(EventDispatcher),t.prototype.objectToTween=null,t.prototype.tweenProperties=null,t.prototype.originalObjectValues=null,t.prototype.elapsedTime=0,t.prototype.timeTweenShouldTake=0,t.prototype.easing=null,t.prototype.Update=function(){var t,e,i,n,r;i=this.elapsedTime/this.timeTweenShouldTake,t=this.Ease(i),n=this.tweenProperties;for(e in n)r=n[e],this.objectToTween[e]=this.tweenProperties[e]*t+this.originalObjectValues[e]*(1-t);if(this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.timeTweenShouldTake)return this.Emit("Finish",new Torch.Event(this.game,{tween:this})),this.Trash()},t.prototype.Ease=function(t){switch(this.easing){case Torch.Easing.Linear:return t;case Torch.Easing.Square:return Math.pow(t,2);case Torch.Easing.Cube:return Math.pow(t,3);case Torch.Easing.InverseSquare:return 1-Math.pow(1-t,2);case Torch.Easing.InverseCube:return 1-Math.pow(1-t,3);case Torch.Easing.Smooth:return t*t*(3-2*t);case Torch.Easing.SmoothSquare:return Math.pow(t*t*(3-2*t),2);case Torch.Easing.SmoothCube:return Math.pow(t*t*(3-2*t),3);case Torch.Easing.Sine:return Math.sin(t*Math.PI/2);case Torch.Easing.InverseSine:return 1-Math.sin((1-t)*Math.PI/2)}},t}(),TweenSetup=function(){function t(t,e,i,n){this.game=t,this.object=e,this.timeTweenShouldTake=i,this.easing=null!=n?n:Torch.Easing.Smooth}return t.prototype.To=function(t){return new Tween(this.game,this.object,t,this.timeTweenShouldTake,this.easing)},t.prototype.From=function(t){var e,i;for(e in t)i=t[e],this.object[e]=i;return this},t}(),TweenManager=function(){function t(t){this.game=t,this.tweens=[]}return t.prototype.Update=function(){var t,e,i,n,r,o;for(t=[],n=this.tweens,r=[],e=0,i=n.length;e<i;e++)o=n[e],o.trash?r.push(void 0):(t.push(o),r.push(o.Update()));return r},t.prototype.Tween=function(t,e){return new TweenSetup(this.game,t,e)},t.prototype.All=function(t){var e,i,n,r,o;for(n=this.game.tweens,r=[],e=0,i=n.length;e<i;e++)o=n[e],r.push(t(o));return r},t}(),ParticleEmitter=function(t){function e(t,e,i,n,r,o,s){this.game=t,this.interval=n,this.loop=r,this.particle=o,this.config=s,this.InitSprite(this.game,e,i),this.elapsedTime=0,this.hasEmitted=!1}return extend(e,t),e.prototype.particle=null,e.prototype.auto=!0,e.prototype.Update=function(){if(e.__super__.Update.call(this),void 0!==this.interval){if(!this.hasEmitted)return this.UpdateParticleEmitter();if(this.loop)return this.UpdateParticleEmitter()}},e.prototype.Particle=function(t){return t=t},e.prototype.UpdateParticleEmitter=function(){if(this.auto)return this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.interval?(this.EmitParticles(),this.hasEmitted=!0,this.elapsedTime=0):void 0},e.prototype.EmitParticles=function(t){var e;for(null==t&&(t=!1),e=0;e<this.config.spread;)e++,this.EmitParticle();if(t)return this.Trash()},e.prototype.EmitParticle=function(){var t,e,i,n,r,o,s;return e=Util.Math.RandomInRange(this.config.minAngle,this.config.maxAngle),r=Util.Math.RandomInRange(this.config.minScale,this.config.maxScale),t=Util.Math.RandomInRange(this.config.minAlphaDecay,this.config.maxAlphaDecay),n=Util.Math.RandomInRange(this.config.minRadius,this.config.maxRadius),o=this.position.x,s=this.position.y,"string"!=typeof this.particle?i=new this.particle(this.game,o,s):(i=new Sprite(this.game,o,s),i.Bind.Texture(this.particle)),i.Body.velocity.x=Math.cos(e)*Util.Math.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.velocity.y=Math.sin(e)*Util.Math.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.omega=Util.Math.RandomInRange(this.config.minOmega,this.config.maxOmega),i.Size.scale.width=r,i.Size.scale.height=r,i.drawIndex=1e3,this.game.Tweens.Tween(i,t,Torch.Easing.Smooth).To({opacity:0}).On("Finish",function(){return i.Trash()})},e}(Sprite),ParticleManager=function(){function t(t){this.game=t}return t.prototype.ParticleEmitter=function(t,e,i,n,r,o){return new ParticleEmitter(this.game,t,e,i,n,r,o)},t}(),Sound=function(){function t(t){this.soundId=t}return t.prototype.volume=1,t.prototype.pan=0,t}(),Audio=function(){function t(t){this.game=t,this.GetAudioContext()}return t.prototype.audioContext=null,t.prototype.MasterVolume=1,t.prototype.GetAudioContext=function(){var t;try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext}catch(e){return t=e,console.warn("Unable to initialize audio...")}},t.prototype.DecodeAudioData=function(t,e){return this.audioContext.decodeAudioData(t,function(t){return e(t)})},t.prototype.CreateAudioPlayer=function(){return new AudioPlayer(this)},t}(),AudioPlayer=function(){function t(t){this.audioContext=t.audioContext,this.game=t.game}return t.prototype.volume=1,t.prototype.CreateGain=function(t){var e;return null==t&&(t=1),e=this.audioContext.createGain(),e.gain.value=t,e},t.prototype.Play=function(t){return this.game.FatalError("Cannot play sound. sound must be Torch.Sound")},t.prototype.PlaySound=function(t,e,i){var n,r,o,s,a,h;for(null==e&&(e=0),null==i&&(i=null),h=this.audioContext.createBufferSource(),h.buffer=this.game.Assets.Audio[t].audioData,1!==this.game.Audio.MasterVolume&&(null===i?i=[this.CreateGain(this.game.Audio.MasterVolume)]:i.push(this.CreateGain(this.game.Audio.MasterVolume))),i=null===i?[this.CreateGain(this.volume)]:slice.call(i).concat([this.CreateGain(this.volume)]),s=null,r=o=0,a=i.length;o<a;r=++o)if(n=i[r],null===s?h.connect(n):s.connect(n),s=n,r===i.length-1)return n.connect(this.audioContext.destination),void h.start(e);return h.connect(this.audioContext.destination),h.start(e)},t}(),HookManager=function(){function t(t){this.game=t,this.positionTransform=new Point(0,0)}return t.prototype.positionTransform=null,t}(),CanvasGame=function(){function t(t,e,i,n,r,o){this.canvasId=t,this.width=e,this.height=i,this.name=n,this.graphicsType=r,this.pixel=null!=o?o:0,this.InitGame()}return t.MixIn(EventDispatcher),t.prototype.InitGame=function(){return this.InitEventDispatch(),this.InitGraphics(),this.InitComponents()},t.prototype.InitComponents=function(){var t,e;return e="background-color:"+Color.Flame.GetHtmlString()+"; color:"+Color.Ruby.GetHtmlString()+"; font-weight: bold; padding:2px; padding-right:5px;padding-left:5px",t="WebGL",this.graphicsType===Torch.CANVAS&&(t="Canvas"),console.log("%c Torch v"+Torch.prototype.version+" |"+t+"| - "+this.name,e),this.Loop=new Loop(this),this.Load=new Load(this),this.Mouse=new Mouse(this),this.Timer=new Timer(this),this.Camera=new Camera(this),this.Layers=new Layers(this),this.Debug=new Debug(this),this.Keys=new Keys(this),this.Tweens=new TweenManager(this),this.Particles=new ParticleManager(this),this.Audio=new Audio(this),this.Hooks=new HookManager(this),Style(),this.deltaTime=0,this.fps=0,this.averageFps=0,this.allFPS=0,this.ticks=0,this.zoom=1,this.uidCounter=0,this.paused=!1,this.time=null,this.LastTimeStamp=null,this.spriteList=[],this.threeList=[],this.taskList=[],this.animations=[],this.tweens=[],this.DrawStack=[],this.AddStack=[],this.GamePads=[],this.events={},this.filter={}},t.prototype.InitGraphics=function(){return this.canvasNode=document.createElement("CANVAS"),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,document.getElementById(this.canvasId).appendChild(this.canvasNode),this.canvas=this.canvasNode.getContext("2d"),this.Clear("#cc5200")},t.prototype.PixelScale=function(){return this.canvas.mozImageSmoothingEnabled=!1,this.canvas.imageSmoothingEnabled=!1,this},t.prototype.Start=function(t){var e;if(e={Load:function(){},Update:function(){},Draw:function(){},Init:function(){}},Util.Object(e).Extend(t),this.load=e.Load,this.update=e.Update,this.draw=e.Draw,this.init=e.Init,this.load(this),this.Load.Load(function(t){return function(){return t.init(t),t.WireUpEvents(),t.Run()}}(this)),this.canvasNode.width=this.width,this.canvasNode.height=this.height,"string"==typeof this.width&&(this.canvasNode.width=document.body.clientWidth-50),"string"==typeof this.height)return this.canvasNode.height=document.body.clientHeight-25},t.prototype.Add=function(t){return void 0!==t&&void 0!==t._torch_add||this.FatalError("Cannot add object: "+t.constructor.name+" to game"),"Sprite"===t._torch_add?(t._torch_uid="TORCHSPRITE"+this.uidCounter.toString(),t._torch_add_order=this.uidCounter,this.AddStack.push(t),this.uidCounter++):"Three"===t._torch_add?(t.game=this,this.gl_scene.add(t.entity)):"Task"===t._torch_add?this.taskList.push(t):void 0},t.prototype.Task=function(t){return this.taskList.push(t),this},t.prototype.Run=function(t){return this.Loop.Run(0)},t.prototype.FlushSprites=function(){var t,e,i,n,r;for(i=this.spriteList,n=[],t=0,e=i.length;t<e;t++)r=i[t],n.push(r.Trash());return n},t.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),this.Clear("#000"),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302Cmargin-left:15%font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302Cfont-size:20pxfont-weight:bold'>Stack Trace:</code>\n<br>\n<code style='color:#C9302Cfont-size:20px'>"+i+"</code>\n<br>\n<code style='color:#C9302Cfont-size:18px'>Time: "+this.time+"</code>",document.body.innerHTML=e,this.RunGame=function(){},this.Run=function(){},this.Emit("FatalError",new Torch.Event(this,{error:t})),t},t.prototype.UpdateTasks=function(){var t,e,i,n;for(i=this.taskList,t=0,e=i.length;t<e;t++)n=i[t],n.Execute(this);return this.taskList=Torch.Util.Array(this.taskList).Filter(function(t){return!t.trash})},t.prototype.UpdateSprites=function(){var t,e,i,n;for(i=this.spriteList,t=0,e=i.length;t<e;t++)n=i[t],n.trash?(n.trashed=!0,n.Emit("Trash",new Torch.Event(this))):n.paused||n.Update();return this.spriteList=Torch.Util.Array(this.spriteList).Filter(function(t){return!t.trash}),this.spriteList=this.spriteList.concat(this.AddStack),this.AddStack=[]},t.prototype.DrawSprites=function(){var t,e,i,n,r;for(this.canvas.clearRect(0,0,this.Camera.Viewport.maxWidth,this.Camera.Viewport.maxHeight),this.spriteList.sort(function(t,e){return t.drawIndex===e.drawIndex?t._torch_add_order-e._torch_add_order:t.drawIndex-e.drawIndex}),i=this.spriteList,n=[],t=0,e=i.length;t<e;t++)r=i[t],!r.draw||r.trash||r.GHOST_SPRITE?n.push(void 0):n.push(r.Draw());return n},t.prototype.UpdateAnimations=function(){var t,e,i,n,r;for(n=this.animations,r=[],e=0,i=n.length;e<i;e++)t=n[e],r.push(t.Run());return r},t.prototype.UpdateTimeInfo=function(){return this.fps=Math.round(1e3/this.deltaTime),Infinity===this.fps?this.allFPS+=0:this.allFPS+=Math.round(1e3/this.deltaTime),this.ticks++,this.averageFps=Math.round(this.allFPS/this.ticks)},t.prototype.UpdateGamePads=function(){var t,e,i,n,r;if(navigator.getGamepads&&(navigator.getGamepads,!0)){for(this.GamePads=[],n=navigator.getGamepads(),r=[],t=0,e=n.length;t<e;t++)i=n[t],i?r.push(this.GamePads.push(new Torch.GamePad(i))):r.push(void 0);return r}},t.prototype.Clear=function(t){return void 0===t&&this.FatalError("Cannot clear undefined color"),"object"==typeof t&&(t=t.hex),this.canvasNode.style.backgroundColor=t,this},t.prototype.File=function(t){return void 0===this.Files[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Files[t]},t.prototype.Sound=function(t){return void 0===this.Assets.Sounds[t]?this.FatalError("Unable to access no-existent file: "+t+". File does not exist"):this.Assets.Sounds[t].audio},t.prototype.getCanvasEvents=function(){var t;return t=[["mousemove",function(t){return function(e){return t.Mouse.SetMousePos(t.canvasNode,e),t.Emit("MouseMove",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mousedown",function(t){return function(e){return t.Mouse.down=!0,t.Emit("MouseDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mouseup",function(t){return function(e){return t.Mouse.down=!1,t.Emit("MouseUp",new Torch.Event(t,{nativeEvent:e}))}}(this)],["touchstart",function(t){return function(e){return t.Mouse.down=!0}}(this)],["touchend",function(t){return function(e){return t.Mouse.down=!1}}(this)],["click",function(t){return function(e){return e.preventDefault(),e.stopPropagation(),t.Emit("Click",new Torch.Event(t,{nativeEvent:e})),!1}}(this)]]},t.prototype.getBodyEvents=function(){var t;return t=[["keydown",function(t){return function(e){var i,n;return i=e.keyCode,n=t.Keys.SpecialKey(i),null===n&&(n=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),n.down=!0,n.Emit("KeyDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["keyup",function(t){return function(e){var i,n;return i=e.keyCode,n=t.Keys.SpecialKey(i),null===n&&(n=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),n.down=!1,n.Emit("KeyUp",new Torch.Event(t,{nativeEvent:e}))}}(this)]]},t.prototype.WireUpEvents=function(){var t,e,i,n,r,o,s,a,h;for(s=this.getCanvasEvents(),e=0,i=s.length;e<i;e++)t=s[e],this.canvasNode.addEventListener(t[0],t[1],!1);for(a=this.getBodyEvents(),r=0,n=a.length;r<n;r++)t=a[r],document.body.addEventListener(t[0],t[1],!1);return h=function(t){return function(e){return t.Emit("Resize",new Torch.Event(t,{nativeEvent:e}))}}(this),window.addEventListener("resize",h,!1),o=navigator.getGamepads()},t.prototype.TogglePause=function(){return this.paused?this.paused=!1:this.paused=!0,this},t}(),Game=function(){function t(t,e,i,n,r,o){return r===Torch.CANVAS?new Torch.CanvasGame(t,e,i,n,r,o):r===Torch.WEBGL?new Torch.WebGLGame(t,e,i,n,r,o):void 0}return t}(),Game=CanvasGame,TorchModule(Game,"Game"),TorchModule(StateMachine=function(){function t(t){this.obj=t,this.currentState=null,this.states={},this.game=this.obj.game}return t.prototype.State=function(t,e){return void 0===e?(void 0===this.states[t]&&Torch.FatalError("Unable to get state. State '"+t+"' has not been added to the state machine"),this.states[t]):(e.stateMachine=this,e.game=this.game,this.states[t]=e)},t.prototype.Switch=function(){var t,e,i,n;return e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],this.currentState&&void 0!==this.currentState.End&&(i=this.currentState).End.apply(i,[this.obj].concat(slice.call(t))),void 0!==this.State(e).Start&&(n=this.State(e)).Start.apply(n,[this.obj].concat(slice.call(t))),this.currentState=this.State(e)},t.prototype.Update=function(){
if(null!==this.currentState&&void 0!==this.currentState)return this.currentState.Execute(this.obj)},t}()),State=function(){function t(t,e,i){this.Execute=t,this.Start=e,this.End=i}return t}(),TorchModule(Color=function(){function t(t,e,i){this.Set(t,e,i)}return t.prototype.hex=null,t.prototype.r=null,t.prototype.g=null,t.prototype.b=null,t.prototype.Set=function(t,e,i){return"string"==typeof t?(this.hex=t,this.DecodeHex()):(this.r=t,this.g=e,this.b=i,this.EncodeHex())},t.prototype.DecodeHex=function(){var t;return t=Util.String(this.hex).Chunk(2),this.r=parseInt(t[0],16),this.g=parseInt(t[1],16),this.b=parseInt(t[2],16)},t.prototype.EncodeHex=function(){return this.hex="",this.hex+=this.r.toString(16),this.hex+=this.g.toString(16),this.hex+=this.b.toString(16)},t.prototype.GetHtmlString=function(){return"#"+this.hex},t.prototype.Invert=function(){return this.Set(Math.floor(Math.abs(255-this.r)),Math.floor(Math.abs(255-this.g)),Math.floor(Math.abs(255-this.b)))},t.Random=function(){return new t(Math.floor(Util.Math.RandomInRange(0,255)),Math.floor(Util.Math.RandomInRange(0,255)),Math.floor(Util.Math.RandomInRange(0,255)))},t}()),Color.Red=new Color(256,0,0,1),Color.Green=new Color(0,256,0,1),Color.Blue=new Color(0,0,256,1),Color.Flame=new Color("ff8000"),Color.Ruby=new Color("e60000"),Electron=function(){function t(){}return t.Import=function(){return Torch.ELECTRON=!0,Torch.fs=require("fs")},t}(),TorchModule(Rectangle=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.z=0}return t.prototype.GetOffset=function(t){var e,i,n,r,o,s,a;return s=this.x+this.width/2-(t.x+t.width/2),a=this.y+this.height/2-(t.y+t.height/2),i=this.width/2+t.width/2,e=this.height/2+t.height/2,r=this.x+this.width-(t.x+t.width),o=this.y+this.height-(t.y+t.height),n={x:i-Math.abs(s),y:e-Math.abs(a),vx:s,vy:a,halfWidths:i,halfHeights:e,sharedXPlane:r,sharedYPlane:o}},t.prototype.Intersects=function(t){var e,i;return e=this,i=t,e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y&&e.GetOffset(i)},t.prototype.ShiftFrom=function(t,e,i){var n,r;return n=null,r=null,n=void 0===e?t.x:t.x+e,r=void 0===i?t.y:t.y+i,this.x=n,this.y=r},t}()),TorchModule(Vector=function(){function t(t,e){this.x=t,this.y=e,this.ResolveVectorProperties()}return t.prototype.x=null,t.prototype.y=null,t.prototype.angle=null,t.prototype.magnitude=null,t.prototype.ResolveVectorProperties=function(){return this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y),this.angle=Math.atan2(this.x,this.y)},t.prototype.Clone=function(){return new Torch.Vector(this.x,this.y)},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this.ResolveVectorProperties()},t.prototype.AddScalar=function(t){return this.x+=t,this.y+=t,this.ResolveVectorProperties()},t.prototype.MultiplyScalar=function(t){return this.x*=t,this.y*=t,this.ResolveVectorProperties()},t.prototype.DivideScalar=function(t){return this.x/=t,this.y/=t,this.ResolveVectorProperties()},t.prototype.SubtractVector=function(t){return this.x-=t.x,this.y-=t.y,this.ResolveVectorProperties()},t.prototype.AddVector=function(t){return this.x+=t.x,this.y+=t.y,this.ResolveVectorProperties()},t.prototype.Normalize=function(){return this.DivideScalar(this.magnitude)},t.prototype.DotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.IsPerpendicular=function(t){return 0===this.DotProduct(t)},t.prototype.IsSameDirection=function(t){return this.DotProduct(t)>0},t}()),TorchModule(Point=function(){function t(t,e,i){this.x=t,this.y=e,this.z=null!=i?i:0}return t.prototype.Apply=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.Clone=function(){return new t(this.x,this.y)},t}()),exports=this,Task=function(){function t(t){this.func=t}return t.MixIn(Trashable),t.prototype._torch_add="Task",t.prototype.Execute=function(t){return this.func(t)},t}(),AjaxLoader=function(){function t(t,e){null==e&&(e=window.Torch.AjaxData.Text),this.url=t,this.responseType=this.GetResponseTypeString(e)}return t.prototype.onFinish=function(){},t.prototype.onError=function(){},t.prototype.GetResponseTypeString=function(t){switch(t){case window.Torch.AjaxData.DOMString:return"";case window.Torch.AjaxData.ArrayBuffer:return"arraybuffer";case window.Torch.AjaxData.Blob:return"blob";case window.Torch.AjaxData.Document:return"document";case window.Torch.AjaxData.Json:return"json";case window.Torch.AjaxData.Text:return"text"}},t.prototype.Error=function(t){return this.onError=t},t.prototype.Finish=function(t){return this.onFinish=t},t.prototype.Load=function(){var t;return t=new XMLHttpRequest,t.open("GET",this.url,!0),t.responseType=this.responseType,t.onload=function(e){return function(){return e.onFinish(t.response,e)}}(this),t.send()},t}(),Event=function(){function t(t,e){var i,n,r;this.game=t,this.data=e,null!==this.game&&(this.time=this.game.time),n=this.data;for(i in n)r=n[i],this[i]=r}return t}(),Torch=function(){function t(){var t,e,i;for(this.GamePads=Util.Enum("Pad1","Pad2","Pad3","Pad4"),this.AjaxData=Util.Enum("DOMString","ArrayBuffer","Blob","Document","Json","Text"),this.Types=Util.Enum("String","Number","Object","Array","Function","Sprite","Game","Null"),this.Easing=Util.Enum("Linear","Square","Cube","InverseSquare","InverseCube","Smooth","SmoothSquare","SmoothCube","Sine","InverseSine"),this.Util=Util,this.Electron=new Electron,t=0,e=TorchModules.length;t<e;t++)i=TorchModules[t],this[i.name]=i.mod}return t.prototype.CANVAS=1,t.prototype.WEBGL=2,t.prototype.PIXEL=3,t.prototype.DUMP_ERRORS=!1,t.GamePads=Util.Enum("Pad1","Pad2","Pad3","Pad4"),t.AjaxData=Util.Enum("DOMString","ArrayBuffer","Blob","Document","Json","Text"),t.Types=Util.Enum("String","Number","Object","Array","Function","Sprite","Game","Null"),t.Easing=Util.Enum("Linear","Square","Cube","InverseSquare","InverseCube","Smooth","SmoothSquare","SmoothCube","Sine","InverseSine"),t.AjaxLoader=AjaxLoader,t.Event=Event,t.Util=new Utilities,t.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),document.body.backgroundColor="black",this.DUMP_ERRORS&&void 0!==require&&require("fs").writeFileSync("torch-error.log",t.stack),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302C;margin-left:15%;font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302C;font-size:20px;font-weight:bold'>Stack Trace:</code><br>\n<code style='color:#C9302C;font-size:20px'>"+i+"</code><br>",document.body.innerHTML=e,t},t.prototype.StrictErrors=function(){return this.STRICT_ERRORS=!0},t.prototype.DumpErrors=function(){return this.DUMP_ERRORS=!0},t}(),exports.Torch=new Torch,Torch.prototype.version="0.6.134"}).call(this);